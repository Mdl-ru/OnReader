<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
<title>Книга 3. freeNAS - Полная виртуализация. Базовая коммерческая редакция: Proxmox-freeNAS-Zentyal-pfSense</title>
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/>
<meta name="mavenGroupId" content="www.mdl.ru"/>
<meta name="mavenArtifactId" content="VirtualizationComplete"/>
<meta name="mavenVersionId" content="1.0.0"/>
<link rel="home" href="index.html" title="Полная виртуализация. Базовая коммерческая редакция: Proxmox-freeNAS-Zentyal-pfSense"/>
<link rel="up" href="index.html" title="Полная виртуализация. Базовая коммерческая редакция: Proxmox-freeNAS-Zentyal-pfSense"/>
<link rel="prev" href="Ch02.html" title="Книга 2. pfSense"/>
<link rel="next" href="Ch04.html" title="Книга 4. Контроллер домена Zentyal"/>
<meta name="git-sha" content=""/>
<meta name="buildTime" content=""/>
<script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "virtualization-complete";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Please enable JavaScript.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
</script>
<style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
</style>
<link rel="shortcut icon" href="../MdlLogo.gif" type="image/gif"/>
<link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/>
<link rel="stylesheet" type="text/css" href="../common/css/custom.css"/>
<link rel="canonical" href="http://onreader.mdl.ru/VirtualizationComplete/content/index.html"/>
<!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script>
<script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script>
<link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css"/>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js">
<!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script>
<script type="text/javascript" src="search/nwSearchFnt.js"><!----></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js">
<!--//make this scalable to other languages as well.--></script>
<script type="text/javascript" src="search/index-1.js"><!----></script>
<script type="text/javascript" src="search/index-2.js"><!----></script>
<script type="text/javascript" src="search/index-3.js"><!----></script>
<script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
</script>
<script type="text/javascript" src="../common/ga.js"><!----></script>
<script language="javascript" src="/js/common.js"></script>
<link rel="stylesheet" href="../common/css/googlecode.css">
<script src="../common/highlight.pack.js"></script>
</head>
<body>
<!----><script type="text/javascript"><!--
hljs.initHighlightingOnLoad();
HeaderName = 'Книга 3. freeNAS';
PrevRef = 'Ch02.html';
UpRef = 'index.html';
NextRef = 'Ch04.html';//-->
</script>
<!----><script type="text/javascript" src="HeaderAndToolbar.js">
</script><script type="text/javascript"><!--
document.write(HeaderAndToolbar); //-->
</script>
<div id="content">
 <div class="part">
  <div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title">
   Книга 3. freeNAS</h1>
  </div></div></div>

  <div class="toc"><p><strong>Содержание</strong></p>
   <dl>
   <dt><span class="chapter"><a href="Ch03.html">Книга 3. freeNAS</a></span></dt>
   <dd><dl>
    <dt><span class="section"><a href="Ch03.html#0301">3.1 Отказы обычных хранилищ</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0302">3.2 freeNAS и ZFS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0303">3.3 Установка freeNAS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0304">3.4 Пробрасываение дисков freeNAS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0305">3.5 Настройка системы хранения без резервного копирования</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0306">3.6 Запуск freeNAS из консоли</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0307">3.7 Первоначальная регистрация</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0308">3.8 Навигация по freeNAS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0309">3.9 Настройка сетевой среды</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0310">3.10 Пользователи и группы</a></span></dt>
     <dd><dl>
      <dt><span class="section"><a href="Ch03.html#031001">3.10.1 Добавление нового пользователя</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031002">3.10.2 Добавление новой группы</a></span></dt>
     </dl></dd>
    <dt><span class="section"><a href="Ch03.html#0311">3.11 Добавление тома ZFS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0312">3.12 Отсоединение и перемещение томов</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0313">3.13 Наборы данных ZFS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0314">3.14 Полномочия ZFS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0315">3.15 Службы freeNAS</a></span></dt>
     <dd><dl>
      <dt><span class="section"><a href="Ch03.html#031501">3.15.1 Служба CIFS (совместное использование в Windows)</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031502">3.15.2 Служба NFS (совместное использование в Linux)</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031503">3.15.3 Служба таргетов iSCSI</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031504">3.15.4 Служба Rsync (резервное копиование)</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031505">3.15.5 Служба SSH (безопасная оболочка)</a></span></dt>
     </dl></dd>
    <dt><span class="section"><a href="Ch03.html#0316">3.16 Добавление совместных ресурсов</a></span></dt>
     <dd><dl>
      <dt><span class="section"><a href="Ch03.html#031601">3.16.1 Совместные ресурсы NFS</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031602">3.16.2 Совместные ресурсы Windows</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031603">3.16.3 Совместно используемые таргеты iSCSI</a></span></dt>
     </dl></dd>
    <dt><span class="section"><a href="Ch03.html#0317">3.17 Резервные копии снимков ZFS</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0318">3.18 Восстановление снимков в Windows</a></span></dt>
    <dt><span class="section"><a href="Ch03.html#0319">3.19 Rsync репликации</a></span></dt>
     <dd><dl>
      <dt><span class="section"><a href="Ch03.html#031901">3.19.1 Добавление задания продвижения Rsync</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031902">3.19.2 Добавление модуля Rsync</a></span></dt>
      <dt><span class="section"><a href="Ch03.html#031903">3.19.3 Советы по применению Rsync</a></span></dt>
     </dl></dd>
    <dt><span class="section"><a href="Ch03.html#0320">3.20 Членство в домене</a></span></dt>
     <dd><dl>
      <dt><span class="section"><a href="Ch03.html#032001">3.20.1 Полномочия в домене</a></span></dt>
     </dl></dd>
    <dt><span class="section"><a href="Ch03.html#0321">3.21 Резервные копии настроек</a></span></dt>
   </dl></dd>
   </dl>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0301"> </a>3.1 Отказы обычных хранилищ</h3>
   </div></div></div>
   <p>На протяжении многих лет я полагался на традиционные сервера хранения настроенные с одним из 
   <span class="term"><strong class="userinput">RAID</strong></span> (<span class="term"><strong class="userinput">1</strong></span>, 
   <span class="term"><strong class="userinput">5</strong></span>, <span class="term"><strong class="userinput">6</strong></span>
   или <span class="term"><strong class="userinput">10</strong></span>). Предпочитаемой мной файловой системой была 
   <span class="term"><strong class="userinput">XFS</strong></span>, потому сто она находилась на переднем крае и относительно свободна 
   от неисправностей. Проблема состояла в том, что файловый сервер потреблял все аппаратные ресурсы этой машины даже без нагрузок. Более того,
   вам нужно множество машин выделенных для хранения для сопровождения избыточности данных.</p>
   <p>Ещё одно наблюдение состояла в том, что <span class="term"><strong class="userinput">RAID НЕ совершенен!</strong></span> Если вы выбрали 
   аппаратный RAID, а контроллер вышел из строя, мы имеем развлечение возврата своевременно выполненной резервной копии системы! При 
   выборе RAID на основе программного обеспечения в случае деградации файловой системы мы имеем огромный провал в производительности при 
   выполнении перестроения.</p>
   <p>Большие массивы легко займут 24 часа на выполнение этого процесса. В течение этого времени ИТ подразделение будет наводнено запросами о 
   плохой производительности системы! Что ещё хуже, автоматическое резервное копирование стартует на выполнение своего инкрементальное 
   копирование, вызывая падение производительности! Должен существовать лучший способ!</p>
   <p class="title"><strong>Что делает хорошая система хранения</strong></p>
   <p>Как вы определите хорошую систему хранения? Для начала я спросил себя что было НАИБОЛЕЕ важным? Да, не так просто ответить после 
   работы в поле и перенесённых проблем! Существует ряд ключевых вовлечённых элементов.</p>
   <p>Для меня это:</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>Платформа хранения данных ДОЛЖНА быть <span class="term"><strong class="userinput"><em class="emphasis">надёжной</em></span></strong></span>
	 и <span class="term"><strong class="userinput"><em class="emphasis">совместимой</em></span></strong></span> на протяжении многих лет</p>
	 </li><li class="listitem">
	 <p><span class="term"><strong class="userinput"><em class="emphasis">Совершенная</em></span></strong></span> система аварийного
	 <span class="term"><strong class="userinput"><em class="emphasis">восстановления</em></span></strong></span> ДОЛЖНА быть
	 <span class="term"><strong class="userinput"><em class="emphasis">простой</em></span></strong></span> и
	 <span class="term"><strong class="userinput"><em class="emphasis">быстрой</em></span></strong></span></p>
	 </li><li class="listitem">
	 <p>Операции <span class="term"><strong class="userinput"><em class="emphasis">ввода/вывода</em></span></strong></span> хранилища 
	 ДОЛЖНЫ быть <span class="term"><strong class="userinput"><em class="emphasis">быстрыми</em></span></strong></span>.</p>
	 </li><li class="listitem">
	 <p><span class="term"><strong class="userinput"><em class="emphasis">Ежедневные</em></span></strong></span> запросы
	 <span class="term"><strong class="userinput"><em class="emphasis">восстановления</em></span></strong></span> конечных пользователей 
	 должны быть <span class="term"><strong class="userinput"><em class="emphasis">простыми</em></span></strong></span> и 
	 <span class="term"><strong class="userinput"><em class="emphasis">быстрыми</em></span></strong></span></p>
	 </li><li class="listitem">
	 <p>Данные ДОЛЖНЫ храниться <span class="term"><strong class="userinput"><em class="emphasis">с избыточностью</em></span></strong></span></p>
	 </li><li class="listitem">
	 <p><span class="term"><strong class="userinput"><em class="emphasis">Порча</em></span></strong></span> данных ДОЛЖНА быть 
	 минимизирована</p>
	 </li>
    </ul>
    </div>
   <p>Если я не могу удовлетворить <span class="term"><strong class="userinput">ВСЕ</strong></span> эти ожидания, то выбор платформы 
   хранения не верен!</p>
   <p>В соответствии с этими потребностями традиционные хранилища <span class="term"><strong class="userinput">RAID</strong></span> 
   (<span class="term"><strong class="userinput">1</strong></span>, <span class="term"><strong class="userinput">5</strong></span>, 
   <span class="term"><strong class="userinput">6</strong></span> или <span class="term"><strong class="userinput">10</strong></span>) 
   просто не могут работать! Это требует разъяснений!</p>
   <p class="title"><strong>Рабочие циклы</strong></p>
   <p>Когда инженеры проектируют электронные компоненты, они обычно обеспечивают оценку числа рабочих циклов (Duty Cycle Rating). Такие 
   специальные оценки помогают определять сколько времени компонент может работать под нагрузкой пока нагрев не начнёт необратимую 
   деградацию этого элемента. Теперь давайте применим эту концепцию к массиву жёстких дисков!</p>
   <p>Когда записывается массив с контрольными суммами, например, <span class="term"><strong class="userinput">RAID</strong></span> 
   (<span class="term"><strong class="userinput">1</strong></span>, <span class="term"><strong class="userinput">5</strong></span>, 
   <span class="term"><strong class="userinput">6</strong></span> или <span class="term"><strong class="userinput">10</strong></span>)
   в нём должен синхронизоваться кэш данных без прерываний, иначе он деградирует. Если он деградировал, он БУДЕТ перестраиваться! Если он 
   выполняет перестроение, он вносит дополнительные рабочие циклы увеличение нагрева. Это увеличение нагрева приводит к необратимой 
   деградации компонентов, приводящей к возможному отказу.</p>
   <p>Массив с чередованием, подобный <span class="term"><strong class="userinput">RAID-0</strong></span> никогда не выполняет синхронизацию 
   и не деградирует {из-за неё}. Это уменьшает число рабочих циклов и не приводит к дополнительному нагреву, тем самым продлевая жизнь 
   компоненты. В качестве бонуса это также предоставляет увеличение пропускной способности!</p>
   <p class="title"><strong>Простота и избыточность</strong></p>
   <p><span class="term"><strong class="userinput">RAID-0</strong></span> (массив с чередованием) исключительно отвечает запросам 
   производительности. Он может НИКОГДА не деградировать! Он либо работает, либо нет! Как насчёт простоты и избыточности?</p>
   <p>Итак, здесь присутствует магия! Мы строим нашу систему применяя <span class="term"><strong 
   class="userinput">ТОЛЬКО</strong></span> массивы с чередованием без контрольных сумм, затем используем <span class="term"><strong 
   class="userinput">Rsync для репликации</strong></span> данных между <span class="term"><strong class="userinput">несколькими 
   машинами NAS</strong></span>. Это даёт производительность <span class="term"><strong class="userinput">RAID-0</strong></span> при 
   поддержке избыточности данных.</p>
   <p>Такой метод обеспечивает скорости ввода/ вывода, которые побивают <span class="term"><strong class="userinput">любые</strong></span> 
   хранилища <span class="term"><strong class="userinput">RAID-10</strong></span>. Более того, при виртуализации выдаётся
   <span class="term"><strong class="userinput">совместимость</strong></span> <span class="term"><strong class="userinput">всех</strong></span>
   платформ для выполнения обновлений на лету. Более того, LVM Linux предоставляет простой метод создания 
   <span class="term"><strong class="userinput"><em class="emphasis">UUID томов с последовательным чередованием</em></span></strong></span>. 
   Это означает пуленепробиваемую загрузку и лёгкую физическую миграцию на другие машины.</p>
   <p>Кажется, что все требования удовлетворены за исключением <span class="term"><strong class="userinput"><em 
   class="emphasis">запросов на восстановление конечных пользователей</em></span></strong></span> и 
   <span class="term"><strong class="userinput"><em class="emphasis">минимизации порчи данных</em></span></strong></span>. Постойте, 
   существует <span class="term"><strong class="userinput">freeNAS</strong></span> с <a class="link" 
   href="http://onreader.mdl.ru/FreeBSDMasteryZFS/content/index.html" target="_top"><span class="term"><strong class="userinput">ZFS</strong></span></a>!</p>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0302"> </a>3.2 freeNAS и ZFS</h3>
   </div></div></div>
   <p>Окончательно требования удовлетворяются с добавлением самовосстановления файловой системы <a class="link" 
   href="http://onreader.mdl.ru/FreeBSDMasteryZFS/content/Ch05.html" target="_top"><span class="term"><strong class="userinput">ZFS</strong></span></a>.
   Лучше всего предназначенным для этого построения дистрибутивом является <span class="term"><strong class="userinput">freeNAS</strong></span>.
   После установки в соответствии с этой книгой вы можете ожидать очень приличную производительность при сравнении с файловыми серверами на 
   голом железе. <span class="term"><strong class="userinput">freeNAS</strong></span> очень совершенна при интегрируемости в active directory, 
   резервном копировании снимков и супер- встроенном сценарии RSync для освобождения рук от дубликации по узлам. Давайте приступим к 
   установке!</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание</th></tr><tr><td align="left" valign="top">
	   <p>freeNAS является мощной платформой и её функциональный набор не может быть полностью покрыт в данной книге. Это руководство 
	   разработано как пошаговое для быстрого запуска и перехода к работе Я настоятельно рекомендую применение богатых онлайн ресурсов 
	   для получения более глубоких знаний. 
	   {<span class="emphasis"><em>Прим. пер.: рекомендуем наши переводы книг Майкла В. Лукаса и Аллана Джуда 
	   <a class="link" href="http://onreader.mdl.ru/FreeBSDMasteryZFS/content/Ch01.html" target="_top">Мастерство FreeBSD: ZFS</a> и 
	   <a class="link" href="http://onreader.mdl.ru/AdvancedZFS/content/index.html" target="_top">Мастерство FreeBSD: 
	   ZFS для профессионалов</a></em></span>}.</p></td></tr></table>
     </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0303"> </a>3.3 Установка freeNAS</h3>
   </div></div></div>
   <p>Прежде чем приступить к установке вы должны <span class="emphasis"><em>создать настройку своей ВМ</em></span>. Я рекомендую 
   для установки <span class="emphasis"><em>виртуальный диск 8ГБ</em></span> с <span class="emphasis"><em>8ГБ оперативной 
   памяти</em></span>. Если вам нужно освежить в памяти эти шаги повторите раздел
   <a class="link" href="http://onreader.mdl.ru/VirtualizationComplete/content/Ch01.html#0109" target="_top">1.9 Создание настроек ВМ</a>.</p>
   <p>Теперь включите ВМ freeNAS убедившись, что у вас есть CD или загруженный образ диска. Для данной книги я использую 
   freeNAS версию 9.2.1.5-RELEASE -x64.iso. Если у вас нет freeNAS вы можете загрузить самую последнюю редакцию здесь:
   <a class="link" href="http://www.freenas.org/download-freenas-release.html" target="_top">http://www.freenas.org/download-freenas-release.html</a>
   {<span class="emphasis"><em>Прим. пер.: на момент перевода это FreeNAS-9.3-STABLE-201602031011.iso</em></span>}.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание</th></tr><tr><td align="left" valign="top">
	   <p>Раздел загрузок также позволяет вам выбрать другие выпуски приведённые в нижней части страницы. Я бы рекомендовал вам использовать в 
	   точности используемую мной для данной книги версию! Она была проверена <span class="term"><strong class="userinput">ОЧЕНЬ</strong></span>
	   тщательно, а если она <span class="term"><strong class="userinput">НЕ СЛОМАНА</strong></span> не пытайтесь починить её!.</p></td></tr></table>
     </div>
   <p>После включения питания вы должны увидеть следующие экраны:</p>
   <p>Для продолжения нажмите <span class="term"><strong class="userinput">ENTER</strong></span> (что означает <span class="term"><strong 
   class="userinput">OK</strong></span>).</p>
	<div class="figure"><a id="Fig0301"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0301.jpg" width="553" height="325"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Затем вас пригласят ввести диск установки (как изображено ниже). Так как у нас только один диск это просто!</p>
   <p>Для продолжения нажмите <span class="term"><strong class="userinput">ENTER</strong></span> (что означает <span class="term"><strong 
   class="userinput">OK</strong></span>).</p>
	<div class="figure"><a id="Fig0302"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0302.jpg" width="554" height="324"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>freeNAS теперь готов к началу установки (как изображено ниже).</p>
   <p>Для продолжения нажмите <span class="term"><strong class="userinput">ENTER</strong></span> (что означает <span class="term"><strong 
   class="userinput">Yes</strong></span>).</p>
	<div class="figure"><a id="Fig0303"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0303.jpg" width="551" height="324"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда установка завершится, вас попросят удалить CD и перезагрузиться (как показано ниже).</p>
   <p>Для продолжения нажмите <span class="term"><strong class="userinput">ENTER</strong></span> (что означает <span class="term"><strong 
   class="userinput">OK</strong></span>).</p>
	<div class="figure"><a id="Fig0304"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0304.jpg" width="552" height="324"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Чтобы удалить CD вам нужно выбрать 4й элемент спсика - shutdown  (как изображено ниже).</p>
   <p>Для продолжения нажмите <span class="term"><strong class="userinput">ENTER</strong></span> (что означает <span class="term"><strong 
   class="userinput">OK</strong></span>).</p>
	<div class="figure"><a id="Fig0305"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0305.jpg" width="553" height="324"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь вы можете закрыть консоль и перейти к закладке оборудования ВМ (как изображено ниже). Выберите CD затем кликните 
   <span class="term"><strong class="userinput">Edit</strong></span></p>
	<div class="figure"><a id="Fig0306"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0306.jpg" width="420" height="144"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Чтобы предотвратить повторное использование CD ВМ freeNAS просто пометьте <span class="term"><strong class="userinput">Do not use 
   any media</strong></span> (не использовать никакие носители, как изображено ниже).</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">OK</strong></span></p>
	<div class="figure"><a id="Fig0307"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0307.jpg" width="245" height="166"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Далее вам надо скопировать аппаратные Mac адреса сетевых интерфейсов (выделены указателем ниже), так как они могут быть введены в 
   маршрутизатор pfSense, который уже должен быть установлен.</p>
	<div class="figure"><a id="Fig0308"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0308.jpg" width="397" height="174"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь откройте интерфейс pfSense с веб- управлением и выполните соответствующие записи в статичных соответствиях DHCP (как 
   изображено ниже). Не забудьте сохранить свои изменения.</p>
	<div class="figure"><a id="Fig0309"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0309.jpg" width="527" height="255"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0304"> </a>3.4 Пробрасываение дисков freeNAS</h3>
   </div></div></div>
   <p>На данный момент не существует никаких дисковых хранилищ для применения их freeNAS для совместно используемых ресурсов. Мы сейчас добавим 
   <span class="emphasis"><em>том с чередованием LVM</em></span>, который мы создали в разделе <a class="link" href="Ch01.html#0112" target="_top">1.12 
   Добавление прокидываемых ВМ</a> в качестве <span class="term"><strong class="userinput">транзитного</strong></span> (pass-through) жёсткого 
   диска. Вы можете захотеть повторить материалы этого раздела!</p>
   <p>Для начала откройте программу <span class="term"><code>PuTTY</code></span> и зарегистрируйтесь в качестве <span class="term"><strong 
   class="userinput"><code>root</code></strong></span> на вашем сервере Proxmox (как изображено ниже).</p>
	<div class="figure"><a id="Fig0310"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0310.jpg" width="508" height="162"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Чтобы назначить новый диск мы выполним специальную команду <span class="term"><code>QEMU</code></span> следующим образом:</p>
	   <pre class="screen"> 
# qm set 800 -ide1 /dev/freenas4/6tbstore
	   </pre>
   <p>Введённая в <span class="term"><code>PuTTY</code></span> команда выглядит примерно так (изображено ниже).</p>
	<div class="figure"><a id="Fig0311"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0311.jpg" width="509" height="191"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Результат этой команды очевиден в новом устройстве <span class="term"><code>IDE1</code></span> отображаемом в окне оборудования 
   <span class="term"><code>freeNAS-4</code></span> (как изображено ниже).</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание</th></tr><tr><td align="left" valign="top">
	   <p>Вам придётся обновить страницу закладки чтобы появился новый диск.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig0312"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0312.jpg" width="375" height="181"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0305"> </a>3.5 Настройка системы хранения без резервного копирования</h3>
   </div></div></div>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">ВАЖНО:</th></tr><tr><td align="left" valign="top">
      <p>Чрезвычайно важно что мы делаем резервную копию <span class="term"><strong class="userinput">ТОЛЬКО</strong></span> первичного диска 
	  freeNAS (<span class="term"><strong class="userinput">ide0</strong></span>), а <span class="term"><strong class="userinput">НЕ</strong></span> 
	  диска хранения 6ТБ! Если такое произойдёт, это приведёт к серъёзной деградации производительности вашей системы! Такое поведение легко может 
	  быть обойдено изменением свойств диска как показано ниже.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig0313"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0313.jpg" width="478" height="138"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Заметим, что свойства диска (изображённые ниже) индицируют, что второй диск (<span class="term"><strong class="userinput">ide1</strong></span>) 
   <span class="term"><strong class="userinput">НЕ</strong></span> будет включён в резервное копирование.</p>
	<div class="figure"><a id="Fig0314"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0314.jpg" width="347" height="183"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>ВМ <span class="term"><code>freeNAS-4</code></span> теперь может быть загружена и новый диск 6ТБ настроен как ZFS с чередованием.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">ОТМЕТЬТЕ, ПОЖАЛУЙСТА:</th></tr><tr><td align="left" valign="top">
	   <p>Важно отметить, что <span class="term"><code>freeNAS-4</code></span> теперь привязан к серверу <span class="term"><code>Proxmox3</code></span>
	   своим оборудованием транзитного диска. Он не может быть перемещён на другую физическую машину пока не удалены физические диски.</p></td></tr></table>
     </div>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0306"> </a>3.6 Запуск freeNAS из консоли</h3>
   </div></div></div>
   <p>Теперь запустим вашу новую ВМ freeNAS открыв консоль Proxmox в верхнем правом углу. Когда появится консоль, кликните на кнопку 
   <span class="term"><strong class="userinput">Start</strong></span> (как изображено ниже).</p>
	<div class="figure"><a id="Fig0315"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0315.jpg" width="553" height="342"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь мы используем запущенное окно консоли для того чтобы убедиться что ВМ запущена надлежащим образом и ей назначены соответствующие 
   IP адреса через DHCP. Отметим, что внизу дисплея консоли индицируется адрес нашего веб- интерфейса, который должен быть 
   <span class="term"><strong class="userinput"><code>http://192.168.0.22</code></strong></span></p>
	<div class="figure"><a id="Fig0316"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0316.jpg" width="555" height="337"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0307"> </a>3.7 Первоначальная регистрация</h3>
   </div></div></div>
   <p>Теперь мы можем открыть веб- браузер и ввести адрес ВМ <span class="term"><code>freeNAS</code></span>. Лично я применяю и рекомендую 
   Mozilla Firefox.</p>
   <p>Первый экран, который вы увидите, будет диалогом изменения пароля пользователя <span class="term"><code>root</code></span> (показан ниже).
   Сделайте себе сильный пароль!</p>
	<div class="figure"><a id="Fig0317"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0317.jpg" width="327" height="213"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда пароль установлен, вы должны увидеть полный интерфейс веб- управления (как изображено ниже).</p>
	<div class="figure"><a id="Fig0318"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0318.jpg" width="552" height="735"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0308"> </a>3.8 Навигация по freeNAS</h3>
   </div></div></div>
   <p>Навигация достаточно проста! Вы найдёте несколько вкладок поверх главного экрана. Также существует дерево в левой колонке 
   (на снимке ниже).</p>
	<div class="figure"><a id="Fig0319"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0319.jpg" width="533" height="439"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0309"> </a>3.9 Настройка сетевой среды</h3>
   </div></div></div>
   <p>В процессе установки freeNAS по умолчанию применяются <span class="term"><strong class="userinput">DHCP</strong></span> со своими 
   именами установленными в <span class="term"><strong class="userinput"><code>freenas</code></strong></span>. 
   <span class="term"><strong class="userinput">DHCP</strong></span> <span class="term"><strong class="userinput">НЕ</strong></span> 
   требуется когда вы запускаете любые серверы. Более того, при множестве машин <span class="term"><code>freenas</code></span> работающих 
   в вашей сети они не могут иметь одно и то же имя! Давайте изменим это!</p>
   <p>В закладке <span class="term"><strong class="userinput">Network&gt;Global Configuration</strong></span> (на снимке ниже) вы можете изменить 
   имя вашего хоста, домена, шлюза и информацию сервера имён. В нашем случае я установил шлюз и сервер имён на IP адрес маршрутизатора 
   pfSense, работающего на <span class="term"><code>Proxmox</code></span>. Не забывайте сохранять изменения!</p>
	<div class="figure"><a id="Fig0320"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0320.jpg" width="434" height="393"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь кликните на закладку <span class="term"><strong class="userinput">Network Summary</strong></span> (показанную ниже) чтобы 
   проверить сетевые имя и адрес. Это будет нужно для настройки соответствия статичного адреса.</p>
	<div class="figure"><a id="Fig0321"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0321.jpg" width="335" height="163"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Далее кликните <span class="term"><strong class="userinput">Network&gt;Add Interface</strong></span> (как на снимке ниже).</p>
	<div class="figure"><a id="Fig0322"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0322.jpg" width="361" height="99"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда появится диалог интерфейса (показанный ниже) введите соответствующие <span class="term"><strong class="userinput">имя 
   интерфейса</strong></span> и <span class="term"><strong class="userinput">IP адрес</strong></span>.
   <span class="term"><strong class="userinput">Сетевая маска</strong></span> почти 
   <span class="term"><strong class="userinput">ВСЕГДА</strong></span> будет 
   <span class="term"><strong class="userinput"><code>255.255.255.0</code></strong></span>. Это наиболее часто применяемая 
   <span class="term"><strong class="userinput">Сетевая маска</strong></span> для резервирования дома или на работе.</p> 
	<div class="figure"><a id="Fig0323"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0323.jpg" width="336" height="99"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда вы завершите, вы должны увидеть новую запись в списке под интерфейсами (как показано ниже).</p>
	<div class="figure"><a id="Fig0324"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0324.jpg" width="448" height="115"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0310"> </a>3.10 Пользователи и группы</h3>
   </div></div></div>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031001"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.10.1 Добавление нового пользователя</span></h4>
    </div></div></div>
    <p>Если увас нет локально работающего домена, вам придётся добавлять пользователей на ваш сервер или сервера. Невдалеке справа от главного 
	интерфейса вы найдёте кнопку <span class="term"><strong class="userinput">Account</strong></span> (как изображено ниже).</p>
    <p>Для продолжения нажмите <span class="term"><strong class="userinput">Account</strong></span></p>
	<div class="figure"><a id="Fig0325"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0325.jpg" width="229" height="47"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Вы должны увидеть созданные автоматически страницы <span class="term"><strong class="userinput">Users</strong></span> и
	<span class="term"><strong class="userinput">Groups</strong></span>. Вы легко можете перемещаться с применением закладок в верхней
	части страницы.</p>
    <p>Для добавления членов кликните <span class="term"><strong class="userinput">Add User</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0326"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0326.jpg" width="242" height="137"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Затем должен появиться диалог <span class="term"><strong class="userinput">Add User</strong></span> (как показано ниже). Введите 
	необходимую информацию о новом пользователе. Я вставил простые данные для примера.</p>
	<div class="figure"><a id="Fig0327"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0327.jpg" width="554" height="565"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>В нижней части формы записи существует раздел, позволяющий выбрать вспомогательные группы (<span class="term"><strong class="userinput">Auxiliary
	groups</strong></span>) для нового пользователя. Давайте добавим John Smith в группу ftp! Для этого кликните дважды по соответствующей 
	группе в колонке <span class="term"><strong class="userinput">Available</strong></span> (как изображено ниже).</p>
	<div class="figure"><a id="Fig0328"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0328.jpg" width="516" height="180"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031002"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.10.2 Добавление новой группы</span></h4>
    </div></div></div>
    <p>Добавление новой группы так же просто.</p>
    <p>Для добавления членов кликните <span class="term"><strong class="userinput">Add Group</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0329"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0301.jpg" width="274" height="173"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Затем должен появиться диалог <span class="term"><strong class="userinput">Add Group</strong></span> (как показано ниже). Введите 
	необходимую информацию о новом группе.</p>
	<div class="figure"><a id="Fig0330"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0330.jpg" width="281" height="203"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0311"> </a>3.11 Добавление тома ZFS</h3>
   </div></div></div>
   <p>Веб интерфейс freeNAS делает добавление хранилищ вполне простым. Для доступа к менеджеру томов проверьте в верхней части экрана 
   что вы работаете под вкладкой <span class="term"><strong class="userinput">Storage</strong></span> (как на снимке ниже).</p>
   <p>Для продолжения нажмите <span class="term"><strong class="userinput">ZFS Volume Manager</strong></span>.</p>
	<div class="figure"><a id="Fig0331"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0331.jpg" width="553" height="222"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Чтобы добавить новый том, наберите уникальное имя, затем выберите доступный диск (как изображено ниже).</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">Add Volume</strong></span>.</p>
	<div class="figure"><a id="Fig0332"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0332.jpg" width="430" height="345"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Затем должен появится как активный новый том (как показано ниже).</p>
	<div class="figure"><a id="Fig0333"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0333.jpg" width="491" height="109"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0312"> </a>3.12 Отсоединение и перемещение томов</h3>
   </div></div></div>
   <p>Если по какой- то причине вам нужно <span class="emphasis"><em>переместить</em></span> ВМ freeNAS на другую 
   <span class="emphasis"><em>физическую</em></span> машину Proxmox, наилучшим методом будет <span class="emphasis"><em>аккуратное</em></span> 
   отсоединение тома. В нижней части страницы вы увидите набор управляющих кнопок (как изображено ниже).</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">Detach Volume</strong></span>.</p>
	<div class="figure"><a id="Fig0334"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0334.jpg" width="288" height="122"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Затем freeNAS спрсит вас хотите ли вы разрушить эти данные (как на снимке ниже)! <span class="term"><strong class="userinput">УБЕДИТЕСЬ 
   ЧТО ВЫ НЕ ПОМЕТИЛИ ЭТОТ БЛОК, ИНАЧЕ ВАШИ ДАННЫЕ БУДУТ УТРАЧЕНЫ!</strong></span></p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">Yes</strong></span>.</p>
	<div class="figure"><a id="Fig0335"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0335.jpg" width="332" height="198"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Раз уж том удалён, он <span class="term"><strong class="userinput">НЕ</strong></span> должен быть виден в активных томах. Теперь вам 
   нужно выключить вашу ВМ freeNAS. Я советую сделать дополнительную <span class="term"><strong class="userinput">резервную копию 
   образа ВМ</strong></span> с применением интерфейса Proxmox. Убедитесь что резервная копия сохранена там, где она 
   <span class="emphasis"><em>легко</em></span> доступна! Теперь вы можете безопасно выключить физическую машину Proxmox и переместить 
   freeNAS диски с данными на вашу новый сервер Proxmox.</p>
   <p>Когда вы завершите перенос дисков данных, вам нужно восстановить резервную копию образа ВМ freeNAS выполненную перед переносом. Следующим 
   шагом будет повторное добавление пробрасываемого жёсткого диска на новый сервер Proxmox. Если вы забыли, повторите:
   <a class="link" href="Ch03.html#0304" target="_top">3.4 Пробрасываение дисков freeNAS</a>.</p>
   <p>Когда вы завершите приведённые выше шаги включите ВМ FreeNAS, зарегистрируйтесь и кликните 
   <span class="term"><strong class="userinput">Auto Import Volume</strong></span> (как на снимке ниже).</p>
	<div class="figure"><a id="Fig0336"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0336.jpg" width="491" height="109"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь вы увидите мастер импорта тома. На 1м шаге выберите <span class="term"><strong class="userinput">No: Skip to import</strong></span>
   (&quot;нет, пропустить для импорта&quot; в ответ на вопрос: &quot;том ZFS зашифрован?&quot;), затем кликните
   <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0337"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0337.jpg" width="294" height="174"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>На 2м шаге выберите том, который вы хотите импортировать, затем кликните
   <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0338"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0338.jpg" width="261" height="167"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>После успешного импорта вы должны увидеть свой том, отображаемый как активный (как показано ниже).</p>
	<div class="figure"><a id="Fig0339"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0339.jpg" width="492" height="113"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0313"> </a>3.13 Наборы данных ZFS</h3>
   </div></div></div>
   <p>Теперь, когда мы создали том, самое время улучшить его. О наборе данных (Dataset) можно думать как об аналоге папки (folder) в 
   MS Windows. Даже лучше! Виртуальная папка со специальными свойствами!</p>
   <p>Чтобы создать новый набор данных кликните <span class="term"><strong class="userinput">Create ZFS Dataset</strong></span> (как 
   показано ниже.</p>
	<div class="figure"><a id="Fig0340"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0340.jpg" width="268" height="116"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Просмотром по умолчанию в freeNAS является основной режим (<span class="emphasis"><em>Basic Mode</em></span>), поэтому после 
   <span class="term"><strong class="userinput">именования</strong></span> вами нового набора данных, кликните кнопку 
   <span class="term"><strong class="userinput">Advanced Mode</strong></span> (Расширенный режим, как показано ниже).</p>
	<div class="figure"><a id="Fig0341"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0341.jpg" width="387" height="303"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p><span class="term"><strong class="userinput">Advanced Mode</strong></span> предлагает улучшения, такие как сжатие, тип 
   совместного использования, резервирование и дедупликацию. <span class="term"><strong class="userinput">Отметим</strong></span>, что я 
   установил для данного набора данных <span class="term"><strong class="userinput">квоту</strong></span> 100ГБ (как показано ниже).</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">Add Dataset</strong></span>.</p>
	<div class="figure"><a id="Fig0342"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0342.jpg" width="553" height="448"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь вы увидите свой новый набор данных в списке активных томов (Active Volumes, отображённом ниже). Отметим, что информация в колонках 
   размер и доступно (Size, Available) получается от предварительно установленной квоты.</p>
	<div class="figure"><a id="Fig0343"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0343.jpg" width="553" height="128"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Приведённый выше пример показывает имя набора данных, которое я обычно <span class="term"><strong class="userinput">НЕ</strong></span> 
   применяю. В качестве примера мы сейчас разрушим набор данных.</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">Destroy Dataset</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0344"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0344.jpg" width="200" height="103"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Разработчики freeNAS благоразумно решили дать любую возможность уклониться от деструктивных действий. Отметим, что диалог снабжён 
   красным фоном (как показано ниже).</p>
	<div class="figure"><a id="Fig0345"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0345.jpg" width="320" height="178"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Я предоставил предварительно заполненный том в соответствии с соглашениями об именах наборов данных которые я предпочитаю 
   применять. Префикс <span class="term"><code>ds</code></span> просто отображает тот факт, что я работаю с томом с именем 
   <span class="term"><code>pool0</code></span>. Отметим, что возможно встраивать наш набор данных в другой набор данных (каа изображено 
   ниже).</p>
	<div class="figure"><a id="Fig0346"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0346.jpg" width="503" height="544"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>В любой момент времени вы можете изменить существующий набор данных. Давайте взглянем на свойства набора данных с именем 
   <span class="term"><code>ds.filestore/protected</code></span> (на снимке ниже).</p>
	<div class="figure"><a id="Fig0347"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0347.jpg" width="552" height="331"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Для просмотра свойств набора данных кликните на <span class="term"><strong class="userinput">Edit ZFS Options</strong></span> 
   (как показано ниже)</p>
	<div class="figure"><a id="Fig0348"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0348.jpg" width="210" height="84"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Если вам необходимо дополнительное пространство для этого набора данных, измените оба значения квоты в соответствии с 
   вашими потребностями (как показано ниже):</p>
	<div class="figure"><a id="Fig0349"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0349.jpg" width="554" height="384"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Тщательно следите за тем, чтобы НЕ превышать размер родительского набора данных (как показано ниже)!</p>
	<div class="figure"><a id="Fig0350"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0350.jpg" width="553" height="383"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0314"> </a>3.14 Полномочия ZFS</h3>
   </div></div></div>
   <p>Обычно когда вы создаёте набор данных вам нужно установить соответствующие полномочия для пользователей. Для целей данного примера 
   мы установим полномочия <span class="term"><strong class="userinput">public</strong></span> (общедоступные), которые являются 
   <span class="term"><strong class="userinput">широко открытыми</strong></span>. Однако не стоит беспокоиться, вы также можете 
   <span class="term"><strong class="userinput">ограничить</strong></span> (restrict) общедоступные совместные ресурсы IP адресом, 
   в закладке <span class="term"><strong class="userinput">Share</strong></span>. По секрету я могу сказать, даже с установленными 
   для ваших разделяемых ресурсов общедоступными полномочиями, <span class="emphasis"><em>поскольку pfSence настроен в соответствии с 
   данной книгой</em></span>, с применением аппаратной фильтрации, что <span class="emphasis"><em>совершенно безопасно для вас</em></span>!</p>
   <p>Давайте теперь установим полномочия на набор данных <span class="term"><code>ds.backups</code></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0351"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0351.jpg" width="553" height="147"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Для продолжения кликните <span class="term"><strong class="userinput">Change Permissions</strong></span> (как на снимке ниже).</p>
	<div class="figure"><a id="Fig0352"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0352.jpg" width="197" height="67"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Вы должны увидеть диалог полномочий (показанный ниже). Для разрешения доступа к этому набору данных я пометил все блоки в 
   <span class="term"><strong class="userinput">Mode</strong></span> для <span class="term"><strong class="userinput"><code>Owner</code></strong></span>
   <span class="term"><strong class="userinput"><code>Group</code></strong></span> и
   <span class="term"><strong class="userinput"><code>Other</code></strong></span>. Рекурсивная пометка блоков означает, что
   <span class="term"><strong class="userinput">ВСЕ</strong></span> наборы данных, <span class="emphasis"><em>вложенные</em></span> в 
   обсуждаемый также получат изменение полномочий. <span class="term"><strong class="userinput"><a class="link" 
   href="https://ru.wikipedia.org/wiki/ACL" target="_top">ACL</a></strong></span> может быть оставлен в значении по умолчанию 
   <span class="term"><code>Unix</code></span> даже если настраивается в домене. Если вам нужны <span class="emphasis"><em>определённые</em></span> 
   полномочия для <span class="term"><strong class="userinput"><code>пользователя</code></strong></span> или 
   <span class="term"><strong class="userinput"><code>группы</code></strong></span>, они могут быть выбраны с применением ниспадающего 
   блока.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p>Если у вас есть проблемы с присоединением к совместному ресурсу, это то место, с которого вы должны начать поиск 
	   неисправности. Показанный ниже сброс полномочий гарантирует доступ к набору данных.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig0353"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0353.jpg" width="332" height="328"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0315"> </a>3.15 Службы freeNAS</h3>
   </div></div></div>
   <p>Ваш сервер может быть установлен для размещения различных служб, которые могут быть найдены во вкладке служб (<span class="term"><strong 
   class="userinput">Services</strong></span>, как показано ниже). В данной книге мы в первую очередь сосредоточимся на 
   <span class="term"><strong class="userinput">CIFS</strong></span>, <span class="term"><strong class="userinput">iSCSI</strong></span>,
   <span class="term"><strong class="userinput">NFS</strong></span>, <span class="term"><strong class="userinput">Rsync</strong></span> и 
   <span class="term"><strong class="userinput">SSH</strong></span>.</p>
	<div class="figure"><a id="Fig0354"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0354.jpg" width="316" height="403"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031501"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.15.1 Служба CIFS (совместное использование в Windows)</span></h4>
    </div></div></div>
    <p>Вначале мы посмотрим на <span class="term"><strong class="userinput">CIFS</strong></span> (также известную как 
    <span class="term"><strong class="userinput">SAMBA</strong></span>). Эта служба является основой 
    <span class="emphasis"><em>совместимости с Windows</em></span> сетевой среды и будет вашим первичным протоколом совместного использования 
    файлов. Теперь давайте изучим параметры настройки <span class="term"><strong class="userinput">CIFS</strong></span>.</p>
    <p>Для продолжения кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0355"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0355.jpg" width="313" height="404"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Параметры настроек по умолчанию (изображённые ниже) позволяют совместно использовать файлы в сетевой среде Windows в 
    компьютере с именем <span class="term"><strong class="userinput"><code>freenas</code></strong></span> в пределах рабочей группы с именем 
    <span class="term"><strong class="userinput"><code>WORKGROUP</code></strong></span>. Вы можете изменить эти имена в соответствии со 
    своими потребностями! Например: имя моего домена <span class="term"><strong class="userinput"><code>yourwebs.us</code></strong></span>, 
    а моя рабочая группа называется <span class="term"><strong class="userinput"><code>YOURWEBS</code></strong></span>. Поскольку у меня есть 
    более одного работающего сервера <span class="term"><strong class="userinput"><code>freeNAS</code></strong></span>, я применяю имена такие,
    как <span class="term"><strong class="userinput"><code>freeNAS-1</code></strong></span>, 
    <span class="term"><strong class="userinput"><code>freeNAS-2</code></strong></span>, 
    <span class="term"><strong class="userinput"><code>freeNAS-3</code></strong></span> и т.п.</p>
	<div class="figure"><a id="Fig0356"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0356.jpg" width="513" height="568"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031502"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.15.2 Служба NFS (совместное использование в Linux)</span></h4>
    </div></div></div>
    <p>Далее мы изучим <span class="term"><strong class="userinput">NFS</strong></span>. Эта служба является изначальным протоколом 
    файлового обмена на основе Linux. Сегодня вы можете установить службы на Windows для соединения с разделяемыми ресурсами
    <span class="term"><strong class="userinput">NFS</strong></span>. Я предпочитаю сохранять мои совместно используемые ресурсы 
    <span class="term"><strong class="userinput">NFS</strong></span> закрытыми только для машин Linux. Если вам нужен доступ из Windows 
    просто разрешите временный совместный ресурс <span class="term"><strong class="userinput">CIFS</strong></span>, причём только он 
    будет иметь полномочия для Windows. Давайте теперь рассмотрим параметры настройки для 
    <span class="term"><strong class="userinput">NFS</strong></span>.</p>
    <p>Для продолжения кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0357"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0357.jpg" width="329" height="403"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Единственный параметр настройки который вам нужно будет изменить это <span class="term"><strong class="userinput">Bind IP 
    Address</strong></span> (IP адрес привязки, показанный ниже). Можно привязывать NFS к IP адресам отличным от применяемых 
    для совместных ресурсов CIFS. Для лучшей производительности я рекомендую иметь 2 сетевых адаптера, один для CIFS, а другой для 
    NFS и Rsync.</p>
	<div class="figure"><a id="Fig0358"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0358.jpg" width="325" height="355"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031503"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.15.3 Служба таргетов iSCSI</span></h4>
    </div></div></div>
    <p>Далее мы рассмотрим глобальные параметры <span class="term"><strong class="userinput">iSCSI</strong></span>.
	<span class="term"><strong class="userinput">iSCSI</strong></span> является мощным сетевым протоколом и может быть слегка сложным для 
	начинающих. Он делает возможным создание последовательных совместных ресурсов таким образом, что гостевые операционные системы 
	вводятся в заблуждение, полагая чтоони располагают большим числом физических дисков. Сейчас давайте изучим глобальные параметры настройки 
	(Global Configuration ) для <span class="term"><strong class="userinput">iSCSI</strong></span>.</p>
    <p>Для продолжения кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0359"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0359.jpg" width="268" height="378"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Теперь вы должны видеть экран глобальных настроек таргетов (Target Global Configuration, как показано ниже). Единственное место, к которому 
	вы олжны притрагиваться на этом экране будет <span class="term"><strong class="userinput"><code>Base Name</code></strong></span>.
	Например, вам понадобится изменить <span class="term"><strong class="userinput"><code>org.example</code></strong></span> (как на снимке ниже)
	на что-то вроде <span class="term"><strong class="userinput"><code>us.freenas1.yourwebs</code></strong></span>.</p>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Предостережение</th></tr><tr><td align="left" valign="top">
      <p>Будьте предельно внимательны при изменении основного имени, иначе ваш сервер может стать не видимым для соответствия.
	  Если это произойдёт, вернитесь назад к значениям по умолчанию: 
	  <span class="term"><strong class="userinput"><code>iqn.2011-03.org.example.istgt</code></strong></span></p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig0360"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0360.jpg" width="545" height="615"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
 
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031504"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.15.4 Служба Rsync (резервное копиование)</span></h4>
    </div></div></div>
    <p>Теперь мы рассмотрим параметры настройки <span class="term"><strong class="userinput">Rsync</strong></span>.
	<span class="term"><strong class="userinput">Rsync</strong></span> является мощной утилитой резервного копирования, которая широко 
	применяется в сообществе Linux. Она легковесна и очень хороша в том что она делает! freeNAS предоставляет исключительные сценарии для 
	резервного копирования <span class="term"><strong class="userinput">Rsync</strong></span>! Мы рассмотрим их позже! Давайте теперь 
	рассмотрим параметры настройки для <span class="term"><strong class="userinput">Rsync</strong></span>.</p>
    <p>Для продолжения кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
 	<div class="figure"><a id="Fig0361"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0361.jpg" width="313" height="404"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Настройки для службы <span class="term"><strong class="userinput">Rsync</strong></span> очень просты. Их попросту нет! 
	Сохраните значение порта TCP по умолчанию (как на рисунке ниже).</p>
	<div class="figure"><a id="Fig0362"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0362.jpg" width="447" height="169"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
 
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031505"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.15.5 Служба SSH (безопасная оболочка)</span></h4>
    </div></div></div>
   </div>
   <p>Наконец, мы рассмотрим параметры настройки <span class="term"><strong class="userinput">SSH</strong></span>. 
   <span class="term"><strong class="userinput">SSH</strong></span> поддерживает безопасную оболочку. Она позволяет удалённую регистрацию 
   через программу консоли, например, использовавшуюся ранее в книге программа <span class="term"><strong class="userinput">PuTTY</strong></span>.
   Сейчас давайте изучим параметры настройки для <span class="term"><strong class="userinput">SSH</strong></span>.</p>
   <p>Для продолжения кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0363"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0363.jpg" width="367" height="398"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Убедитесь что вы пометили ВСЕ позиции для отметки, которые пометил я (как на снимке ниже). Больше никаких настроек не требуется.</p>
	<div class="figure"><a id="Fig0364"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0364.jpg" width="368" height="239"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Теперь, когда мы рассмотрели самые важные параметры настройки служб убедитесь что они все разрешены, кликнув на каждый из 
	переключателей службы (как отображено ниже). Они должны быть подсвечены голубым во включенном состоянии!</p>
	<div class="figure"><a id="Fig0365"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0365.jpg" width="367" height="402"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0316"> </a>3.16 Добавление совместных ресурсов</h3>
   </div></div></div>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031601"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.16.1 Совместные ресурсы NFS</span></h4>
    </div></div></div>
   <p>Как уже упоминалось ранее в этой книге, для резервных копий Proxmox я предпочитаю применять NFS. Сейчас мы создадим совместный 
   ресурс с именем <span class="term"><strong class="userinput"><code>netbackups</code></strong></span>, который будет использоваться 
   для <span class="emphasis"><em>резервных копий образов ВМ Proxmox</em></span>.</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput"><code>Sharing&gt;NFS</code></strong></span> (как на снимке ниже)</p>
	<div class="figure"><a id="Fig0366"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0366.jpg" width="437" height="232"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Далее кликните <span class="term"><strong class="userinput"><code>Add NFS Share</code></strong></span> (как на снимке ниже)</p>
	<div class="figure"><a id="Fig0367"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0367.jpg" width="440" height="225"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда появится диалог, введите соответствующую информацию (как изображено ниже). Отметим, что у меня есть 3 
   <span class="term"><strong class="userinput"><code>Авторизованных</code></strong></span> (Authorized) IP адреса серверов Proxmox. 
   Это ограничивает доступ и настоятельно рекомендуется! В <span class="term"><strong class="userinput"><code>Maproot User</code></strong></span> 
   выберите <span class="term"><code>root</code></span>. Это может быть <span class="term"><strong 
   class="userinput"><code>НЕ</code></strong></span> безопасным, однако <span class="term"><strong 
   class="userinput"><code>гарантирует</code></strong></span> работу и оставляет вещи простыми. Также отметим, что я просматривал и выбирал 
   <span class="emphasis"><em>встраиваемые набор данных</em></span> в <span class="term"><strong class="userinput"><code>ds.backup</code></strong></span> 
   с именем <span class="term"><strong class="userinput"><code>netbackups</code></strong></span>.</p>
   <p>Если вы ещё не создали набор данных, вернитесь назад и сделайте его сейчас. В противном случае кликните 
   <span class="term"><strong class="userinput"><code>close</code></strong></span> после выбора вашего набора данных (как наснимке ниже).</p>
	<div class="figure"><a id="Fig0368"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0368.jpg" width="503" height="564"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь внимательно просмотрите свою запись, затем кликните <span class="term"><strong class="userinput"><code>OK</code></strong></span> 
   для продолжения (как изображено ниже).</p>
	<div class="figure"><a id="Fig0369"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0369.jpg" width="504" height="496"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Вы должны теперь увидеть новый совместный ресурс NFS <span class="term"><code>netbackups</code></span> в вашем списке (как 
   показано ниже).</p>
	<div class="figure"><a id="Fig0370"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0370.jpg" width="508" height="109"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
 
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031602"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.16.2 Совместные ресурсы Windows</span></h4>
    </div></div></div>
   <p>Настройка разделяемого ресурса Windows очень похожа на то,что мы делали с NFS. Сейчас мы создадим совместный ресурс с именем 
   <span class="term"><strong class="userinput"><code>netbackups</code></strong></span>, который будет использоваться 
   для <span class="emphasis"><em>резервных копий образов ВМ Proxmox</em></span>.</p>
   <p>Для продолжения кликните <span class="term"><strong class="userinput"><code>Add CIFS Share</code></strong></span> (как на снимке ниже)</p>
	<div class="figure"><a id="Fig0371"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0371.jpg" width="509" height="100"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Начните с набора соответствующего <span class="term"><strong class="userinput"><code>имени</code></strong></span> и выбора 
   <span class="term"><strong class="userinput"><code>пути</code></strong></span> нужного набора данных, как показано ниже!</p>
	<div class="figure"><a id="Fig0372"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0372.jpg" width="386" height="568"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь, если пожелаете, введите комментарий и установите все другие параметры в соответствии с вашими потребностями. Отметим, что я 
   установил для данного совместного ресурса <span class="term"><strong class="userinput"><code>Read Only</code></strong></span> и 
   <span class="term"><strong class="userinput"><code>Browsable to Network Clients</code></strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0373"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0373.jpg" width="393" height="444"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>По завершению ваш новый совместный ресурс Windows будет видим в вашем списке (изображённом ниже).</p>
	<div class="figure"><a id="Fig0374"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0374.jpg" width="554" height="108"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031603"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.16.3 Совместно используемые таргеты iSCSI</span></h4>
    </div></div></div>
    <p>Я оставил <span class="term"><strong class="userinput"><code>iSCSI</code></strong></span> напоследок, поскольку его настройка занимает 
    больше всего времени. Пожалуйста, будьте очень внимательны! Чтобы настроить таргет <span class="term"><strong class="userinput"><code>iSCSI</code></strong></span>
    вначале вам нужно отобразить <span class="emphasis"><em>add a dataset</em></span>. Для данного примера я создал 40ГБ набор данных с именем 
    <span class="term"><strong class="userinput"><code>example.trgt012</code></strong></span> встроенным вовнутрь набора данных
    <span class="term"><strong class="userinput"><code>ds.iscsitrgts</code></strong></span> (как показано ниже). Соглашения об именовании помогает мне 
    определять тип предназначения совместного ресурса с которым я работаю.</p>
	<div class="figure"><a id="Fig0375"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0375.jpg" width="555" height="450"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Когда вы создадите набор данных перейдите к закладке служб (Services) как показано ниже.</p>
    <p>Для продолжения кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0376"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0376.jpg" width="265" height="335"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Далее перейдите напрямую к закладке <span class="term"><strong class="userinput">Portals</strong></span> и кликните 
	<span class="term"><strong class="userinput">Add Portal</strong></span> (как изображено ниже).</p>
	<div class="figure"><a id="Fig0377"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0377.jpg" width="541" height="128"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Когда появится диалоговый экран (показанный ниже) вы отметите, что <span class="term"><strong class="userinput">IP Address</strong></span>
	установлен в <span class="term"><strong class="userinput"><code>0.0.0.0</code></strong></span>, что подразумевает, что будет применяться 
	<span class="term"><strong class="userinput">ЛЮБОЙ</strong></strong></span> интерфейс. Эта установка прекрасна! Также вы можете захотеть 
	добавить некие комментарии.</p>
    <p>Для продолжения кликните <span class="term"><strong class="userinput">OK</strong></span>.</p>
	<div class="figure"><a id="Fig0378"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0378.jpg" width="276" height="348"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Далее мы настроим инициатор! Для выполнения кликните <span class="term"><strong class="userinput">Add Initiator</strong></span> (как 
   изображено ниже).</p>
	<div class="figure"><a id="Fig0379"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0379.jpg" width="540" height="145"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Вы должны увидеть теперь диалог добавления инициатора (как на снимке ниже). Так как вы находитесь на уровне 2 аппаратных средств 
    защищённой сетевой среды, будет безопасным оставить настройки по умолчанию.</p>
    <p>Для продолжения кликните <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0380"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0380.jpg" width="274" height="173"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Теперь мы настроим группы доступа!</p>
    <p>Для продолжения кликните <span class="term"><strong class="userinput">Add Authorized Access</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0381"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0381.jpg" width="543" height="311"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Когда появится диалог, как показано ниже, введите соответствующую информацию. Для данного примера я установил 
	<span class="term"><strong class="userinput">User</strong></span> как <span class="emphasis"><em>network client</em></span>
	с именем <span class="term"><strong class="userinput"><code>win7pro</code></strong></span>, а
	<span class="term"><strong class="userinput">Peer User</strong></span> как моё
	<span class="emphasis"><em>active directory Username</em></span>: <span class="term"><strong class="userinput"><code>lsurber</code></strong></span>.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p><span class="term"><strong class="userinput">Secret</strong></span> и 
	   <span class="term"><strong class="userinput">Peer Secret</strong></span> не могут быть одинаковыми! Я выбираю 
	   <span class="emphasis"><em>произвольный</em></span> <span class="term"><strong class="userinput">Secret</strong></span> и применяю свой
	   <span class="emphasis"><em>пароль active ditrectory</em></span> для <span class="term"><strong class="userinput">Peer Secret</strong></span>.</p></td></tr></table>
     </div>
    <p>Для продолжения кликните <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0382"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0382.jpg" width="322" height="302"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Далее поднимем таргеты! Для продолжения кликните <span class="term"><strong class="userinput">Add Target</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0383"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0383.jpg" width="553" height="158"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Теперь вы должны увидеть экран диалога таргета показанный ниже. Моё предпочтение состоит в использовании имени набора данных 
	(<span class="term"><code>example.trgt012</code></span>) в качестве имени таргета. Теперь выберем 
	<span class="term"><strong class="userinput">Portal Group ID </strong></span> и установленный ранее 
	<span class="term"><strong class="userinput">Initiator Group ID</strong></span>. Такжевы можете выбрать 
	<span class="term"><strong class="userinput">Authentication Group number</strong></span>. Я оставляю эту настройку в 
	<span class="term"><code>none</code></span> для данного примера.</p>
    <p>Для продолжения кликните <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0384"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0384.jpg" width="366" height="390"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Теперь вы должны увидеть свои вновь созданные <span class="term"><strong class="userinput">таргеты</strong></span> как показано ниже.</p>
	<div class="figure"><a id="Fig0385"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0385.jpg" width="556" height="161"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Далее мы настроим экстенты!</p>
    <p>Для продолжения кликните <span class="term"><strong class="userinput">Add Extent</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0386"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0386.jpg" width="554" height="132"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Повторюсь, в качестве имени экстента я выбираю применение имени набора данных и установку 
	<span class="term"><strong class="userinput">размера экстента</strong></span> на <span class="term"><code>40g</code></span>.
	Это соответствует квоте, которую я установил для этого набора данных при его создании. Мои предпочтения и рекомендации заключаются в 
	применении <span class="emphasis"><em>типа экстента</em></span> <span class="term"><strong class="userinput">File</strong></span>.
	Теперь выберем соответствующий <span class="term"><strong class="userinput">путь к экстенту</strong></span>. Отмечу: для
	<span class="term"><strong class="userinput">пути</strong></span> я выбрал вложенный набор данных
	<span class="term"><strong class="userinput"><code>example.trgt012</code></strong></span>.</p>
    <p>После выбора вашего пути кликните <span class="term"><strong class="userinput">Close</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0387"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0387.jpg" width="330" height="445"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Для выполнения кликните <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0388"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0388.jpg" width="338" height="248"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Я специально создал эту <span class="emphasis"><em>распространённую</em></span> ошибку для вашей справки (как показано ниже).</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p>Поскольку тип экстента установлен в <span class="term"><strong class="userinput">File</strong></span> вы не можете просто выбрать 
	   <span class="emphasis"><em>набор данных</em></span> как <span class="term"><strong class="userinput">путь к экстенту</strong></span> 
	   Также отметим, что верный <span class="emphasis"><em>синтаксис</em></span> для 
	   <span class="term"><strong class="userinput">размера экстента</strong></span> был не верен! Он должен быть
	   <span class="term"><strong class="userinput">40GB</strong></span>.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig0389"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0389.jpg" width="515" height="297"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Чтобы <span class="emphasis"><em>исправить</em></span> <span class="term"><strong class="userinput">путь к экстенту</strong></span> я 
	просто добавлю <span class="term"><strong class="userinput"><code>/trgt012</code></strong></span> в 
	<span class="term"><strong class="userinput">конец</strong></span> <span class="term"><strong class="userinput">выбранного экстента</strong></span>.
	Вы можете начинать понимать почему имена так важны!</p>
    <p>Когда все исправлено, кликните <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0390"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0390.jpg" width="516" height="298"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Наконец мы можем ассоциировать таргет с экстенотм!</p>
    <p>Для выполнения кликните <span class="term"><strong class="userinput">Add Target/Extent</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0391"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0391.jpg" width="542" height="194"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Когда появится диалог, просто выберите <span class="term"><strong class="userinput">Target</strong></span> и 
	<span class="term"><strong class="userinput">Extent</strong></span> для связывания из ниспадающих блоков. Вы можете оставить установку
	<span class="term"><strong class="userinput">LUN ID</strong></span> в 
	<span class="term"><strong class="userinput"><code>Auto</code></strong></span>.</p>
    <p>Для выполнения кликните <span class="term"><strong class="userinput">OK</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig0392"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0392.jpg" width="243" height="175"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Когда таргет будет успешно добавлен в вашу систему, он появится как показано ниже. Наши поздравления!</p>
 	<div class="figure"><a id="Fig0393"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0393.jpg" width="536" height="143"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0317"> </a>3.17 Резервные копии снимков ZFS</h3>
   </div></div></div>
   <p>Возможно, <span class="term"><strong class="userinput">САМОЕ ЛУЧШЕЕ</strong></span> свойство файловой системы 
   <span class="term"><strong class="userinput">ZFS</strong></span> это <span class="emphasis"><em>копирование при записи</em></span>
   (copy on write). Эта функциональность делает возможным <span class="emphasis"><em>почти моментальное</em></span> восстановление 
   резервных копий из архивов <span class="emphasis"><em>снимков</em></span>. Когда она установлена и используется надлежащим образом, вам 
   больше <span class="term"><strong class="userinput">НИКОГДА</strong></span> не понадобится другая форма программного обеспечения 
   резервного копирования... Я <span class="term"><strong class="userinput">ВСЕГДА НАСТОЯТЕЛЬНО</strong></span> рекомендую применять мой 
   <span class="emphasis"><em>метод лучшей практики</em></span>. Он включает работу 2, 3 или 4 серверов freeNAS, причём все с одинаковыми 
   наборами данных.</p>
   <p>Любой набор данных содержащий <span class="emphasis"><em>рабочие данные</em></span> будет рассматриваться как
   <span class="term"><strong class="userinput">первичный</strong></span> <span class="emphasis"><em>набор данных</em></span>. Каждый 
   <span class="term"><strong class="userinput">первичный</strong></span> <span class="emphasis"><em>набор данных</em></span> нуждается в
   <span class="term"><strong class="userinput">репликации</strong></span> вручную (один раз в процессе установки) на все остальные узлы 
   freeNAS. <span class="term"><strong class="userinput">Первичный</strong></span> <span class="emphasis"><em>набор данных</em></span> 
   (размещающий рабочие данные) будет настроен как <span class="emphasis"><em>продвигающее задание Rsync</em></span> (Rsync push tasks) на 
   этом узле размещающем рабочие совместно используемые ресурсы. <span class="emphasis"><em>Наборы данных резервных копий</em></span> 
   (исключительно данные резервной копии) будут настроены как <span class="emphasis"><em>модули Rsync</em></span> на любом узле 
   <span class="term"><strong class="userinput">НЕ</strong></span> размещающем рабочие разделяемые ресурсы. При применении этого метода 
   все наборы данных реплицируются на каждом узле freeNAS автоматически.</p>
   <p>Снимки ZFS затем могут быть настроены впоследствии на каждом узле с применением различных расписаний. 
   <span class="term"><strong class="userinput">первичный</strong></span> <span class="emphasis"><em>набор данных</em></span> может 
   быть настроен на почасовые или ежедневные снимки в то время как остальные устанавливаются на еженедельные, ежемесячные и т.д. 
   При достаточных издержках на хранилище представляется возможным <span class="emphasis"><em>установить их</em></span> и 
   <span class="emphasis"><em>забыть про них</em></span> в то время как они поддерживают резервное копирование на протяжении
   <span class="emphasis"><em>года и даже более</em></span>. Давайте сейчас настроим задачу снимка!</p>
   <p>Для выполнения кликните <span class="term"><strong class="userinput">Add Periodic Snapshot</strong></span> (как показано ниже).</p>
 	<div class="figure"><a id="Fig0394"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0394.jpg" width="556" height="104"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Для этой задачи снимка я выбрал наш набор данных <span class="term"><strong class="userinput"><code>ds.backups</code></strong></span> 
   (как на снимке ниже). </p>
	<div class="figure"><a id="Fig0395"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0395.jpg" width="334" height="413"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  <p>Повторю, выключатель <span class="term"><strong class="userinput">Recursive</strong></span> означает что 
   <span class="term"><strong class="userinput">ВСЕ</strong></span> вложенные в <span class="term"><strong class="userinput"><code>ds.backups</code></strong></span> наборы 
   данных будут включены в снимок. Все другие параметры должны быть понятны по названию (изображены ниже).</p>
	<div class="figure"><a id="Fig0396"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0396.jpg" width="334" height="411"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  <p>После сохранения ваше задание снимка возникнет в вашем списке (как на снимке внизу).</p>
	<div class="figure"><a id="Fig0397"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0397.jpg" width="552" height="150"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Отметим, что новое задание снимка выполнилось почти сразу и может быть доступно из вкладки снимков ZFS (как показано ниже). 
   <span class="emphasis"><em>В данном месте пользователи Windows 7 или выше {<span class="emphasis"><em>Прим. пер.: определяется 
   требованиями к NTFS</em></span>} могут теперь кликнуть совместный ресурс файлов CIFS на этом наборе данных и смонтировать или 
   восстановить файл из снимка.</em></span></p>
	<div class="figure"><a id="Fig0398"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0398.jpg" width="550" height="144"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0318"> </a>3.18 Восстановление снимков в Windows</h3>
   </div></div></div>
   <p>Будучи ИТ администратором, приходится в порядке очень распространённой практики иметь ежедневные запросы конечных пользователей, 
   говорящих что они случайно удалили свой файлы. Снимки ZFS делают эту ежедневную задачу лёгкой в обработке в системах работающих под 
   Windows 7 или выше {<span class="emphasis"><em>Прим. пер.: определяется требованиями к NTFS</em></span>}! Давайте изучим параметры
   восстановления снимков для машины Windows 7 (как изображено ниже)!</p>
	<div class="figure"><a id="Fig0399"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0399.jpg" width="556" height="242"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Давайте предположим, что пользователь удалил файл с диска помеченного <span class="term"><code>Z</code></span>. Чтобы просмотреть 
   доступные снимки просто кликните <span class="emphasis"><em>правой кнопкой</em></span> по вашему диску, затем выберите 
   <span class="term"><strong class="userinput">Properties</strong></span> (как на снимке ниже).</p>
	<div class="figure"><a id="Fig03A0"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A0.jpg" width="249" height="332"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда появится диалог, выберите закладку предыдущих версий (Previous Versions, как изображено ниже). Затем вы получите 
   параметры для открытия, копирования или восстановления любых файлов из диапазона снимков в вашем расписании.</p>
	<div class="figure"><a id="Fig03A1"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A1.jpg" width="362" height="449"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>
  
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0319"> </a>3.19 Репликации Rsync</h3>
   </div></div></div>
   <p>{<span class="emphasis"><em>Прим. пер.: отдавая должное Автору данной книги, вынуждены заметить, 
   что время не стоит на месте, и  ZFS обзавелась собственными мощными средствами репликации, которые как 
   тузик грелку рвут в большинстве вариантов использования Rsync по производительности, что обусловлено 
   применением внутренних свойств самих наборов данных и, прежде всего, наличию в них свойства даты 
   рождения. Кроме того, Rsync, например, не позволяет сохранять свойства наборов данных и множество прочих 
   метаданных, включая полномочия, квотрирования и т.п. Собственные репликации ZFS бурно развиваются.
   В 2016г, например, репликации ZFS обзавелись возможностями возобновления отправки после разрыва связи с точки 
   прекращения, что делает жизнь системных администраторов намного более спокойной. Стоит также отметить 
   возможности автоматизации создания резервных копий при помощи zxfer. За подробностями отсылаем вас к 
   <a class="link" href="http://onreader.mdl.ru/AdvancedZFS/content/Ch04.html" target="_top">Главе 4. 
   Репликация</a> во второй книге Лукаса и Джуда по ZFS, вышедшей в апреле 2016.<br />
   Тем не менее, продолжим перевод.</em></span>}</p>
   <p>Как уже упоминалось ранее, <span class="term"><strong class="userinput"><code>Rsync</code></strong></span> является мощной утилитой 
   широко применяемой в сообществе Linux. Это Высокая Доступность (HA) бедных людей без <a class="link" 
   href="http://onreader.mdl.ru/ProxmoxCookbook/content/Fencing.html" target="_top">устройств ограждения</a>! Во многих  отношениях это 
   лучше! Конечно, у вас не будет милисекундного восстановления после отказов и реальной HA, но вы будете иметь различные копии данных, 
   которые при необходимости могут быть получены очень быстро (в течение 5-10 минут). Наибольшим БОНУСОМ здесь является стоимость! 
   Оборудование с реальным <a class="link" href="http://onreader.mdl.ru/ProxmoxCookbook/content/Fencing.html" target="_top">ограждением</a> 
   фермами систем хранения с высокой доступностью будет стоить между $20000 и $100000 в валюте США! {<span class="emphasis"><em>Прим. пер.: 
   здесь можно поспорить с автором: сегодня на рынке присутствуют доступные по стоимости устройства ограждения, <a href="javascript:tocall()" 
   onmouseover="this.href=mail">обращайтесь!</a></em></span>}</p>
   <p>Чтобы установить <span class="term"><strong class="userinput"><code>Rsync</code></strong></span> для первого выполнения убедитесь, 
   что у вас <span class="emphasis"><em>созданы идентичные наборы данных на всех узлах freeNAS</em></span>. Таким образом, если у вас есть 
   <span class="emphasis"><em>3 планируемых сервера</em></span>, то вы должны иметь <span class="emphasis"><em>3 множества идентичных 
   наборов данных</em></span> для резервного копирования <span class="term"><strong class="userinput"><code>Rsync</code></strong></span>.
   <span class="emphasis"><em>Первичные наборы данных</em></span> (размещающие рабочие данные) будут настроены как 
   <span class="emphasis"><em>проталкивающие задания Rsync</em></span> на размещающем рабочие совместно используемые ресурсы узле. 
   <span class="emphasis"><em>Наборы данных резервной копии</em></span> (исключительно для резервной копии) будут настроены как 
   <span class="emphasis"><em>модули Rsync</em></span> на любых узлах, которые <span class="term"><strong class="userinput">НЕ</strong></span>
   размещают рабочие разделяемые ресурсы. При таком подходе все наборы данных реплицируются по всем узлам freeNAS автоматически.</p>
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031901"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.19.1 Добавление задания продвижения Rsync</span></h4>
    </div></div></div>
    <p>Давайте добавим задание <span class="term"><strong class="userinput"><code>Rsync</code></strong></span> для нашего <span class="emphasis"><em>первичного 
	набора данных</em></span> с именем <span class="term"><strong class="userinput"><code>netbackups</code></strong></span>! Этот набор данных 
	содержит важные <span class="term"><strong class="userinput">рабочие</strong></span> (live) данные и является местом, в котором 
	Proxmox хранит ВСЕ <span class="emphasis"><em>резервные копии образов ВМ</em></span> в системе настроенной наподобие 
	<a class="link" href="index.html#Case0002" target="_top">(Вариант-2) Оптимизированный для систем хранения с сетевой поддержкой</a>!</p>
    <p>Для выполнения кликните <span class="term"><strong class="userinput">System&gt;Rsync Tasks&gt;Add Rsync Task</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig03A2"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A2.jpg" width="218" height="175"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Вы должны теперь увидеть блок диалога задания. Кликните <span class="term"><strong class="userinput">Browse</strong></span> и выберите 
	соответствующий набор данных (как показано ниже).</p>
	<div class="figure"><a id="Fig03A3"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A3.jpg" width="367" height="39"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Отметим (ниже) что я выбрал набор данных <span class="term"><strong class="userinput"><code>netbackups</code></strong></span> который 
	является вложенным в <span class="term"><strong class="userinput"><code>ds.backups</code></strong></span>! 
	<span class="term"><strong class="userinput">ЗАМЕТЬТЕ</strong></span>, пожалуйста, что когда работает 
	<span class="term"><strong class="userinput"><code>Rsync</code></strong></span>, он будет делать резервное копирование всей 
	<span class="term"><strong class="userinput">папки</strong></span> набора данных 
	<span class="term"><strong class="userinput"><code>netbackups</code></strong></span>. Это <span class="term"><strong class="userinput">ВАЖНО</strong></span>
	помнить когда вы настраиваете <span class="emphasis"><em>резервные копии наборов данных</em></span> на других узлах.</p>
	<div class="figure"><a id="Fig03A4"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A4.jpg" width="369" height="154"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Далее вам будет нужно ввести IP адрес <span class="term"><strong class="userinput">удалённого хоста</strong></span> (Remote Hos) и 
	<span class="term"><strong class="userinput">имя удалённого модуля</strong></span> (Remote Module Name). Отметим, я выбрал 
	<span class="term"><strong class="userinput"><code>freenas5.netbackups</code></strong></span> в качестве имени модуля (как изображено ниже).
	Это обозначает <span class="term"><strong class="userinput"><code>freenas5</code></strong></span> как 
	<span class="term"><strong class="userinput">удалённый модуль</strong></span>, а 
	<span class="term"><strong class="userinput"><code>netbackups</code></strong></span> как 
	<span class="term"><strong class="userinput">папку набора данных</strong></span>, для которой я выполняю резервное копирование. Теперь 
	если я хочу реплицировать <span class="term"><strong class="userinput"><code>netbackups</code></strong></span> на другой сервер 
	<span class="term"><code>freeNAS-2</code></span>, имена модулей <span class="emphasis"><em>уникально идентифицируют 
	каждую репликацию</em></span>.</p>
	<p>Оставим настройку <span class="term"><strong class="userinput">режима Rsync</strong></span> в значении 
	<span class="term"><strong class="userinput"><code>module</code></strong></span>, а 
	<span class="term"><strong class="userinput">направление</strong></span> (direction) установим в значение 
	<span class="term"><strong class="userinput"><code>Push</code></strong></span>. Мы можете пожелать ввести описание, которое 
	обозначит частоту резервного копирования.</p>
	<div class="figure"><a id="Fig03A5"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A5.jpg" width="357" height="176"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Далее выберем желательную <span class="term"><strong class="userinput">частоту</strong></span> резервного копирования 
	отрегулировав ползунок (рисунки 1-3 ниже).</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p>Каждые 15 минут может быть <span class="emphasis"><em>слишком часто</em></span> для хорошей 
	   <span class="emphasis"><em>производительности</em></span>! Это приведено исключительно в качестве примера! Обычно я применяю 
	   1 часдля файлов, которые изменяются часто и 1 день для статичных файлов.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig03A6"> </a>
	 <p class="title"><strong>Рисунок 1</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A6.jpg" width="420" height="171"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
	<div class="figure"><a id="Fig03A7"> </a>
	 <p class="title"><strong>Рисунок 2</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A7.jpg" width="413" height="158"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
	<div class="figure"><a id="Fig03A8"> </a>
	 <p class="title"><strong>Рисунок 3</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A8.jpg" width="414" height="155"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Вы также можете выбрать определённые месяцы (как показано ниже).</p>
	<div class="figure"><a id="Fig03A9"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03A9.jpg" width="253" height="174"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>И, конечно, определите дни недели (как на снимке ниже).</p>
	<div class="figure"><a id="Fig03B0"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B0.jpg" width="253" height="109"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>

    <p><span class="term"><strong class="userinput">Пользователем</strong></span> по умолчанию назначен <span class="term"><strong 
	class="userinput"><code>root</code></strong></span> (как показано ниже). Я <span class="term"><strong 
	class="userinput">НЕ</strong></span> буду менять это пока вы не знаете что вы делаете.</p>
 	<div class="figure"><a id="Fig03B1"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B1.jpg" width="280" height="36"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Мне нравится применять набор параметров показанный ниже.</p>
	<div class="figure"><a id="Fig03B2"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B2.jpg" width="198" height="261"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
	<div class="figure"><a id="Fig03B3"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B3.jpg" width="419" height="113"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Снимок экрана ниже отображает то, как выглядит таблица работающих заданий Rsync. Эти задания настроены на файловом сервере с 
	именем <span class="term"><code>freeNAS-1</code></span>, размещающем рабочие данные. Все наборы данных проталкиваются на удалённые модули 
	(Remote Modules) на узлах <span class="term"><code>freeNAS-2</code></span> и <span class="term"><code>freeNAS-4</code></span> 
	каждый час.</p>
	<div class="figure"><a id="Fig03B4"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B4.jpg" width="555" height="614"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
 
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031902"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.19.2 Добавление модуля Rsync</span></h4>
    </div></div></div>
    <p>Давайте сейчас установим <span class="term"><strong class="userinput">модуль Rsync</strong></span> для резервного копирования набора данных 
	на одном из других узлов Proxmox для синхронизации вашего набора данных 
    <p>Для выполнения кликните <span class="term"><strong class="userinput">Services&gt;Rsync</strong></span> (как показано ниже).</p>
	<span class="term"><strong class="userinput"><code>netbackups</code></strong></span>!</p>
	<div class="figure"><a id="Fig03B5"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B5.jpg" width="166" height="177"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Теперь кликните <span class="term"><strong class="userinput">Add Rync Module</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig03B6"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B6.jpg" width="191" height="90"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Сейчас вы должны увидеть блок диалога модуля (как на снимке ниже). Введите <span class="term"><strong class="userinput">имя 
	модуля</strong></span> из <span class="emphasis"><em>задания проталкивания Rsync</em></span>, которое вы перед этим настроили 
	<span class="term"><strong class="userinput"><code>freenas5.netbackups</code></strong></span>. Вы можете захотеть использование 
	того же самого <span class="term"><strong class="userinput">комментария</strong></span> из 
	<span class="emphasis"><em>задания проталкивания Rsync</em></span>. Оставьте <span class="term"><strong class="userinput">режим 
	доступа</strong></span> (Access Mode) <span class="term"><code>Read/Write</code></span>, <span class="term"><strong 
	class="userinput">пользователем</strong></span> установите <span class="term"><code>root</code></span>.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p>Я добавил адрес IP <span class="emphasis"><em>первичного</em></span> freeNAS <span class="emphasis"><em>узла с 
	   заданием проталкивания</em></span> в поле <span class="term"><strong class="userinput">Host allow</strong></span> для 
	   ограничения доступа.</p></td></tr></table>
     </div>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">ОЧЕНЬ ВАЖНО:</th></tr><tr><td align="left" valign="top">
      <p>Является критической установка <span class="term"><strong class="userinput">пути</strong></span>
	  к <span class="term"><code>/mnt/pool0/</code></span><span class="term"><strong class="userinput"><code>ds.backups</code></strong></span>
	  а <span class="term"><strong class="userinput">НЕ</strong></span> к 
	  <span class="term"><code>/mnt/pool0/</code></span><span class="term"><strong class="userinput"><code>ds.backups/netbackups</code></strong></span>,
	  иначе вы завершите с <span class="emphasis"><em>вложенной копией</em></span>, которая будет выглядеть как то так:
	  <span class="term"><code>/mnt/pool0/ds.backups/netbackups/netbackups</code></span>.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig03B7"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B7.jpg" width="448" height="460"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Снимок экрана ниже отображает то, как выглядит таблица работающих модулей Rsync. Эти модули настроены на машине с 
	именем <span class="term"><code>freeNAS-4</code></span>. Все наборы данных проталкиваются с 
	<span class="term"><code>freeNAS-1</code></span> каждый час.</p>
	<div class="figure"><a id="Fig03B8"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B8.jpg" width="552" height="319"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   </div>
 
   <div class="section">
    <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="031903"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.19.3 Советы по применению Rsync</span></h4>
    </div></div></div>
    <p>Настройка заданий и модулей может быть сбивающей с толку вначале, так что будьте терпеливы и думайте о том, что вы 
	делаете.</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>Помните, что когда вы настраиваете <span class="term"><strong class="userinput"><code>Rsync</code></strong></span>
	 в <span class="emphasis"><em>режиме проталкивания</em></span> (применяемом в данной книге) 
	 <span class="emphasis"><em>рабочие наборы данных</em></span> (live datasets) будут иметь 
	 <span class="term"><strong class="userinput">задание</strong></span> (Task), а 
	 <span class="emphasis"><em>наборы данных резервных копий</em></span> (backup datasets) будут иметь 
	 <span class="term"><strong class="userinput">модуль</strong></span> (Module).</p>
	 </li><li class="listitem">
	 <p>Избегайте наличия рабочих наборов данных на всех узлах freeNAS. Вас следует иметь по крайней мере 1 узел freeNAS, на котором 
	 НЕ будет размещено рабочих данных. <span class="emphasis"><em>Обычно</em></span> это означает, что на этой машине НЕ будет 
	 заданий проталкивания Rsync.</p>
	 </li><li class="listitem">
	 <p>Проверяйте дважды все создаваемые вами 	 <span class="term"><strong class="userinput">задания</strong></span> (Task) и 
	 <span class="term"><strong class="userinput">модули</strong></span> (Module). Это позволит вам предотвращать 
	 <span class="emphasis"><em>перезапись</em></span> (overwriting) важных рабочих данных.</p>
	 </li><li class="listitem">
	 <p>Когда вы устанавливаете новые сервер freeNAS с большим количеством данных, добавляйте только несколько модулей за раз. 
	 Вы будете испытывать большие провалы с производительностью если попытаетесь синхронизировать несколько Терабайт данных 
	 целиком за один раз.</p>
	 </li><li class="listitem">
	 <p>Применяйте продуманную практику наименований во избежание недоразумений.</p>
	 </li><li class="listitem">
	 <p>Применяйте выделенные сетевые адаптеры и изолируйте подсеть для впечатляющего улучшения производительности. Вы также 
	 можете пожелать ограничить пропускную способность ИЛИ применять виртуальные сетевые адаптеры 100Base для таких выделенных 
	 соединений.</p>
	 </li>
    </ul>
    </div>
   </div>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0320"> </a>3.20 Членство в домене</h3>
   </div></div></div>
    <p>Каталог домена содержит <span class="emphasis"><em>центральной базы данных</em></span> и позволяет 
	<span class="term"><strong class="userinput">НАМНОГО</strong></span> легче <span class="term"><strong class="userinput">управлять</strong></span>
	пользователями, группами и сетевыми службами. Большая часть доменов управляются Microsoft
	<span class="term"><strong class="userinput">active directory</strong></span>, работающей на Windows server. В эту книгу я включил 
	<span class="emphasis"><em>альтернативу с открытым исходным кодом</em></span> которая усиливается мощностью платформы 
	<span class="term"><strong class="userinput">Samba4</strong></span> работающей на сервере небольшого предприятия
	<span class="term"><strong class="userinput">Zentyal</strong></span>.</p>
    <p>Хотя freeNAS способен взаимодействовать с Контроллером Домена, я предпочитаю применять <span class="term"><strong class="userinput">Zentyal</strong></span>,
	потому что сохраняет вещи <span class="emphasis"><em>модульными</em></span> и он может без задержки устанавливаться на 
	управление <span class="emphasis"><em>Master/Slave</em></span>  (Главный/Ведомый). Этот метод является предпочтительным, поскольку он добавляет
	<span class="emphasis"><em>резервирование</em></span> <span class="emphasis"><em>центральной базе данных</em></span>!</p>
    <p>Давайте добавим такой freeNAS сервер в домен под управлением <span class="term"><strong class="userinput">Zentyal</strong></span>. В 
	традициях <span class="emphasis"><em>сохранять вещи простыми</em></span> и <span class="emphasis"><em>совместимости</em></span> я буду 
	использовать более старый стиль базы данных <span class="term"><strong class="userinput">NT4</strong></span> (как показано ниже).</p>
    <p>Чтобы настроить службу каталога домена кликните <span class="term"><strong class="userinput">System&gt;General</strong></span>, затем выберите 
	<span class="term"><strong class="userinput">NT4</strong></span> в ниспадающем списке. Не забывайте сохранять настройки!</p>
	<div class="figure"><a id="Fig03B9"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03B9.jpg" width="392" height="484"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Далее перейдите в <span class="term"><strong class="userinput">System&gt;Directory Services</strong></span> и кликните на 
	иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже).</p>
	<div class="figure"><a id="Fig03C0"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C0.jpg" width="296" height="430"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Сейчас вы должны получить диалог <span class="term"><strong class="userinput">Directory Services</strong></span> (как показано ниже). 
	Введите <span class="emphasis"><em>IP адрес</em></span> Контроллера Домена вместо имени хоста. Это адрес вашего сервера 
	<span class="term"><strong class="userinput">Zentyal</strong></span>.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p>Этот адрес также должен быть введён в вашем <span class="emphasis"><em>статичном списке резервирования pfSense 
	   DHCP</em></span>.</p></td></tr></table>
     </div>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">ОБРАТИТЕ ВНИМАНИЕ:</th></tr><tr><td align="left" valign="top">
      <p>В каталогах на основе <span class="term"><strong class="userinput">NT4</strong></span> вам 
	  <span class="term"><strong class="userinput">НЕ НАДО</strong></span> вводить суффиксы доменов 
	  <span class="term"><strong class="userinput"><code>.com</code></strong></span>,
	  <span class="term"><strong class="userinput"><code>.org</code></strong></span>,
	  <span class="term"><strong class="userinput"><code>.us</code></strong></span> и т.п. Кроме того, имя вашей 
	  <span class="term"><strong class="userinput"><code>рабочей группы</code></strong></span> ограничено 
	  <span class="emphasis"><em>15 символами</em></span>. Я ввёл 
	  <span class="term"><strong class="userinput"><code>YOURWEBS</code></strong></span> для имени 
	  <span class="term"><strong class="userinput"><code>рабочей группы</code></strong></span>,
	  даже хотя мной управляет имя домена <span class="term"><strong class="userinput"><code>YOURWEBS.US</code></strong></span> 
	  (как изображено ниже).</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig03C1"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C1.jpg" width="380" height="273"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    <p>Ранее мы настроили совместный ресурс <span class="term"><strong class="userinput">CIFS</strong></span> (Windows) на вашем новом 
	сервере freeNAS. Когда мы настраиваем машину на участие в домене установки CIFS Workgroup должны соответствовать установкам в службе 
	домена.</p>
	<p>Теперь дважды проверьте свои настройки перейдя в <span class="term"><strong class="userinput">Services&gt;CIFS</strong></span>, а 
	затем кликните на иконку <span class="term"><strong class="userinput">гаечного ключа</strong></span> (как показано ниже). Не забудьте 
	сохранить свои изменения!</p>
	<div class="figure"><a id="Fig03C2"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C2.jpg" width="511" height="565"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Теперь вы можете разрешить вашу Cлужбу Каталога (Directory Service) кликнув на выключатель как показано ниже. Когда он станет разрешённым, 
   он подсветится синим цветом.</p>
	<div class="figure"><a id="Fig03C3"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C3.jpg" width="317" height="384"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Завершающим шагом станет <span class="term"><strong class="userinput">перестроение кэша</strong></span> (Rebuild the cach). Перейдите в 
   <span class="term"><strong class="userinput">System&gt;Settings&gt;Advanced</strong></span>, затем кликните 
   <span class="term"><strong class="userinput">Rebuild LDAP/AD Cache</strong></span> в нижней части текущей страницы (как показано ниже).</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25"><a id="DockerBooleanFlags"> </a>
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание:</th></tr><tr><td align="left" valign="top">
	   <p>Иногда для того, чтобы изменения вступили в силу, необходимо перезагрузить сервер.</em></span>.</p></td></tr></table>
     </div>
	<div class="figure"><a id="Fig030C4"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C4.jpg" width="548" height="614"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>

    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
     <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="032001"> </a>
	  <span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">3.20.1 Полномочия в домене</span></h4>
     </div></div></div>
   <p>Так как ваш сервер теперь стал активным <span class="emphasis"><em>участником домена</em></span>, вам должны стать доступными 
   <span class="emphasis"><em>дополнительные</em></span> пользователи и группы в вашем диалоге полномочий для набора данных. Чтобы 
   продемонстрировать это я включил диалог полномочий для ранее созданного нами набора данных 
   <span class="term"><strong class="userinput"><code>netbackups</code></strong></span>. Отметим <span class="emphasis"><em>дополнительных</em></span>
   пользователей в <span class="emphasis"><em>нижней части</em></span> ниспадающего списка (как на снимке экрана внизу).</p>
	<div class="figure"><a id="Fig03C5"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C5.jpg" width="487" height="647"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>В качестве примера я изменил полномочия владельцев для набора данных 
   <span class="term"><strong class="userinput"><code>netbackups</code></strong></span> (как изображено ниже). При таких новых полномочиях доступ 
   к набору данных будут иметь <span class="term"><strong class="userinput">только</strong></span> администраторы домена.</p>
	<div class="figure"><a id="Fig030C6"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C6.jpg" width="331" height="329"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
    </div>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0321"> </a>3.21 Резервные копии настроек</h3>
   </div></div></div>
   <p>Помимо применения резервных копий образов ВМ также будет целесообразно сохранять копию настроек freeNAS. Резервная копия настроек 
   особенно важна когда разработчики переписывают сборку таким образом, что некоторые пакеты при обновлении разрушаются. В этом случае 
   ваша резервная копия образа ВМ вернёт только последнюю использованную вами версию. Я не встречал подобного для freeNAS, поэтому не 
   стоит очень сильно беспокоиться! {<span class="emphasis"><em>Прим. пер.: но, "бережёного Бог бережет, сказала монахиня, надевая 
   презерватив на свечку..." </em></span>}</p>
   <p>Для доступа к странице настроек резервных копий кликните 
   <span class="term"><strong class="userinput">System&gt;Settings&gt;General</strong></span> с последующим  
   <span class="term"><strong class="userinput">Save Config</strong></span> (как на снимке внизу).</p>
	<div class="figure"><a id="Fig03C7"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C7.jpg" width="328" height="407"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Когда появится диалог загрузки, сохраните файл настройки на диск (как показано ниже).</p>
		  <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
			<table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
			<img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Подсказка:</th></tr><tr><td align="left" valign="top">
			<p>Я рекомендую сохранять её копию на флешке!</p></td></tr></table>
		  </div>
<div class="figure"><a id="Fig03C8"> </a>
	 <p class="title"><strong> </strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig03C8.jpg" width="323" height="230"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>Восстановление вашего freeNAS должно быть самоочевидным! Просто воспользуйтесь параметром восстановления настройки
   (<span class="term"><strong class="userinput">Upload Config</strong></span>)!</p>
  </div>


 </div>

<!----><script type="text/javascript" src="FooterAndSidebar.js">
</script><script type="text/javascript"><!--</div id="content"> is inside next code
document.write(FooterAndSidebar);//-->
</script>

</body></html>