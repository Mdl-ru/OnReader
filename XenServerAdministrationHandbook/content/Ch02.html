<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
<title>Глава 2. Архитектура ядра и критически важные компоненты - Руководство системного администратора XenServer</title>
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/>
<meta name="mavenGroupId" content="www.mdl.ru"/>
<meta name="mavenArtifactId" content="XenServerAdministrationHandbook"/>
<meta name="mavenVersionId" content="1.0.0"/>
<link rel="home" href="index.html" title="Руководство системного администратора XenServer"/>
<link rel="up" href="index.html" title="Руководство системного администратора XenServer"/>
<link rel="prev" href="Ch01.html" title="Глава 1. Что такое XenServer?"/>
<link rel="next" href="Ch03.html" title="Глава 3. Установка XenServer"/>
<meta name="git-sha" content=""/>
<meta name="buildTime" content=""/>
<script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-xenserver-administration-handbook";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Please enable JavaScript.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
</script>
<style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
</style>
<link rel="shortcut icon" href="../MdlLogo.gif" type="image/gif"/>
<link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/>
<link rel="stylesheet" type="text/css" href="../common/css/custom.css"/>
<link rel="canonical" href="http://onreader.mdl.ru/XenServerAdministrationHandbook/content/index.html"/>
<!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script>
<script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script>
<link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css"/>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js">
<!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script>
<script type="text/javascript" src="search/nwSearchFnt.js"><!----></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js">
<!--//make this scalable to other languages as well.--></script>
<script type="text/javascript" src="search/index-1.js"><!----></script>
<script type="text/javascript" src="search/index-2.js"><!----></script>
<script type="text/javascript" src="search/index-3.js"><!----></script>
<script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
</script>
<script type="text/javascript" src="../common/ga.js"><!----></script>
<script language="javascript" src="/js/common.js"></script>
<link rel="stylesheet" href="../common/css/googlecode.css">
<script src="../common/highlight.pack.js"></script>
</head>
<body>
<!----><script type="text/javascript"><!--
hljs.initHighlightingOnLoad();
HeaderName = 'Глава 2. Архитектура ядра и критически важные компоненты';
PrevRef = 'Ch01.html';
UpRef = 'index.html';
NextRef = 'Ch03.html';//-->
</script>
<!----><script type="text/javascript" src="HeaderAndToolbar.js">
</script><script type="text/javascript"><!--
document.write(HeaderAndToolbar); //-->
</script>
<div id="content">
 <div class="part">
  <div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title">
   Часть 1. Разработка успешного развёртывания XenServer</h1>
  </div></div></div>
  <div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title">
   Глава 2. Архитектура ядра и критически важные компоненты</h1>
  </div></div></div>

  <div class="toc"><p><strong>Содержание</strong></p>
   <dl>
   <dt><span class="chapter"><a href="Ch02.html">2. Архитектура ядра и критически важные компоненты</a></span></dt>
   <dd><dl>
	 <dt><span class="section"><a href="Ch02.html#01">XenServer это не Linux, но dom0 это он</a></span></dt>
     <dd><dl>
	  <dt><span class="section"><a href="Ch02.html#0101">Архитектура интерфейса</a></span></dt>
     </dl></dd>
	 <dt><span class="section"><a href="Ch02.html#02">XenCenter: графический инструмент управления Xen</a></span></dt>
	 <dt><span class="section"><a href="Ch02.html#03">Процессы ядра</a></span></dt>
     <dd><dl>
	  <dt><span class="section"><a href="Ch02.html#0301">XAPI</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0302">xhad</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0303">xenopsd</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0304">xcp-rdd</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0305">xcp-networkd</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0306">SM</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0307">perfmon</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0308">mpathalert</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0309">snapwatchd</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0310">stunnel</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0311">xenconsoled</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0312">xenstored</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0313">squeezed</a></span></dt>
     </dl></dd>
	 <dt><span class="section"><a href="Ch02.html#04">Критически важные файлы настройки</a></span></dt>
     <dd><dl>
	  <dt><span class="section"><a href="Ch02.html#0401">/boot/extlinux.conf</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0402">/etc/hosts</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0403">/etc/hostname</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0404">/etc/multipath.conf</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0405">/etc/resolv.conf</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0406">/etc/iscsi/initiatorname.iscsi</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0407">/etc/xensource/</a></span></dt>
     </dl></dd>
	 <dt><span class="section"><a href="Ch02.html#05">Взаимосвязь объектов XenServer</a></span></dt>
     <dd><dl>
	  <dt><span class="section"><a href="Ch02.html#0501">Объекты сетевой среды</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0502">Объекты GPU</a></span></dt>
	  <dt><span class="section"><a href="Ch02.html#0503">Объекты хранения</a></span></dt>
     </dl></dd>
   </dl></dd>
   </dl>
  </div>
  <p></p>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="01"> </a>XenServer это не Linux, но dom0 это он</h3>
   </div></div></div>
   <p>Легко возникает ошибочное мнение, что XenServer является Linux, так как из установки с доступом к пространству 
   привилегированного пользователя всё выглядит, ощущается и обустраивается во многом похоже на стандартное 
   окружение Linux. Применяется начальный загрузчик <span class="term"><strong class="userinput"><code>extlinux</code></strong></span>, 
   а установщик применяет схожий диалог для интерактивной настройки и пост- установки. Администратор завершает тем, 
   что регистрируется в операционной системе Linux как привилегированный пользователь с именем 
   <span class="term"><strong class="userinput"><code>root</code></strong></span>.</p>
   <p>Пост- установка, когда уже запущен гипервизор Xen, конкретизируется привилегированной ВМ, называемой 
   управляющим доменом, или обычно имеющим обозначение <span class="term"><strong class="userinput">dom0</strong></span>.
   Этот управляющий домен является ВМ Linux со специально настроенным ядром и модифицированном CentOS на основе 
   очень маленького отпечатка. С точки зрения администратора, <span class="term"><strong class="userinput">dom0</strong></span> 
   может рассматриваться как реальная ВМ с очень высокими привилегиями, которая ответственна за операции ядра 
   в рамках виртуализации на основе Xen.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="1" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25">
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Домен управления и dom0</th></tr><tr><td align="left" valign="top">
	   <p>На протяжении всей этой книги, ссылка на самый привилегированный уровень программного обеспечения, который 
	   содействует виртуализации ВМ будет называться либо управляющим доменом (control domen), либо 
	   <span class="term"><strong class="userinput">dom0</strong></span>. Хотя оба понятия технически верны для описания 
	   послезагрузочной среды которую вы будете администрировать, более важно установить, что оба этих термина являются 
	   идентификаторами, применяемыми взаимозаменяемо в решении виртуализации XenServer.</p></td></tr></table>
     </div>
   <p>Если вы знакомы с системами на основе Linux, выполняющими решения виртуализации с открытым исходным кодом, 
   например, CentOS с установленным KVM, вашим первым инстинктом вероятно может быть зарегистрироваться: 
   попытаться настроить установку XenServer изнутри управляющего домена. Вы также можете ожидать, что XenServer 
   автоматически примет любые выполненные вами с элементами ядра изменения настройки в любом стиле Linux, например, 
   системы хранения и сетевой среды. А для тех, кто в прошлом работал с VMware vSphere, такая среда Linux может 
   показаться аналогичной служебной консоли.</p>
   <p>Момент, который мы отмечаем здесь, состоит в том, что XenServer не является Linux -ом, в то время как 
   <span class="term"><strong class="userinput">dom0</strong></span> именно им и является, не требует экспертных 
   знаний Linux. Время от времени внутри <span class="term"><strong class="userinput">dom0</strong></span> 
   будут требоваться изменения в файлах настройки Linux, и мы хотим вас предостеречь от превращения вашей 
   жизни администратора в более сложную, чем она того действительно требует. Ваш управляющий домен для 
   XenServer имеет очень богатый интерфейс командной строки; и, там где изменения могут потребоваться, 
   они будут обсуждаться в этой книге.</p>
   <p>Те, кто знаком с Linux, могут столкнуться с ситуацией, при которой, по всей видимости, оказывается, что 
   отсутствуют команды и пакеты. Если вы, например, попытаетесь выполнить <span class="term"><code>yum 
   update</code></span>, вы быстро обнаружите, что репозиторий <span class="term"><code>yum</code></span> 
   указывает в пустое место. Может показаться заманчивым указать утилите управления пакетом 
   <span class="term"><code>yum</code></span> на восходящий поток репозитория програмного обеспечения 
   CentOS или EPEL (Extra Packages for Enterprise Linux).</p>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Почему 
	  запрещён yum</th></tr><tr><td align="left" valign="top">
      <p>Управляющий домен XenServer тщательно настроен для соответствия платформе виртуализации и, как результат, 
	  установка пакетов в явном виде не предусмотрена разработкой и не сертифицирована для XenServer, поскольку 
	  может вывести из равновесия или уменьшить масштабируемость и производительность хоста XenServer. Когда при 
	  обновлении или установке изменений в случае отсутствия влияния на работу хоста, следует ожидать, что любые 
	  пакеты сторонней организации или дополнения не смогут сломать или полностью удалить, а изменения в настройках 
	  файлов XenServer не могут быть выполнены неявно без вашего участия.</p></td></tr></table>
     </div>
   <p>Теперь, когда все эти предупреждения сделаны, перечислим совершенно безопасные для среды XenServer 
   операции Linux:</p>
   <div class="defedlist">
   <dt><span class="emphasis"><em>Применение любой команды <span class="term"><code>xe</code></span></em></span></dt>
   <dd><dl>
	Если команда выполняется как часть сценария, убедитесь, что вы сделали резервную копию этого сценария, так как 
	обновление XenServer может переписать или удалить его. На протяжении этой книги мы будем предоставлять инструкции 
	на основе команд <span class="term"><code>xe</code></span>.</dl></dd>
   <dt><span class="emphasis"><em>Интерактивное выполнение любой команды Linux, которая опрашивает информацию 
   о вашей системе Linux</span></dt>
   <dd><dl>
	Важно отметить, что некоторые команды могут иметь более богатяе эквиваленты XenServer. Исключительным 
	примером является <span class="term"><code>top</code></span>. Хотя эта утилита и доступна как часть 
	пользовательского пространства в XenServer, предоставляемая ею информация относится к процессам Linux 
	выполняющимся в <span class="term"><strong class="userinput">dom0</strong></span>; никакой статистики 
	для виртуальной машины или физического хоста. Утилита <span class="term"><code>xentop</code></span> 
	является эквивалентом XenServer, который предоставляет более богатую информацию по работающим в системе 
	пользователям ВМ, причём также выполняется в <span class="term"><strong class="userinput">dom0</strong></span>.
	В тексте книги вы найдёте ссылки на расширенные команды, которые вы, как администратор, найдёте 
	решающими специфические задачи.</dl></dd>
   <dt><span class="emphasis"><em>Прямое изменение файлов настройки, которые XenServer отслеживает 
   в явном виде</em></span></dt>
   <dd><dl>
	Точным примером такого файла настройки является <span class="term"><code><em>/etc/multipath.conf</em></code></span>.
	Так как <span class="term"><strong class="userinput">dom0</strong></span> является дистрибутивом CentOS, 
	он также содержит поддержку для большинства подобных устройств, которые были бы эквивалентов в системе 
	CentOS. Если вы хотите соединить устройство хранения iSCSI множеством путей, вы, скорее всего, захотите 
	изменить <span class="term"><code><em>/etc/multipath.conf</em></code></span> и добавить аппаратно- 
	специфическую информацию о настройке. {<span class="emphasis"><em>Прим. пер.: в качестве примера 
	см. раздел <a class="link" href="http://onreader.mdl.ru/AdvancedZFS/content/Ch06.html#04" 
	target="_top">Множество путей SAS</a></em></span> нашего перевода книги ZFS для профессионалов.}</dl></dd>
   </div>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0101"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Архитектура интерфейса </span></h4>
   </div></div></div>
   <p>Первой виртуальной машиной является<span class="term"><strong class="userinput">dom0</strong></span> и, 
   как уже обсуждалось, <span class="term"><strong class="userinput">dom0</strong></span> является привилегированным 
   доиеном. Непривилегированные домены называются <span class="term"><strong class="userinput">domU</strong></span>, 
   или, более просто &quot;гостевые ВМ&quot; или даже &quot;ВМ&quot;. Все домены управляются гипервизором, 
   который предоставляет интерфейс вычислительным службам. Для ВМ, конечно, нужно нечто большее чем просто 
   вычисления, поэтому <span class="term"><strong class="userinput">dom0</strong></span> предоставляет доступ к 
   оборудованию через драйверы устройств Linux. Драйверы устройств затем взаимодействуют с процессом XenServer, 
   тем самым предоставляя интерфейс виртуального устройства с применением модели разделённого драйвера (split-driver). 
   Такой интерфейс называется моделью разделённого драйвера (split-driver) потому, что одна часть подобного 
   драйвера существует в пределах <span class="term"><strong class="userinput">dom0</strong></span> (backend, 
   серверная часть), в то время как оставшаяся часть драйвера существует на госте (frontend, пользовательский 
   интерфейс).</p>
   <p>Модель устройства поддерживается процессом, содержащим проект Quick Emulator (QEMU). Так как гости 
   HVM и PVHM (обсуждаемые в <a class="link" href="Ch06.html" target="_top">Главе 6</a>) не содержат 
   драйверов пара- виртуализации (PV), QEMU и QEMU-dm эмулируют аспекты компонентов оборудования, подобные 
   BIOS, в дополнение к предоставлению доступу в сетевой среде и системе хранения.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="1" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25">
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">QEMU</th></tr><tr><td align="left" valign="top">
	   <p>Дополнительную информацию, относящуюся к проекту QEMU вы можете найти на сайте
	   <a class="link" href="http://wiki.qemu.org" target="_top">http://wiki.qemu.org</a>.</p></td></tr></table>
     </div>
   <p>Наконец, связывает всё вместе стек инструментов (toolstack), который для XenServer также происходит из 
   проекта Xen и называется XAPI.</p>
	<div class="figure"><a id="Fig0201"> </a>
	 <p class="title"><strong>Рисунок 2-1 Основные компоненты всех установок XenServer</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0201.jpg" width="793" height="588"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="02"> </a>XenCenter: графический инструмент управления Xen</h3>
   </div></div></div>
   <p>Когда хост XenServer установлен, он может управляться непосредственно через доступ безопасной оболочки 
   (SSH, Secure SHell) к интерфейсу командной строки (CLI). Кроме того, XenServer может также управляться с 
   применением XenCenter, графического интерфейса на базе Windows для визуализации и видеотерминального доступа 
   к одному или более хостов (<a class="link" href="Ch02.html#Fig0202" target="_top">Рисунок 2-2</a>).</p>
	<div class="figure"><a id="Fig0202"> </a>
	 <p class="title"><strong>Рисунок 2-2 Управление XenServer через командную строку или графически</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0202.jpg" width="792" height="208"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>
   <p>XenCenter предоставляет богатый пользовательский опыт для управления множеством хостов XenServer, 
   пулами ресурсов, а также инфраструктурой виртуальных машин связанных с ними. В то время как прочие инструменты 
   с открытым исходным кодом и выпускаемые на коммерческой основе существуют для управления XenServer, XenCenter
   специально разрабатывается параллельно с каждой редакцией XenServer. XenCenter принимает пользовательские 
   полномочия и затем взаимодействует с XenServer применяя XenAPI.</p>
   <p>XenCenter разрабатывается обратно совместимым с наследуемыми версиями XenServer, что означает, что 
   практический опыт всегда используется в самых последних доступных XenCenter. Если вам необходима 
   определённая версия XenCenter, которая поставляется с программным обеспечением XenServer установленым 
   на данном хосте, вы можете получить её открыв веб- браузер и введя IP адрес вашего хоста XenServer.</p>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="03"> </a>Процессы ядра</h3>
   </div></div></div>
   <p>Процессы ядра XenServer являются тем, что отличает XenServer от прочих дистрибутивов на основе Xen, или 
   от прочих возможно существующих реализаций <span class="term"><strong class="userinput">dom0</strong></span>.
   Каждый из последующих процессов либо реализует ключевую функцию XenServer, ответственную за его масштабируемость, 
   или является критически важным для его безопасности.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0301"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">XAPI </span></h4>
   </div></div></div>
   <p>XAPI является интерфейсом инструментального стека ядра и раскрывает API управления Xen. Он отвечает за 
   координацию всей работы по всему окружению XenServer и взаимодействует напрямую с большинством критичных 
   компонентов.</p>
   <p>XAPI также отвечает на запросы HTTP по порту 80 для предоставления доступа к выгрузке установщика 
   XenCenter.</p>
   <p>Относящиеся к XAPI данные журнала могут быть найдены либо в <span class="term"><code><em>/var/log/xensource.log</em></code></span>, 
   либо в <span class="term"><code><em>/var/log/audit.log</em></code></span>. Эти журналы в особенности существенны, 
   когда инструменты администрирования, такие как XenCenter, применяют XAPI для управления инфраструктурой 
   XenServer.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="1" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25">
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Документация XAPI</th></tr><tr><td align="left" valign="top">
	   <p>XAPI и его API, а также API управления Xen документированы на сайте
	   <a class="link" href="http://xapi-project.github.io/" target="_top">http://xapi-project.github.io/</a>.</p></td></tr></table>
     </div>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0302"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">xhads </span></h4>
   </div></div></div>
   <p><span class="term"><strong class="userinput"><code>xhad</code></strong></span> является демоном высокой 
   доступности (HA, High Availability) XenServer. Он автоматически запускается если хост XenServer находится в 
   пуле, в котором включена высокая доступность (HA). Этот процесс отвечает за всю активность задающих тактов 
   (heartbeat) и обмен информацией задающих тактов с прочими серверами- участниками для определения того, 
   какой из хостов определённо отказал согласно отказу таймера сторожевого устройства (watchdog) и последующему 
   ограждению (fencing) хоста. {<span class="emphasis"><em>Прим. пер.: подробнее об ограждении 
   см. в наших переводах статьи <a class="link" href="http://onreader.mdl.ru/ProxmoxCookbook/content/Fencing.html" 
   target="_top">pve.proxmox.com/wiki/Fencing</a> и <a class="link" 
   href="http://onreader.mdl.ru/ProLinuxHAClustering/content/Ch05.html" target="_top">Главы 5</a> 
    Построение кластеров высокой доступности Linux для профи. Сандер ван Вуг, Apress, 2014</em></span>}.</p>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Высокая 
	  доступность</th></tr><tr><td align="left" valign="top">
      <p>Настоятельно рекомендуется чтобы развёртывание XenServer, применяющее HA, имело по крайней мере 
	  три хоста XenServer в пределах настроек пула. Хотя и возможно разрешить HA с двумя хостами, приоритеность 
	  задающих тактов будет определяться на основе единственного идентификатора хоста XenServer.</p></td></tr></table>
     </div>
   <p>Поскольку XAPI является критическим компонентом работы, <span class="term"><strong class="userinput"><code>xhad</code></strong></span> 
   выполняется как сторожевое устройство (watchdog) XAPI при включённом HA. Если выясняется, что XAPI отказал, 
   <span class="term"><strong class="userinput"><code>xhad</code></strong></span> перезапустит его. HA всегда 
   должен настраиваться командами XAPI, а получающиеся в результате настройки сохраняются на каждом хосте в 
   <span class="term"><code><em>/etc/xensource/xhad.conf</em></code></span>.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>xhad</code></strong></span> данные 
   журнала могут быть найдены в <span class="term"><code><em>/var/log/xha.log</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0303"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">xenopsd </span></h4>
   </div></div></div>
   <p>Демон операций Xen, <span class="term"><strong class="userinput"><code>xenopsd</code></strong></span> 
   (Xen Operations daemon), ответственен за управление жизнедеятельностью гостевой ВМ при предоставлении 
   разделения между процессами управления (XAPI) и виртуализации (Xen). Как только гостевая ВМ создаётся или 
   запускается, порождается процесс <span class="term"><strong class="userinput"><code>xenopsd</code></strong></span>: 
   он отвечает за управление задачами нижнего уровня для этой гостевой ВМ, такие как манипуляция ресурсами и сбор 
   статистики использования ресурса для <span class="term"><strong class="userinput">dom0</strong></span>.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>xenopsd</code></strong></span> данные 
   журнала могут быть найдены в <span class="term"><code><em>/var/log/xensource.log</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0304"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">xcp-rdd </span></h4>
   </div></div></div>
   <p><span class="term"><strong class="userinput"><code>xcp-rrdd</code></strong></span> является демоном, 
   который разработан для приёма и подстановки данных карусельным (round-robin) образом, которые хранятся в 
   циклической (round-robin) базе данных. Этот демон получает метрики от 
   <span class="term"><strong class="userinput"><code>xenopsd</code></strong></span> в зависимости от используемого 
   гостевой ВМ ресурса. Примерами подобных статистик являются дисковые IOPS, загрузка ЦПУ, а также использование 
   сетевых ресурсов. Когда применяется технология NVIDIA GRID GPU или сквозного пропуска (pass-through) vGPU, 
   также собираются метрики и для этих рабочих нагрузок. Данная информация в последствии распространяется назад 
   к администратору - по запросу, например, из XenCenter - для просмотра как текущей производительности так и 
   исторических данных о ней для гостевых ВМ.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>xcp-rrdd</code></strong></span> данные 
   могут быть найдены в обоих журналах <span class="term"><code><em>/var/log/xcp-rrdd-plugins.log</em></code></span> 
   и <span class="term"><code><em>/var/log/xensource.log</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0305"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">xcp-networkd </span></h4>
   </div></div></div>
   <p>Этот демон за мониторинг и отчёты по сетевым интерфейсам XenServer, например для сетевой среды с 
   виртуальными мостами.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0306"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">SM </span></h4>
   </div></div></div>
   <p>SM является менеджером хранения (storage manager) и отвечает за отображение поддерживаемых решений 
   хранений в XAPI в качестве репозиториев хранения, подключения виртуальных устройств хранения к репозиторям 
   хранения, а также для обработки операций хранения подобных миграции хранилищ и снимков.</p>
   <p>Существенные для менеджера хранения данные журнала могут быть найдены в 
   <span class="term"><code><em>/var/log/SMlog</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0307"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">perfmon </span></h4>
   </div></div></div>
   <p><span class="term"><strong class="userinput"><code>perfmon</code></strong></span> является демоном, который 
   отслеживает производительность и статистики <span class="term"><strong class="userinput">dom0</strong></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0308"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">mpathalert </span></h4>
   </div></div></div>
   <p><span class="term"><strong class="userinput"><code>mpathalert</code></strong></span> отправляет уведомления
   XenServer или другому интерфейсу управления, опрашивающему сообщения для XAPI когда возникают задачи хранения 
   относящиеся ко множеству путей. Это полезный инструмент для определения проблем сетевой среды для определённых 
   типов систем хранения, а также предотвращать единые точки отказа, например, когда один путь упал и не 
   возвращается назад в рабочее состояние.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>mpathalert</code></strong></span> данные 
   журнала могут быть найдены в <span class="term"><code><em>/var/log/daemon.log</em></code></span> и 
   <span class="term"><code><em>/var/log/messages</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0309"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">snapwatchd </span></h4>
   </div></div></div>
   <p>Демон <span class="term"><strong class="userinput"><code>snapwatchd</code></strong></span> отвечает за 
   вызов , мониторинг и ведение журналов для процессов, связанных со снимками ВМ. Информация, подобная состоянию 
   виртуального диска поддерживается синхронной, позволяя XAPI отслеживать любые изменения для диска гостевой ВМ 
   или связанных снимков.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>snapwatchd</code></strong></span> 
   данные журнала могут быть найдены в <span class="term"><code><em>/var/log/SMlog</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0310"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">stunnel </span></h4>
   </div></div></div>
   <p><span class="term"><strong class="userinput"><code>stunnel</code></strong></span>, или безопасный 
   туннель (secure tunnel), применяется для шифрования различных форм обмена между действительными или 
   виртуальными точками с применением Open SSL. Соединения клиента с гостевыми ВМ, например, такие как
   <span class="term"><strong class="userinput"><code>vncterm</code></strong></span> доступ через XenCenter, 
   усиливает <span class="term"><strong class="userinput"><code>stunnel</code></strong></span> чтобы 
   гарантировать, что такие типы сеансов сохраняются раздельными и безопасными.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>stunnel</code></strong></span> 
   данные могут быть найдены в журналах <span class="term"><code><em>/var/log/secure</em></code></span> и 
   <span class="term"><code><em>/var/log/xensource.log</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0311"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">xenconsoled </span></h4>
   </div></div></div>
   <p>Запись и регистрация активности на основе консоли, включая гостевые и управляющие консоли, обрабатываеются
   <span class="term"><strong class="userinput"><code>xenconsoled</code></strong></span>.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>xenconsoled</code></strong></span> 
   данные могут быть найдены в журналах <span class="term"><code><em>/var/log/xen/</em></code></span> и 
   <span class="term"><code><em>/var/log/daemon.log</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0312"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">xenstored </span></h4>
   </div></div></div>
   <p>Демон <span class="term"><strong class="userinput"><code>xenstored</code></strong></span> является базой 
   данных, которая расположена на <span class="term"><strong class="userinput">dom0</strong></span>. 
   Он предоставляет операции нижнего уровня, такие как виртуалная память, совместно применяемая память, а также 
   интерфейсы XenBus для общих операций ввода/ вывода. XenBus предоставляет абстрактную шину устройства, 
   аналогичную PCI, которая делает возможным взаимодействие между гостевыми ВМ и <span class="term"><strong class="userinput">dom0</strong></span>.
   Драйверы устройств взаимодейтсвуют с базой данных настроек <span class="term"><strong class="userinput"><code>xenstored</code></strong></span> 
   для выполнения действий устройства, таких как &quot;poweroff&quot; &quot;reboot&quot; являющихся результатом 
   работы ВМ.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>xenstored</code></strong></span> 
   данные могут быть найдены в журналах <span class="term"><code><em>/var/log/xenstored-access.log</em></code></span> и 
   <span class="term"><code><em>/var/log/xensource.log</em></code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0313"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">squeezed </span></h4>
   </div></div></div>
   <p><span class="term"><strong class="userinput"><code>squeezed</code></strong></span> является процессом 
   <span class="term"><strong class="userinput">dom0</strong></span>, ответственным за управление динамической памятью 
   в XenServer. XAPI вызывает <span class="term"><strong class="userinput"><code>squeezed</code></strong></span> 
   чтобы определить, может ли быть запущена гостевая ВМ. И наоборот,  <span class="term"><strong 
   class="userinput"><code>squeezed</code></strong></span> отвечает за взаимодействие с каждой 
   выполняемой гостевой ВМ чтобы гарантировать ей достаточный объём памяти, а также может возвращать память хоста, 
   XenServer, который должен потенциально столкнуться с перерасходом памяти хоста.</p>
   <p>Существенные для <span class="term"><strong class="userinput"><code>squeezed</code></strong></span> 
   данные могут быть найдены в журналах <span class="term"><code><em>/var/log/xensource.log</em></code></span>
   и <span class="term"><code><em>/var/log/xenstored-access.log</em></code></span>, а также, в зависимости от 
   версии XenServer, <span class="term"><code><em>/var/log/squeezed.log</em></code></span> .</p>

  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="04"> </a>Критически важные файлы настройки</h3>
   </div></div></div>
   <p>В процессе запуска <span class="term"><strong class="userinput">dom0</strong></span> использует сценарии 
   init и XAPI для подтверждения своей настройки. Это гарантирует, что XenServer может вернуться к известному 
   правильному состоянию настройки с последующим после выхода из строя хоста, например, после перезагрузки или 
   восстановления из- за потери электропитания. Если файлы настроек Linux изменялись администратором вручную, 
   для XAPI не будет необычным переписаать эти изменения данными из своей базы данных настроек.</p>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Изменение 
	  критически важных файлов настройки</th></tr><tr><td align="left" valign="top">
      <p>В данном разделе книги файлы и каталоги приводятся исключительно для целей администрирования. Если не 
	  предписано иное, не модифицируйте и не изменяйте эти каталоги и/ или их содержимое.</p></td></tr></table>
     </div>
   <p>В случае отказа при грубой проверке настроек на здравый смысл, для обеспечения безопасного режима 
   <span class="term"><strong class="userinput">dom0</strong></span> загрузится в режим обслуживания 
   (maintenance), а ВМ не будут запущены. Если это произойдёт, потребуется административное вмешательство для 
   разрешения проблемы и приведения хоста назад в рабочее состояние. Такой режим гарантирует рабочеспособную 
   систему и проверяет целостность физического хоста, данных виртуальной машины и связанного хранилища.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0401"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/boot/extlinux.conf </span></h4>
   </div></div></div>
   <p>XenServer 6.5 применяет в качестве начального загрузчика <span class="term"><strong class="userinput"><code>extlinux</code></strong></span>: 
   производную проекта Syslinux, специально ориентированную на загрузку ядер, хранимых в файловых системах 
   на основе EXT. <a class="link" href="Ch02.html#Example0201" target="_top">Пример 2-1</a> отображает настройку 
   по умолчанию загрузки такого ядра.</p>
   <p>Такой файл настройки предоставляет инструкции на основе соглашения о метках, согласно которому настройка 
   ядра должна быть загружена с дополнительными параметрами после включения электропитания физического 
   оборудования. Метка по умолчанию (или определение ядра) применяемое для загрузки XenServer всегда снабжается 
   флажком под меткой <span class="term"><strong class="userinput"><code>xe</code></strong></span>.</p>
	 <div class="example"><a id="Example0201"> </a>
	 <p class="title"><em>Пример 2-1. Пример настройки загрузки ядра XenServer по умолчанию</em></p>
	   <pre class="screen"><code>
label xe
   # XenServer
   kernel mboot.c32
   append /boot/xen.gz mem=1024G dom0_max_vcpus=2
   dom0_mem=2048M,max:2048M watchdog_timeout=300
   lowmem_emergency_pool=1M crashkernel=64M@32M
   cpuid_mask_xsave_eax=0 console=vga vga=mode-0x0311
   --- /boot/vmlinuz-2.6-xen root=LABEL=rootenhlwylk ro
   xencons=hvc console=hvc0 console=tty0 quiet vga=785 splash
   --- /boot/initrd-2.6-xen.img
 	   </code></pre>
     </div>
   <p>Дополнительно также предлагаются настройки ядра для доступа последовательной консоли, или 
   <span class="term"><strong class="userinput"><code>xe</code></strong></span>, а также безопасное ядро, или 
   <span class="term"><strong class="userinput"><code>safe</code></strong></span>, показанные в 
   <a class="link" href="Ch02.html#Example0202" target="_top">Пример 2-2</a>. Доступ к ним может быть выполнен 
   при выполнении последовательности начальной загрузки посредством входа в 
   <span class="term"><strong class="userinput"><code>menu.c32</code></strong></span> при получении приглашения 
   на ввод <span class="term"><strong class="userinput"><code>boot: prompt</code></strong></span>.</p>
	 <div class="example"><a id="Example0202"> </a>
	 <p class="title"><em>Пример 2-2. Ядра для замены</em></p>
	   <pre class="screen"><code>
label xe-serial
   # XenServer (Serial)
   kernel mboot.c32
   append /boot/xen.gz com1=115200,8n1 console=com1,vga
   mem=1024G dom0_max_vcpus=2 dom0_mem=2048M,max:2048M
   watchdog_timeout=300 lowmem_emergency_pool=1M
   crashkernel=64M@32M cpuid_mask_xsave_eax=0 ---
   /boot/vmlinuz-2.6-xen root=LABEL=root-enhlwylk ro
   console=tty0 xencons=hvc console=hvc0 ---
   /boot/initrd-2.6-xen.img

label safe
   # XenServer in Safe Mode
   kernel mboot.c32
   append /boot/xen.gz nosmp noreboot noirqbalance acpi=off
   noapic mem=1024G dom0_max_vcpus=2 dom0_mem=2048M,max:2048M
   com1=115200,8n1 console=com1,vga ---
   /boot/vmlinuz-2.6-xen nousb root=LABEL=root-enhlwylk ro
   console=tty0 xencons=hvc console=hvc0 ---
   /boot/initrd-2.6-xen.img
 	   </code></pre>
     </div>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="1" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25">
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Изменения Dundee</th></tr><tr><td align="left" valign="top">
	   <p>Предварительный выпуск XenServer Dundee применяет в качестве загрузчика GRUB2.</p></td></tr></table>
     </div>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0402"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/etc/hosts </span></h4>
   </div></div></div>
   <p>Файл <span class="term"><code><em>hosts</em></code></span> заполняется специальным образом таким образом, 
   что определённый процесс <span class="term"><strong class="userinput">dom0</strong></span> мог разрешить любую 
   из следующих записей в пределах файла <span class="term"><code><em>hosts</em></code></span>:</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>localhost</p>
	 </li><li class="listitem">
	 <p>localhost.localdomain</p>
	 </li><li class="listitem">
	 <p>127.0.0.1</p>
	 </li>
    </ul>
    </div>
   <p>Приводимая ниже команда позволяет вам просмотр содержимого файла <span class="term"><code><em>hosts</em></code></span>:</p>
	   <pre class="screen"><code>
# cat /etc/hosts
127.0.0.1 localhost localhost.localdomain
 	   </code></pre>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0403"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/etc/hostname </span></h4>
   </div></div></div>
   <p>Файл <span class="term"><code><em>hostname</em></code></span> содержит индивидуальное имя для данного хоста, 
   которое определяется в процессе установки. Этот файл существенен только для управляющего домена пока он не 
   записан в рамках инфраструктуры DNS (Domain Name Service).</p>
   <p>В качестве примера <span class="term"><strong class="userinput"><code>hostname</code></strong></span> 
   может быть <span class="term"><code>xenified01</code></span> и храниться в 
   <span class="term"><code><em>/etc/hostname</em></code></span>:</p>
 	   <pre class="screen"><code>
# cat /etc/hostname
xenified01
 	   </code></pre>
  <p>Однако, в XenCenter этот хост получает дружественное имя, например, <span class="term"><code>XENHOST1</code></span>
  для целей визуализации, как показано на <a class="link" href="Ch02.html#Fig0203" target="_top">Рисунке 2-3</a>.</p>
	<div class="figure"><a id="Fig0203"> </a>
	 <p class="title"><strong>Рисунок 2-3 Имя хоста может оставаться тем же самым при отображении дружественного 
	 имени в пределах XenCenter</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0203.jpg" width="560" height="187"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0404"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/etc/multipath.conf </span></h4>
   </div></div></div>
   <p>Многие устройства хранения предлагают для хоста подобного XenServer возможность усиления множеством путей 
   или каналов ввода/ вывода для целей хранения. XenServer поддерживает настройки хранения которые применяют 
   множество путей. такая поддержка предоставляется средством отображения множества путей устройств 
   (DM-MP, device mapper multipathing), а информация о настройке сохраняется в <span class="term"><code><em>/etc/multipath.conf</em></code></span>. 
   Файл <span class="term"><code><em>/etc/multipath.conf</em></code></span> по умолчанию охватывает широкий 
   диапазон современных устройств хранения, гарантируя, что XenServer хост может применять для хранилища 
   избыточность, отказоустойчивость, а также агрегацию для поддержки решений хранения.</p>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Не 
	  изменяйте multipath.conf не имея руководства</th></tr><tr><td align="left" valign="top">
      <p>Хотя <span class="term"><strong class="userinput">dom0</strong></span> может выглядеть как 
	  стандартный дистрибутив CentOS, изменение <span class="term"><code><em>/etc/multipath.conf</em></code></span>
	  в соответствии с примерами Linux, найденными в интернете, может легко неблагоприятно воздействовать на 
	  стабильность и производительность системы. Всегда изменяйте <span class="term"><code><em>/etc/multipath.conf</em></code></span>
	  под руководством технической поддержки Citrix или своего производителя аппаратных средств.</p></td></tr></table>
     </div>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0405"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/etc/resolv.conf </span></h4>
   </div></div></div>
   <p>Файл <span class="term"><code><em>resolve.conf</em></code></span> содержит записи DNS для XenServer, котрые 
   были определены в процессе установки (обсуждается в <a class="link" href="Ch03.html" target="_top">Главе 3</a>), 
   а также изменяться в XenCenter или командой XAPI. Хотя этот файл может быть изменён вручную в случае устранения 
   проблемы с разрешением имени, при перезагрузке настройка XAPI перезапишет любые выполненные в этом файле 
   изменения с целью поддержки верных установок сервера DNS, настроенных через XenCenter или при помощи 
   инструмента командной строки <span class="term"><code>xe</code></span>.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0406"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/etc/iscsi/initiatorname.iscsi </span></h4>
   </div></div></div>
   <p>Для содействия соединению использующих технологию на основе iSCSI хранилищ установлен Open-iSCSI. В 
   процессе установки вырабатывается уникальный iSCSI Qualified Name (IQN) для каждого хоста XenServer, и 
   сохраняется, в каждом хосте XenServer, в <span class="term"><code><em>/etc/iscsi/initiatorname.iscsi</em></code></span>.</p>
   <p>Когда администратор пытается ограничить функциональность хранилища iSCSI для определённого хоста, 
   его IQN может быть определён в хосте XenServer как это показано в <a class="link" href="Ch02.html#Example0203" 
   target="_top">Примере 2-3</a>.</p>
	 <div class="example"><a id="Example0203"> </a>
	 <p class="title"><em>Пример 2-3. Определение IQN XenServer -а</em></p>
	   <pre class="screen"><code>
# cat /etc/iscsi/initiatorname.iscsi
InitiatorName=iqn.1994-05.com.redhat:dc785c10706
 	   </code></pre>
     </div>
   <p>Вывод предоставляет IQN и может он затем быть добавлен в белый список инициатора на устройстве хранения. 
   Если выполнена переустановка XenServer, это значение будет изменено и все хосты iSCSI потребуют обновления 
   своих белых списков на новое, вырабатываемое случайным образом, IQN.</p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0407"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">/etc/xensource/ </span></h4>
   </div></div></div>
   <p>По линии стандартных соглашений Linux многие файлы &quot;настроек&quot; связаны с Xen, XenServer и прочими 
   процессами ядра XAPI хранимыми здесь. Большая часть этих файлов вырабатывается при установке, обновляясь из 
   инструментов на основе Xen, а также в некоторых случаях создаваемых когда администратор XenServer делает 
   доступной определённую функциональность.</p>

   	 <a id="040701"> </a>
	 <p class="title"><strong>boot_time_cpus</strong></p>
     <p>Заполняется при каждой загрузке и содержит иформацию, относящуюся к сокетам физического хоста и числу 
	 ядер в сокете. Для пользователей Linux это может показаться аналогичным сбросу <span class="term"><code>cpuinfo</code></span>, 
	 который может быть обнаружен в <span class="term"><code><em>/proc/</em></code></span> выполняющейся 
	 файловой системы. <a class="link" href="Ch02.html#Example0204" target="_top">Примере 2-4</a> отображает 
	 команду для просмотра содержимого файла <span class="term"><code><em>boot_time_cpus</em></code></span>. Эта 
	 информация не только сохраняется в этом файле, но также известна <span class="term"><strong class="userinput">dom0</strong></span>. 
	 И наоборот, база данных XAPI обновляется этой информацией и распространяется в одноранговой сети в которой 
	 данный хост является участником пула XenServer.</p>
	 <div class="example"><a id="Example0204"> </a>
	 <p class="title"><em>Пример 2-4. Просмотр boot_time_cpus</em></p>
	   <pre class="screen"><code>
# cat /etc/xensource/boot_time_cpus
 	   </code></pre>
     <p>Чтобы сравнить точность этого файла относительно <span class="term"><code><em>/proc/</em></code></span> 
	 в файловой системе на основе Linux для <span class="term"><strong class="userinput">dom0</strong></span> 
	 (заполняемого при выполнении), исполните команду приведённую в <a class="link" href="Ch02.html#Example0205" 
	 target="_top">Примере 2-5</a>.</p>
	 <div class="example"><a id="Example0205"> </a>
	 <p class="title"><em>Пример 2-5. Проверка информации для ЦПУ и её точности</em></p>
	   <pre class="screen"><code>
# diff /etc/xensource/boot_time_cpus /proc/cpuinfo
 	   </code></pre>
     <p>В обычном случае вывод должен отсутствовать или, что то же самое, нет разницы между 
	 <span class="term"><code><em>/proc/cpuinfo</em></code></span>  и 
	 <span class="term"><code><em>/etc/xensource/boot_time_cpus</em></code></span>. Поскольку приводимое 
	 вырабатывается <span class="term"><strong class="userinput">dom0</strong></span> после загрузки хоста и 
	 начала выполнения ядром Xen своего процесса загрузки, любая разница между этими файлами будет определять 
	 существенное нарушение настройки.</p>

   	 <a id="040702"> </a>
	 <p class="title"><strong>/etc/xensource/bugtool/</strong></p>
     <p>Каталог <span class="term"><code><em>bugtool</em></code></span> имеет несколько подкаталогов и файлов 
	 XML, которые определяют сферу, атрибуты и пределы для вывода данных относящихся к встроенному 
	 инструментарию XenServer определения ошибок. Эти файлы определяют инструментам максимальный размер 
	 вывода и прочие критерии необходимые для дампа ядра при его крахе (или отчётов о состоянии сервера) для 
	 доступа, продвижения и хранения данных, необходимых при условиях возникновения ошибок.</p>

   	 <a id="040703"> </a>
	 <p class="title"><strong>/etc/xensource/db.conf</strong></p>
     <p>Этот файл совместно со слегка более длинной версией с именем 
	 <span class="term"><code><em>db.conf.rio</em></code></span> описывает следующую информацию настройки 
	 базы данных XenServer:</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>Где найти базу данных XAPI</p>
	 </li><li class="listitem">
	 <p>Формат, необходимый для применения, при чтении этой базы данных</p>
	 </li><li class="listitem">
	 <p>Вменяемая информация относящаяся к использованию сеанса и обоснованности</p>
	 </li>
    </ul>
    </div>

   	 <a id="040704"> </a>
	 <p class="title"><strong>/etc/xensource/installed-repos/</strong></p>
     <p>Каталог <span class="term"><code><em>installed-repos</em></code></span> содержит подкаталоги, которые, 
	 либо из новой установки, или из обновления, отображают список применявшихся при установке репозиториев для 
	 этого хоста. Если установлены дополнительные пакеты, они также будут отображены в 
	 <span class="term"><code><em>installed-repos</em></code></span>; а в процессе обновления вы будете 
	 уведомлены о присутствии такого дополнительного пакета. Это гарантирует то, что если установка зависит от 
	 определённого дополнительного пакета в процессе установки администратор сможет проверить и получить 
	 соответствующую замену.</p>

   	 <a id="040705"> </a>
	 <p class="title"><strong>/etc/xensource/master.d/</strong></p>
     <p>Этот каталог может содержать один или более сценариев уровня инициализации, которые применяются в 
	 процессе инициализации хоста. Кроме того, предоставляется пример сценария уровня инициализации, что 
	 является хорошей справочной информацией для администратора, иллюстрирующей поток активности уровня 
	 выполнения, последовательности инициализации и вызова ресурсов. Этот пример сценария должен иметь 
	 имя <span class="term"><code><em>01-example</em></code></span>, однако, если он отсутствует в вашей 
	 системе, это нормально.</p>
     <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
	   <table border="1" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25">
	   <img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Изменения Dundee</th></tr><tr><td align="left" valign="top">
	   <p>XenServer Dundee имеет домен управления на базе CentOS 7. CentOS 7 имеет изменённую модель 
	   <span class="term"><code>systemd</code></span> для инициализации. эта модель отличается в основном тем, как 
	   выполняются сценарии уровня инициализации. Если у вас установлены агенты управления или пользовательские 
	   сценарии, пожалуйста, проверьте их, они могут не работать в среде <span class="term"><code>systemd</code></span>, 
	   поскольку они были сделаны ранее.</p></td></tr></table>
     </div>

   	 <a id="040706"> </a>
	 <p class="title"><strong>/etc/xensource/network.conf</strong></p>
     <p>Файл <span class="term"><code><em>network.conf</em></code></span> описывает для администратора какой 
	 тип сетевой среды коммутации применяется хостом XenServer. <a class="link" href="Ch02.html#Example0206" 
	 target="_top">Пример 2-6</a> показывает команду для просмотра этого файла. Существует два 
	 синтаксических параметра: <span class="term"><strong class="userinput"><code>bridge</code></strong></span> 
	 или <span class="term"><strong class="userinput"><code>openvswitch</code></strong></span>.
	 <span class="term"><strong class="userinput"><code>bridge</code></strong></span> соответствует 
	 наследуемому из Linux мосту сетевой среды, в то время как 
	 <span class="term"><strong class="userinput"><code>openvswitch</code></strong></span> соответствует 
	 Open Virtual Switch или <span class="term"><strong class="userinput"><code>ovs</code></strong></span>.
	 Сетевой средой по умолчанию является <span class="term"><strong class="userinput"><code>ovs</code></strong></span>, 
	 применяемая для всех установок начиная с XenServer 6.0, однако, если обновляется более ранняя система, 
	 то всё ещё  на месте может оказаться мост Linux. Важно отметить, что новая сетевая функциональность 
	 будет разрабатываться только для <span class="term"><strong class="userinput"><code>ovs</code></strong></span>, 
	 в то время, как в некоторый момент мост Linux может быть отправлен в оставку.</p>
	 <div class="example"><a id="Example0206"> </a>
	 <p class="title"><em>Пример 2-6. Просмотр network.conf</em></p>
	   <pre class="screen"><code>
# cat /etc/xensource/network.conf
 	   </code></pre>
     <p>Вывод будет либо состоянием &quot;bridge&quot;, либо &quot;openvswitch&quot;, но это мощная часть 
	 информации, которую необходимо иметь - в особенности при диагностике проблем пула XenServer с виртуальной 
	 сетевой средой коммутации или если есть вопросы к &quot;лежащей в основе сетевой среде&quot;. Более того,
	 существуют некоторые сторонние продукты Citrix, которые могут потребовать чтобы эта виртуальная сетевая 
	 среда коммутации была того или другого типа. Если вы определили, что некоторый хост требует необходимости 
	 переключения виртуальной сетевой среды коммутации, обеспечьте останов всех гостевых машин (или миграцию 
	 на другой хост XenServer) и выполните команду, приведённую в <a class="link" href="Ch02.html#Example0207" 
	 target="_top">Примере 2-7</a>.</p>
	 <div class="example"><a id="Example0207"> </a>
	 <p class="title"><em>Пример 2-7. Изменение основы сетевой среды</em></p>
	   <pre class="screen"><code>
# xe-switch-network-backend {bridge | openvswitch}
 	   </code></pre>
     <p>Хост должен быть перегружен, а после перезагрузки будет выполнять сетевые операции предписанным 
	 образом.</p>

   	 <a id="040707"> </a>
	 <p class="title"><strong>/etc/xensource/pool.conf</strong></p>
     <p>Другой ключевой файл для поиска неисправностей, <span class="term"><code><em>pool.conf</em></code></span>
	 применяется в случае, когда хост является изолированным сервером, главой пула (master, инваче: основным, 
	 primary), или ведомым (slave, участником пула, предоставляющим отчёты главному XenServer). Этот файл 
	 может иметь два значения: <span class="emphasis"><em>master</em></span> или 
	 <span class="emphasis"><em>slave</em></span>.</p>
     <p>Применяя команду <span class="term"><code>cat</code></span>, как проиллюстрировано в 
	 <a class="link" href="Ch02.html#Example0208" target="_top">Примере 2-8</a>, можно определить из 
	 содержимого <span class="term"><code><em>pool.conf</em></code></span> полагает ли хост XenServer себя 
	 участником <span class="emphasis"><em>master</em></span> или <span class="emphasis"><em>slave</em></span>.</p>
	 <div class="example"><a id="Example0208"> </a>
	 <p class="title"><em>Пример 2-8. Определение роли хоста</em></p>
	   <pre class="screen"><code>
# cat /etc/xensource/pool.conf
 	   </code></pre>
     <p>Если результат команды <span class="emphasis"><em>master</em></span>, то хост играет роль главы пула. Если 
	 результат команды содержит слово <span class="emphasis"><em>slave</em></span>, хост является сервером участником, 
	 а также предоставляется IP адрес главы (master) пула. При работе в качестве стандартного хоста XenServer 
	 (т.е. когда он не является совсем частью пула), обособленный хост будет полагать, что он выполняет роль 
	 <span class="emphasis"><em>master</em></span>.</p>
     <p>Этот файл следует изменять вручную только в случае серъёзных разрушений, причём только под руководством 
	 команды поддержки XenServer. Примеры подобных разрушений включают:</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>Разрешена высокая доступность (HA) в случае, когда она должна быть отключена, например, в случае 
	 обслуживания</p>
	 </li><li class="listitem">
	 <p>Проблемы во взаимодействии в сетевой среде межу участниками пула</p>
	 </li><li class="listitem">
	 <p>Выход за пределы памяти <span class="term"><strong class="userinput">dom0</strong></span></p>
	 </li><li class="listitem">
	 <p>Возбуждаемые латентностью при выборе нового главы (master) пула</p>
	 </li><li class="listitem">
	 <p>Доступная целиком только для чтения корневая файловая система</p>
	 </li><li class="listitem">
	 <p>Устаревший или доступный только для чтения файл PID</p>
	 </li>
    </ul>
    </div>

   	 <a id="040708"> </a>
	 <p class="title"><strong>/etc/xensource/ptoken</strong></p>
     <p>Файл <span class="term"><code><em>ptoken</em></code></span> применяется для безопасности, наряду с 
	 SSL, в пулах XenServer для дополнительной безопасности во взаимодействиях участников пула.</p>

   	 <a id="040709"> </a>
	 <p class="title"><strong>/etc/xensource/scripts/</strong></p>
     <p>Каталог <span class="term"><code><em>scripts</em></code></span> содержит один или более сценариев уровня 
	 инициализации, во многом аналогично каталогу <span class="term"><code><em>master.d</em></code></span>.</p>

   	 <a id="040710"> </a>
	 <p class="title"><strong>/etc/xensouce/xapi-ssl.conf</strong></p>
     <p>XenAPI выставляется через порт 433, однако необходима соответствующая аутентификация для выполнения API 
	 или запроса к нему. В добавление к аутентификации необходим обмен сертификатом личного (private) ключа 
	 для подтверждения источнику защищать дальнейшее взаимодействие к- и от- XenServer через шифрование на 
	 основе SSL. Именно здесь принимает участие <span class="term"><code><em>xapi-ssl.conf</em></code></span>, 
	 так как он диктует шифр, метод шифрования и место хранения уникального сертификата XenServer.</p>

   	 <a id="040711"> </a>
	 <p class="title"><strong>/etc/xensouce/xapi-ssl.pem</strong></p>
     <p><span class="term"><code><em>xapi-ssl.pem</em></code></span> является личным (private) ключом, который 
	 вырабатывается при установке <span class="term"><code><em>/etc/init.d/xapissl</em></code></span>, ссылющимся 
	 на <span class="term"><code><em>xapi-ssl.conf</em></code></span> для производства уникального файла PEM 
	 (Privacy-Enhanced Mail) хоста XenServer. Этот файл является тем, что наряду с двухфакторной аутентификацией, 
	 осуществляет обмен между хостами XenServer, инструментами администрирования XenServer и т.п., чтобы обеспечить 
	 обратную и прямую безопасную связь с уникальным определённым хостом XenServer.</p>
     <p>Замена файла <span class="term"><code><em>xapi-ssl.pem</em></code></span> на подписываемый самостоятельно или 
	 подписанный сертификат обсуждается в <a class="link" href="Ch12.html" target="_top">Главе 12</a>.</p>

   	 <a id="040712"> </a>
	 <p class="title"><strong>/etc/ntp.conf</strong></p>
     <p>В нашей практике это вероятно наиболее важный из всех файлов настройки, который системный администратор 
	 может свободно изменять в любое время. Однако это также связано с тем, что любое решение для виртуализации 
	 должно обеспечивать синхронизацию всех гостевых ВМ. Файл настройки протокола сетевого времени (Network Time 
	 Protocol) - используемый <span class="term"><code>ntpd</code></span> - никогда не должен ссылаться на 
	 виртуальную машину, а всегда обязан ссылаться на локальную, физическую машину, причём число записей не 
	 должно быть более четырёх.</p>
     <p>Хотя любое решение виртуализации будет предпринимать все возможные меры по выравниванию дрейфа времени, 
	 если часы аппаратных средств испытывают сильное отставание/ убегание по времени, это может влиять 
	 на расписания, а также в конечном итоге приводить к отключению гостевых ВМ. Жизненно важно настроить 
	 <span class="term"><code><em>/etc/ntp.conf</em></code></span> должным образом, в соответствии с зоной 
	 времени с тем, чтобы хост мог соответствующим образом обновлять гостевые ВМ и их внутренние часы. 
	 Дополнительно, если хосты XenServer составляют пул, дрейф по времени между хостами должен быть сведён 
	 к минимуму, а установки NTP должны быть идентичными у всех участников пула.</p>

   	 <a id="040713"> </a>
	 <p class="title"><strong>/var/xapi/</strong></p>
     <p>Данный каталог содержит полную базу данных XAPI, которая является ссылкой на используемое 
	 оборудование в рамках обособленной установки XenServer или при установке в пуле.</p>
	 <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Информация 
	  состояния системы</th></tr><tr><td align="left" valign="top">
      <p>В пределах каталога <span class="term"><code><em>/var/xapi/</em></code></span> файлы содержат 
	  информацию состояния и никогда не должны исправляться вручную ни при каких обстоятельствах. В случае 
	  изменения может понижаться производительность виртуализации, так как база данных XAPI основывается 
	  на совместных оборудовании, объектах и зависимостях для виртуализации гостевых ВМ.</p></td></tr></table>
     </div>

   	 <a id="040714"> </a>
	 <p class="title"><strong>/var/patch/ и /var/patch/applied/</strong></p>
     <p>Эти два каталога - <span class="term"><code><em>/var/patch/</em></code></span> и 
	 <span class="term"><code><em>/var/patch/applied/</em></code></span> - чрезвычайно важны, потому что 
	 на пару они содержат отпечатки горячих исправлений, заплаток и прочих метаданных поддержки, которые 
	 являются существенными для XAPI. Вне зависимости от того, есть ли у вас работающий обособленно или 
	 в пуле XenServer, XAPI должен иметь средство, гарантирующее что приводимая ниже последовательность 
	 успешно выполняется:</p>
   <div class="orderedlist">
   <ol class="orderedlist" type="1"><li class="listitem">
     <p>Исправления применены к работающему обособленно хосту.</p>
	 </li><li class="listitem">
     <p>Исправления применены ко всем работающем в пуле хостам.</p>
	 </li><li class="listitem">
     <p>Выполнены все действия, необходимые после внесения изменений такие как, например, 
	 перезагрузка.</p>
	 </li>
   </ol>
   </div>
     <p>Теперь, когда оба каталога содержат файлы с уникальными именами файлов на базе UUID, стоит отметить, что 
	 более важным каталогом является <span class="term"><code><em>/var/patch/applied/</em></code></span>, потому 
	 что, как это следует из его названия, он содержит минимальный набор изменений, которые должны применяться 
	 к хосту.</p>
     <p>Этот каталог - <span class="term"><code><em>/var/patch/applied/</em></code></span> - никогда не 
	 следует удалять, так как он используется XAPI для проверки того, нуждаются ли члены пула в их применении, 
	 существуют ли новые горячие изменения, доступные для вашего хоста XenServer и тому подобного. Таким образом, 
	 удаление этих файлов может привести к некорректному отслеживанию хостом необходимых ему изменений.</p>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="05"> </a>Взаимосвязь объектов XenServer</h3>
   </div></div></div>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0501"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Объекты сетевой среды </span></h4>
   </div></div></div>
   <p>Исходя из проекции архитектуры, развёртывание XenServer состоит из трёх типов сетевой среды: обмена 
   основного управления, хранения и ВМ. По умолчанию сетевая среда во всех установках XenServer автоматически 
   назначается на первый доступный сетевой интерфейс и этот сетевой интерфейс становится сетевой средой 
   основного управления. Хотя все дополнительные сетевые интерфейсы могут применяться для систем хранения или 
   ВМ, а также могут агрегироваться для избыточности и потенциального повышения пропускной способности, 
   сетевая среда основного управления (primary-management network) является ключевой так как она отвечает за:</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>Предоставление доступа администратору через инструменты аутентификации, такие как XenCenter</p>
	 </li><li class="listitem">
	 <p>Осуществляет поддержку коммуникационных связей между хостами XenServer в пуле</p>
	 </li><li class="listitem">
	 <p>Договаривается о миграция ВМ в реальном времени</p>
	 </li><li class="listitem">
	 <p>Раскрывает XAPI для стороннего инструментария</p>
	 </li>
    </ul>
    </div>
   <p>Понимание взаимосвязей между сетевыми объектами XenServer является критически важным для 
   соответствующего определения сетевой топологии при развёртывании XenServer.</p>
	 <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
        <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Планирование для множества пулов</th></tr><tr><td align="left" valign="top">
        <p>Хотя мы в этой книге сосредоточены на разработке и управлении единственным пулом XenServer, если 
		ваши потребности навязывают вам множество пулов, вам следует учесть это в своём проекте. Это в частности 
		верно для инфраструктуры, которая может совместно использоваться пулами, например, сетевая среда и системы 
		хранения. Подробности по этим предметам вы можете найти в <a class="link" href="Ch05.html" 
		target="_top">Главе 5</a>.</p></td></tr></table>
      </div>

   	 <a id="050101"> </a>
	 <p class="title"><strong>pif</strong></p>
	 <p>Объект <span class="term"><strong class="userinput"><code>pif</code></strong></span> обозначает 
	 физическое сетевое оборудование, наблюдаемое в рамках 
	 <span class="term"><strong class="userinput">dom0</strong></span>. Так как <span class="term"><strong class="userinput">dom0</strong></span>
	 основывается на CentOS, сетевая среда по умолчанию будет помечена как &quot;eth0&quot; и будет назначена на 
	 IP адрес хоста XenServer. Все дополнительные сетевые среды будут представлены в виде &quot;ethX&quot;, однако 
	 только физические интерфейсы с ролями &quot;управления&quot; или &quot;хранения&quot; будут иметь назначенные 
	 IP адреса. Перечень физических сетевых интерфейсов может быть получен в командной строке, как это показано в 
	 <a class="link" href="Ch02.html#Example0209" target="_top">Примере 2-9</a>.</p>
	 <div class="example"><a id="Example0209"> </a>
	 <p class="title"><em>Пример 2-9. Какие интерфейсы настроены на хосте</em></p>
	   <pre class="screen"><code>
# xe pif-list params=all
 	   </code></pre>
     </div>

   	 <a id="050102"> </a>
	 <p class="title"><strong>Сетевая среда</strong></p>
	 <p>Поскольку XenServer обычно размещает много виртуальных машин, которые необходимо соединять с сетевой средой, 
	 создаётся виртуальная система коммутации. Каждая система коммутации объединяет мостами все хосты в пуле 
	 ресурсов XenServer и реализуется с применением Open Virtual Switch, или <span class="term"><strong 
	 class="userinput"><code>ovs</code></strong></span>. {<span class="emphasis"><em>Прим. пер.: подробнее см. раздел  
	 <a class="link" href="http://onreader.mdl.ru/LearningDockerNetworking/content/Ch03.html#0303" target="_top">Open 
	 vSwitch</a> в нашем переводе книги Изучение построения сетей Docker, Радждип Дуа, Вайбхав Кохли, Сантош Кумар Кондури, 
	 Packt Pub., февраль 2016.</em></span>} Число содержащихся в среде XenServer виртуальных коммутаторов будет 
	 изменяться и может быть очень динамичным. Перечень всех сетевых сред может быть получен в командной строке, как 
	 это отображено в <a class="link" href="Ch02.html#Example0210" target="_top">Примере 2-10</a>.</p>
	 <div class="example"><a id="Example0210"> </a>
	 <p class="title"><em>Пример 2-10. Какие сетевые среды настроены для хоста</em></p>
	   <pre class="screen"><code>
# xe network-list params=all
 	   </code></pre>
     </div>
	 <p>Логическое соединение между <span class="term"><strong class="userinput"><code>network</code></strong></span> 
	 и <span class="term"><strong class="userinput"><code>pif</code></strong></span> устанавливается в поле 
	 <span class="term"><strong class="userinput"><code>PIF-uuids</code></strong></span>.</p>

   	 <a id="050103"> </a>
	 <p class="title"><strong>vif</strong></p>
	 <p>Каждая ВМ в среде XenServer обычно имеет по крайней мере один подключённый к ней виртуальный NIC. 
	 Все такие виртуальные NIC называются <span class="term"><strong class="userinput"><code>vif</code></strong></span> 
	 и подключаются к сетевой среде коммутации. Всем <span class="term"><strong class="userinput"><code>vif</code></strong></span> 
	 XenServer -ом назначаются MAC адреса. Часто сетевые администраторы ищут имеющие идентификатор производителя 
	 MAC виртуальные NIC, чтобы впоследствии фильтровать их. Поскольку XenSerer был разработан для обработки 
	 количества ВМ, идентификатор производителя универсально администрируемого MAC адреса будет искуственно 
	 ограничивать предел построения виртуальных сетей, поэтому XenServer применяет локальное 
	 администрирование ВМ во избежание потенциальных противоречий MAC адресов.</p>
	 <p>Получаемый <span class="term"><strong class="userinput"><code>vif</code></strong></span> IP адрес 
	 устанавливается гостем и взаимодействует с XenServer через интерфейс в инструментах XenServer. Поскольку 
	 сетевая среда коммутации реализует виртуальный коммутатор, каждый <span class="term"><strong class="userinput"><code>vif</code></strong></span> 
	 подключается к <span class="term"><strong class="userinput"><code>network</code></strong></span>, которая в 
	 конечном итоге подключается к <span class="term"><strong class="userinput"><code>pif</code></strong></span> 
	 представляющему физический NIC который затем подключается к физическому коммутатору. Перечень виртуальных 
	 сетевых интерфейсов может быть найден с применением командной строки, показанной в 
	 <a class="link" href="Ch02.html#Example0211" target="_top">Примере 2-11</a>.</p>
	 <div class="example"><a id="Example0211"> </a>
	 <p class="title"><em>Пример 2-11. Текущая настройка сетевой среды настроены для всех ВМ в пуле</em></p>
	   <pre class="screen"><code>
# xe vif-list params=all
 	   </code></pre>
     </div>

   	 <a id="050103"> </a>
	 <p class="title"><strong>Связывание</strong></p>
	 <p>В качестве необязательного действия, администраторы могут настраивать отказоустойчивые элементы, называемые 
	 &quot;bond&quot;. Связывание (bonding) NIC, также называемое объединением в группы (&quot;teaming&quot;), 
	 является методом, с помощью которого два или более NIC объединяются для создания некоего логического NIC. 
	 Дополнительные сведения о связывании можно почерпнуть в разделе <a class="link" href="Ch05.html#02" 
	 target="_top">Определение топологий сетевой среды</a>. Список всех сгруппированных сетевых сред может быть 
	 определён с помощью командной строки показанной в <a class="link" href="Ch02.html#Example0212" 
	 target="_top">Примере 2-12</a></p>
	 <div class="example"><a id="Example0212"> </a>
	 <p class="title"><em>Пример 2-12. Определение текущей настройки связывания</em></p>
	   <pre class="screen"><code>
# xe bond-list params=all
 	   </code></pre>
     </div>
	 <p>Если определено группирование, все элементы настройки &quot;master&quot;, &quot;slaves&quot; и 
	 &quot;primary-slave&quot; ссылаются на объект <span class="term"><strong 
	 class="userinput"><code>pif</code></strong></span>.</p>


	 <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0502"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Объекты GPU </span></h4>
   </div></div></div>
   <p>XenServer поддерживает использование графических карт с ВМ. Физическая графическая плата может быть 
   напрямую назначена ВМ; а для определённых чипов NVIDIA и Intel, физическая карта также может быть 
   виртуализирована (использоваться как виртуальное устройство). Это позволяет совместно использовать 
   через виртуальные GPU возможности одной карты.</p>

   	 <a id="050201"> </a>
	 <p class="title"><strong>pGPU</strong></p>
     <p>Физическое графическое процессорное устройство (pGPU, physical graphical processor unit), 
	 является объектом, который представляет собой физическую видео карту, или механизм графики, 
	 которая установлена на материнской плате или является устройством PCI в физическом хосте. 
	 <a class="link" href="Ch02.html#Example0213" target="_top">Пример 2-13</a> отображает команду получения 
	 списка всех pGPU установленных в хосте, а также образец вывода результатов после выполнения этой команды.</p>
     <p>Одним из примеров pGPU является набор микросхем VGA на материнской плате, которая используется 
	 <span class="term"><strong class="userinput">dom0</strong></span> и его консолью. 
	 <a class="link" href="Ch02.html#Example0214" target="_top">Пример 2-14</a> отображает команду, применяемую для 
	 поиска используемого по умолчанию <span class="term"><strong class="userinput">dom0</strong></span>
	 GPU. Если есть только выделенный графический адаптер или ваш хост имеет лишь ЦПУ со встроенными 
	 возможностями GPU, тогда ваш первичный pGPU определённый при загрузке является единственным устройством, 
	 которое XenServer может использовать либо в режиме проброса (pass-through), при котором всё GPU назначается ВМ, 
	 или в режиме виртуальной графики, при котором некая часть вашего GPU назначается различным ВМ.</p>
	 <div class="example"><a id="Example0213"> </a>
	 <p class="title"><em>Пример 2-13. Определение физического GPU установленного для хоста. Результат 
	 показывает наличие NVIDIA Quadro</em></p>
	   <pre class="screen"><code>
# xe pgpu-list
uuid ( RO)              : 47d8c17d-3ea0-8a76-c58a-cb1d4300a5ec
       vendor-name ( RO): NVIDIA Corporation
       device-name ( RO): G98 [Quadro NVS 295]
    gpu-group-uuid ( RW): 1ac5d1f6-d581-1b14-55f1-54ef6a1954b4
 	   </code></pre>
     </div>
	 <div class="example"><a id="Example0214"> </a>
	 <p class="title"><em>Пример 2-14. Определение GPU используемого dom0 по умолчанию</em></p>
	   <pre class="screen"><code>
# lspci | grep &quot;VGA&quot;
 	   </code></pre>
     </div>

   	 <a id="050202"> </a>
	 <p class="title"><strong>gpu-group</strong></p>
     <p>Группа GPU это просто коллекция графических механизмов, которые содержатся в пределах отдельной 
	 физической графической карты. Если данная графическая карта способна подразделять свои ресурсы на 
	 множество объектов GPU, тогда группа GPU будет содержать ссылку на каждый объект, как это показано 
	 в <a class="link" href="Ch02.html#Example0215" target="_top">Примере 2-15</a>.</p>
	 <div class="example"><a id="Example0215"> </a>
	 <p class="title"><em>Пример 2-15. Перечень ресурсов GPU, связанных с физическим графическим адаптером</em></p>
	   <pre class="screen"><code>
# xe gpu-group-list
 	   </code></pre>
     </div>

   	 <a id="050203"> </a>
	 <p class="title"><strong>vgpu</strong></p>
     <p><span class="term"><strong class="userinput"><code>vgpu</code></strong></span> представляет 
	 виртуальный графический адаптер определяемый данной графической картой. Команда 
	 <span class="term"><strong class="userinput"><code>vgpu-type-list</code></strong></span>, показанная в 
	 <a class="link" href="Ch02.html#Example0216" target="_top">Примере 2-16</a>, возвращает три возможных 
	 vGPU опции для вашего данного хоста.</p>
	 <div class="example"><a id="Example0216"> </a>
	 <p class="title"><em>Пример 2-16. Просмотр типов GPU в пределах хоста XenServer</em></p>
	   <pre class="screen"><code>
# xe vgpu-type-list
uuid ( RO)            : ad32125b-e5b6-2894-9d16-1809f032c5bb
     vendor-name ( RO): NVIDIA Corporation
      model-name ( RO): GRID K100
framebuffer-size ( RO): 268435456

uuid ( RO)            : ee22b661-4aa0-e6e6-5876-e316c3ea09fe
     vendor-name ( RO): NVIDIA Corporation
      model-name ( RO): GRID K140Q
framebuffer-size ( RO): 1006632960

uuid ( RO)            : 2025cc3e-c869-ef44-2757-a1994cc77c8e
     vendor-name ( RO):
      model-name ( RO): passthrough
framebuffer-size ( RO): 0
 	   </code></pre>
     </div>

  <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0503"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Объекты хранения </span></h4>
   </div></div></div>
   <p>Исходя из проекции архитектуры, система хранения состоит из двух концепций, представляемых четырьмя различными 
   объектами. Каждый из них уникальным образом определяется и сопровождается в пределах базы данных XAPI и это:</p>
  	<div class="itemizedlist">
	<ul class="itemizedlist" type="disc">
	 <li class="listitem">
	 <p>Репозитории хранения (SR, Storage repositories) являются физическими устройствами, которые содержат 
	 виртуальные диски, связываемые с ВМ.</p>
	 </li><li class="listitem">
	 <p>Физические блочные устройства (PBD, Physical block devices) отображают физический сервер запоминающих 
	 устройств для хранения репозитория.</p>
	 </li><li class="listitem">
	 <p>Интерфейсы виртуального диска (VDI, Virtual disk interfaces) являются виртуальными жёсткими дисками, 
	 которые усиливают API управления хранением: сохраняя скрытым тип диска для ВМ, однако соответственным образом 
	 обрабатывая транзакции своим гипервизором.</p>
	 </li><li class="listitem">
	 <p>Виртуальные блочные диски (VBD, Virtual block disks) отображают VDI на виртуальные машины.</p>
	 </li>
    </ul>
    </div>
   <p>Взаимосвязи между этими четырьмя объектами отображены на <a class="link" href="Ch02.html#Fig0204" 
   target="_top">Рисунке 2-4</a>.</p>
	<div class="figure"><a id="Fig0204"> </a>
	 <p class="title"><strong>Рисунок 2-4 Как хранилища XenServer взаимодействуют друг с другом</strong></p>
	 <div class="figure-contents"><div class="mediaobject">
	 <img src="figures/Fig0204.jpg" width="792" height="498"/><br />
	 <span></span>
	 </div></div>
	</div><br class="figure-break"/></p>
  </div>

</div>

<!----><script type="text/javascript" src="FooterAndSidebar.js">
</script><script type="text/javascript"><!--</div id="content"> is inside next code
document.write(FooterAndSidebar);//-->
</script>

</body></html>