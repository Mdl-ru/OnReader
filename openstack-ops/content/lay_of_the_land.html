<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css"/>
<script type="text/javascript" src="scripts/shCore.js"><!----></script>
<script type="text/javascript">
               SyntaxHighlighter.config.space = ' ';
               SyntaxHighlighter.all();
    </script>
<title>Глава 8. Что к чему - Руководство по эксплуатации OpenStack</title>
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/>
<meta name="mavenGroupId" content="org.openstack.docs"/>
<meta name="mavenArtifactId" content="openstack-ops-manual"/>
<meta name="mavenVersionId" content="1.0.0"/>
<link rel="home" href="index.html" title="Руководство по эксплуатации OpenStack"/>
<link rel="up" href="operations.html" title="Эксплуатация"/>
<link rel="prev" href="operations.html" title="Эксплуатация"/>
<link rel="next" href="projects_users.html" title="Глава 9. Managing Projects and Users"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="git-sha" content="13fb30b7c263d715eee84f0ca1a16df79697eb88"/>
<meta name="buildTime" content="2014-12-12T17:43:02+00:00"/>
<script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-openstack-operations-guide";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Please enable JavaScript.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
        </script><style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
            
        </style>
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/>
<link rel="stylesheet" type="text/css" href="../common/css/custom.css"/>
<link rel="canonical" href="http://docs.openstack.org/openstack-ops/content//lay_of_the_land.html"/><!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
	<![endif]-->
<link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script>
<script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script>
<link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css"/>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js"><!--jQuery plugin for glossary popups. --></script>
<script type="text/javascript" src="search/htmlFileList.js"><!----></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script>
<script type="text/javascript" src="search/nwSearchFnt.js"><!----></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js"><!--//make this scalable to other languages as well.--></script>
<script type="text/javascript" src="search/index-1.js"><!----></script>
<script type="text/javascript" src="search/index-2.js"><!----></script>
<script type="text/javascript" src="search/index-3.js"><!----></script>
<script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
	        </script>
<script type="text/javascript" src="../common/ga.js"><!----></script>
<script language="javascript" src="/js/common.js"></script>
<script src="../common/highlight.pack.js"></script>
</head>
<body>
<!----><script type="text/javascript"><!--
hljs.initHighlightingOnLoad();
HeaderName = 'Глава 8. Что к чему';
PrevRef = 'operations.html';
UpRef = 'operations.html';
NextRef = 'projects_users.html';//-->
</script>
<!----><script type="text/javascript" src="HeaderAndToolbar.js">
</script><script type="text/javascript"><!--
document.write(HeaderAndToolbar); //-->
</script>
<div id="content"><div class="chapter">
 <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="lay_of_the_land"> </a>Глава 8. Что к чему</h2>
 </div></div></div>
 <div class="toc"><dl><dt><span class="section">
  <a href="lay_of_the_land.html#dashboard_admin">Использование инструментальной панели OpenStack для администрирования</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#cli_tools">Инструменты командной строки</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#network">Проверка сети</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#users_projects">Пользователи и проекты</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#running_instances">Выполнение экземпляров</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#ops-lay-of-land-summary">Резюме</a></span></dt></dl>
 </div>
 
 <p>Эта глава поможет вам настроить вашу рабочую среду и использовать ее для того, чтобы оглядеть 
 со всех сторон ваше облако.</p>
 
 <div class="section">
  <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">
   <a id="dashboard_admin"> </a>Использование инструментальной панели OpenStack для администрирования</h2>
  </div></div></div>
  <p>В качестве пользователя с правами администратора вы можете использовать 
  инструментальную панель OpenStack для создания и управления проектами, образами и
  предпочтениями (шаблонами виртуального ресурса). Пользователи имеют возможность 
  создавать образы и управлять ими в рамках определенных проектов, а также совместно использовать
  образы, зависящие от настройки службы образов. Обычно настройки политик позволяют пользователям
  с правами администратора только устанавливать квоты, а также создавать службы и управлять ими.
  Инструментальная панель предоставляет закладку  <span class="guilabel"><strong>Admin</strong></span> 
  с <span class="guilabel"><strong>System Panel</strong></span> и 
  <span class="guilabel"><strong>Identity Panel</strong></span>. 
  Эти интерфейсы дают вам доступ к системной информации и ее использованию, а также
  к параметрам установки, которые могут устанавливать конечные пользователи.
  Обратитесь к 
  <a class="link" href="http://docs.openstack.org/user-guide-admin/content/ch_dashboard.html" target="_top">
  Руководству пользователя с правми администратора OpenStack </a> 
  для подробной информации об использовании инструментальной панели пользователем с правами
  администратора.
  <a id="d9e3090" class="indexterm"/>
  <a id="d9e3093" class="indexterm"/></p>
 </div>
 
 <div class="section">
  <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">
   <a id="cli_tools"> </a>Инструменты командной строки</h2>
  </div></div></div>
  
  <div class="toc"><dl><dt><span class="section">
  <a href="lay_of_the_land.html#install_tools">Установка инструментов</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#admin_cli">Инструменты командной строки для администрирования</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#get_creds">Получение учетных данных</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#cli_tricks">Инспектирование вызовов API</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#servers_services">Серверы и службы</a></span></dt><dt><span class="section">
  <a href="lay_of_the_land.html#diagnose-compute">Диагностика ваших вычислительных узлов</a></span></dt></dl>
 </div>
 
 <p>Для целей администрирования мы рекомендуем использовать сочетание инструментальных средств интерфейса 
 командной строки OpenStack (CLI) и инструментальной панели OpenStack. Некоторые пользователи с опытом 
 работы в других облачных технологиях могут воспользоваться совместимым API EC2, который использует 
 несколько иные соглашения об именовании по сравнению с родным API. Мы выделим эти отличия.
 <a id="d9e3098" class="indexterm"/></p>
 
 <p>Мы настоятельно рекомендуем вам установить клиентов командной строки из 
 <a class="link" href="https://pypi.python.org/pypi" target="_top">Python Package Index</a> 
 (PyPI) вместо их установки из пакетов Ubuntu или Fedora. Клиенты находятся 
 в бурном развитии и очень вероятно, что в любой момент времени версия пакетов, 
 распространяемая вашим производителем операционной системы устареет.
 <a id="d9e3103" class="indexterm"/>
 <a id="d9e3106" class="indexterm"/>
 <a id="d9e3108" class="indexterm"/></p>
 
 <p>Для управления установкой из архива PyPI используется утилита &quot;pip&quot;, 
 а также во многих дистрибутивах Linux доступен пакет &quot;python-pip&quot;. 
 Каждый проект OpenStack имеет своего собственного клиента, поэтому в зависимости 
 от работающих на вашем сайте служб установите необходимые вам или все из следующих 
 <a id="d9e3111" class="indexterm"/>
 <a id="d9e3114" class="indexterm"/>
 <a id="d9e3117" class="indexterm"/>
 <a id="d9e3119" class="indexterm"/>
 <a id="d9e3121" class="indexterm"/>
 <a id="d9e3124" class="indexterm"/> пакетов:</p>
 
 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
 <p>python-novaclient (
 <a class="gloss" href="#" def="&lt;strong&gt;nova: &lt;/strong&gt; &lt;p&gt;
 Проект OpenStack, который поддерживает вычислительные службы. &lt;/p&gt;">nova</a> CLI)</p></li><li class="listitem">
 <p>python-glanceclient (
 <a class="gloss" href="#" def="&lt;strong&gt;glance: &lt;/strong&gt; &lt;p&gt;
 Проект ядра, который  предоставляет службу образов OpenStack. &lt;/p&gt;">glance</a> CLI)</p></li><li class="listitem">
 <p>python-keystoneclient (<a class="gloss" href="#" def="&lt;strong&gt;keystone: &lt;/strong&gt; &lt;p&gt;
 Проект, который поддерживает службу идентификации OpenStack. &lt;/p&gt;">keystone</a> CLI)</p></li><li class="listitem">
 <p>python-cinderclient (<a class="gloss" href="#" def="&lt;strong&gt;cinder: &lt;/strong&gt; &lt;p&gt;
 Проект ядра OpenStack, который поддерживает службы блочных хранилищ для виртуальных машин. &lt;/p&gt;">cinder</a> CLI)</p></li><li class="listitem">
 <p>python-swiftclient (<a class="gloss" href="#" def="&lt;strong&gt;swift: &lt;/strong&gt; &lt;p&gt;
 Проект ядра OpenStack, который обеспечивает службы хранилища объектов. &lt;/p&gt;">swift</a> CLI)</p></li><li class="listitem">
 <p>python-neutronclient (<a class="gloss" href="#" def="&lt;strong&gt;neutron: &lt;/strong&gt; &lt;p&gt;
 Проект ядра OpenStack который обеспечивает сетевые связи абстрактного уровня для вычислительной среды OpenStack. &lt;/p&gt;">neutron</a> CLI)</p></li></ul>
</div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="install_tools"> </a>Установка инструментов</h3>
 </div></div></div>
 
 <p>Чтобы установить (модернизировать) пакет из архива PyPI с помощью команды pip с правами root:
 <a id="d9e3149" class="indexterm"/>as root:</p><pre class="programlisting"># pip install [--upgrade] &lt;package-name&gt;</pre>
 <p>Для удаления пакета:</p>
 <pre class="programlisting"># pip uninstall &lt;package-name&gt;</pre>
 <p>Если вам необходимы самые последние версии клиентов, pip может проводить установку 
 непосредственно из исходящего репозитория git с использованием флага <code class="code">-e</code>. 
 Вы должны указать имя устанавливаемого яйца Python. Например:</p>
 <pre class="programlisting"># pip install -e git+https://github.com/openstack/
 python-novaclient.git#egg=python-novaclient</pre>
 
 <p>Если вы поддерживаете в облаке EC2 API, вы также должны установить пакет &quot;euca2ools&quot; 
 или другой инструмент EC2 API, чтобы вы могли получить привычный вашим пользователям интерфейс. 
 Использование инструментов, основанных на EC2 API, в основном выходит за рамки 
 данного руководства, хотя мы и обсудим получение учетных данных для использования 
 с данным API.</p>
</div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="admin_cli"> </a>Инструменты командной строки для администрирования</h3>
 </div></div></div>
 
 <p>Существует также ряд <code class="literal">*-manage</code> инструментов командной строки.
 Они устанавливаются вместе с соответствующими службами в контроллере облака и не
 требуют 
 <a id="d9e3163" class="indexterm"/>
 <a id="d9e3165" class="indexterm"/> отдельной установки:</p>
 
 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
 <p><code class="literal">nova-manage</code></p></li><li class="listitem">
 <p><code class="literal">glance-manage</code></p></li><li class="listitem">
 <p><code class="literal">keystone-manage</code></p></li><li class="listitem">
 <p><code class="literal">cinder-manage</code></p></li></ul>
</div>

<p>В отличие от инструментов, упомянутых выше, инструменты <code class="code">*-manage</code> 
должны запускаться в контроллере облака, причем с правами root, поскольку они должны иметь 
доступ по чтению к файлам конфигурации, таким как  <code class="code">/etc/nova/nova.conf</code>
и выполнять запросы непосредственно в базе данных, а не в качестве
Unlike the CLI tools mentioned above, the <code class="code">*-manage</code>
tools must be run from the cloud controller, as root, because they need
read access to the config files such as <code class="code">/etc/nova/nova.conf</code>
and to make queries directly against the database rather than against
the OpenStack <a class="gloss" href="#" def="&lt;strong&gt;Конечные точки API (терминалы): &lt;/strong&gt; &lt;p&gt;
Демон, исполнитель или служба, с которой взаимодействует клиент для доступа к API. 
Конечная точка API может предоставлять любое количество служб таких, как аутентификация, данные о сбыте, метрики производительности,
команды виртуальных машин, данные учета и т.п.. &lt;/p&gt;">конечных точек API</a>  OpenStack.
<a id="d9e3185" class="indexterm"/>
<a id="d9e3188" class="indexterm"/></p>
 
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
 <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
 <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Предостережение</th></tr><tr>
 <td align="left" valign="top">
 <p>Наличие инструментов <code class="code">*-manage</code> является наследуемой проблемой. 
 А именно: миграция всей оставшейся в инструментах <code class="code">*-manage</code> функциональности 
 на обычные инструменты клиента в конечном счете является целью OpenStack. 
 На сегодняшний день для выполнения некоторых операций по техническому обслуживанию, 
 которые требуют некоторые <span class="keep-together">инструменты <code class="code">*-manage</code>
 </span>code>, вам необходим SSH на 
 <a class="gloss" href="#" def="&lt;strong&gt;узел контроллера облака: &lt;/strong&gt; &lt;p&gt;
 Узел, на котором выполняются службы сети, томов, планировщика и образов.
Каждая служба может быть разбита на отдельные узлы для целей масштабируемости и доступности. &lt;/p&gt;">
 узле контроллера облака</a>.
 <a id="d9e3198" class="indexterm"/></p></td></tr></table>
</div></div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="get_creds"> </a>Получение учетных данных</h3>
 </div></div></div>
 
 <p>Если вы хотите использовать инструменты командной строки для осуществления запросов к 
 своему облаку OpenStack, вы должны иметь соответствующие полномочия. 
 По сравнению с использованием клиентов командной строки, использование инструментальной панели 
 является гораздо более простым способом получения  
 <a class="gloss" href="#" def="&lt;strong&gt;Аутентификация: &lt;/strong&gt; &lt;p&gt;
 Процесс, который подтверждает при помощи частного ключа, метки безопасности, пароля, отпечатка
 пальца или подобного метода, что пользователь, процесс или клиент действительно являются
 тем, кем они себя называют. &lt;/p&gt;">
 авторизованных</a> полномочий. В верхней правой навигационной строке выберите 
 <span class="guimenuitem"><strong>Project</strong></span>, затем <span class="guimenuitem">
 <strong>Access &amp; Security</strong></span>, потом 
 <span class="guimenuitem"><strong>API Access</strong></span>, чтобы открыть страницу 
 настроек пользователя, где вы можете задать предпочитаемые язык и часовой пояс 
 для представления инструментальной панели (dashboard).
 Данное действие высветит две кнопки, 
 <span class="guilabel"><strong>Download OpenStack RC File</strong></span> и
 <span class="guilabel"><strong>Download EC2 Credentials</strong></span>, 
 позволяющие вам сформировать файлы в вашей среде для заполнения
 значений переменных окружения, которые требуются инструментам командной строки, чтобы
 иметь сведения о том где находятся конечные точки служб и ваша информация об аутентификации. 
 Пользователь, от имени которого вы осуществили вход, предписывает в инструментальной панели
 имя файла для файла openrc, например <code class="filename">demo-openrc.sh</code>. 
 Когда вход осуществлен в качестве администратора, файл будет назван 
 <code class="filename">admin-openrc.sh</code>.
 <a id="d9e3212" class="indexterm"/>
 <a id="d9e3214" class="indexterm"/>
 <a id="d9e3216" class="indexterm"/></p>
 
 <p>Сформированный файл будет выглядеть примерно так:</p>
 <pre class="programlisting">#!/bin/bash

# With the addition of Keystone, to use an openstack cloud you should
# authenticate against keystone, which returns a **Token** and **Service
# Catalog**. The catalog contains the endpoint for all services the
# user/tenant has access to--including nova, glance, keystone, swift.
#
# *NOTE*: Using the 2.0 *auth api* does not mean that compute api is 2.0.
# We use the 1.1 *compute api*
export OS_AUTH_URL=http://203.0.113.10:5000/v2.0

# With the addition of Keystone we have standardized on the term **tenant**
# as the entity that owns the resources.
export OS_TENANT_ID=98333aba48e756fa8f629c83a818ad57
export OS_TENANT_NAME="test-project"

# In addition to the owning entity (tenant), openstack stores the entity
# performing the action as the **user**.
export OS_USERNAME=demo

# With Keystone you pass the keystone password.
echo "Please enter your OpenStack Password: "
read -s OS_PASSWORD_INPUT
export OS_PASSWORD=$OS_PASSWORD_INPUT</pre>
 <p>Перевод на русский язык:</p>
<pre class="programlisting">#!/bin/bash
# При добавлении Keystone, для использования облака openstack вы должны
# осуществить аутентификацию в keystone, которая вернет **Token** и **Service
# Catalog**. Каталог содержит конечные точки для всех служб, к которым
# user/tenant имеет доступ - включая nova, glance, keystone, swift.
#
# *ПРИМЕЧАНИЕ*: Использование 2.0 *auth api* не означает, что используется compute api 2.0.
# Мы используем *compute api* 1.1
export OS_AUTH_URL=http://203.0.113.10:5000/v2.0

# При добавлении Keystone мы получаем стандартизацию понятия **tenant** (владелец)
# как лица (сущности), которому принадлежат ресурсы.
export OS_TENANT_ID=98333aba48e756fa8f629c83a818ad57
export OS_TENANT_NAME="test-project"

# В добавление к лицу- владельцу (tenant), openstack хранит сущности
# выполняющие действия в качестве **user**.
export OS_USERNAME=demo

# используя Keystone, вы передаете пароль keystone.
echo "Введите, пожалуйста, пароль OpenStack: "
read -s OS_PASSWORD_INPUT
export OS_PASSWORD=$OS_PASSWORD_INPUT
</pre>

<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
 <table border="0" summary="Предостережение"><tr><td rowspan="2" align="center" valign="top" width="25">
 <img alt="[Предостережение]" src="../common/images/admon/warning.png"/></td><th align="left">Предостережение</th></tr><tr>
 <td align="left" valign="top">
 <p>Данные операции не сохраняют пароль в простом текстовом виде, что является хорошим 
 обстоятельством. Однако, когда вы получаете или выполняете сценарий, он просит вас 
 ввести пароль, который сохраняется в переменной окружения <code class="code">OS_PASSWORD</code>. 
 Важно отметить, что это не требует взаимодействия. Если вам необходимо интерактивное 
 взаимодействие, вы можете хранить значение непосредственно в сценарии, но в этом случае 
 вы должны быть предельно внимательны в вопросах безопасности и прав доступа 
 к этому файлу.
 <a id="d9e3224" class="indexterm"/>
 <a id="d9e3226" class="indexterm"/></p></td></tr></table>
</div>

<p>Совместимые с EC2 полномочия могут быть загружены путем выбора
<span class="guimenuitem"><strong>Project</strong></span>, затем 
<span class="guimenuitem"><strong>Access &amp; Security</strong></span>, потом 
<span class="guimenuitem"><strong>API Access</strong></span> для отображения
кнопки <span class="guilabel"><strong>Download EC2 Credentials</strong></span>
Нажмите на нее для формирования файла ZIP с сертификатами сервера x509 и фрагментами сценария 
окружения. Создайте новый каталог в безопасном месте, отличном от местоположения 
<code class="code">user-openrc</code> по-умолчанию, поскольку все эти данные представляют 
действующую информацию аутентификации, необходимую для доступа к вашей идентификации в 
облаке. Извлеките сюда все данные из архива. У вас должны быть 
<code class="filename">cacert.pem</code>, <code class="filename">cert.pem</code>,
<code class="filename">ec2rc.sh</code>и <code class="filename">pk.pem</code>. 
Файл <code class="filename">ec2rc.sh</code> выглядит примерно так:
<pre class="programlisting">#!/bin/bash

NOVARC=$(readlink -f "${BASH_SOURCE:-${0}}" 2&gt;/dev/null) ||\
NOVARC=$(python -c 'import os,sys; \
print os.path.abspath(os.path.realpath(sys.argv[1]))' "${BASH_SOURCE:-${0}}")
NOVA_KEY_DIR=${NOVARC%/*}
export EC2_ACCESS_KEY=df7f93ec47e84ef8a347bbb3d598449a
export EC2_SECRET_KEY=ead2fff9f8a344e489956deacd47e818
export EC2_URL=http://203.0.113.10:8773/services/Cloud
export EC2_USER_ID=42 # nova does not use user id, but bundling requires it
export EC2_PRIVATE_KEY=${NOVA_KEY_DIR}/pk.pem
export EC2_CERT=${NOVA_KEY_DIR}/cert.pem
export NOVA_CERT=${NOVA_KEY_DIR}/cacert.pem
export EUCALYPTUS_CERT=${NOVA_CERT} # euca-bundle-image seems to require this

alias ec2-bundle-image="ec2-bundle-image --cert $EC2_CERT --privatekey \
$EC2_PRIVATE_KEY --user 42 --ec2cert $NOVA_CERT"
alias ec2-upload-bundle="ec2-upload-bundle -a $EC2_ACCESS_KEY -s \
$EC2_SECRET_KEY --url $S3_URL --ec2cert $NOVA_CERT"</pre>

<p>Чтобы поместить полномочия EC2 в ваше окружение, получите файл <code class="code">ec2rc.sh</code>.</p>
</div>

<div class="section">
 <div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="cli_tricks"> </a>Инспектирование вызовов API</h3>
 </div></div></div>
 <div class="toc"><dl><dt><span class="section">
  <a href="lay_of_the_land.html#curl">Применение cURL для дополнительного инспектирования</a></span></dt></dl>
 </div>
 
 <p>Путем передачи флага <code class="code">--debug</code>, могут быть сформированы  инструменты 
 командной строки для показа вызовов OpenStack API <code class="code">--debug</code>:
 <a id="d9e3249" class="indexterm"/>
 <a id="d9e3252" class="indexterm"/> Например:</p>
 <pre class="programlisting"># nova --debug list</pre>
 
 <p>Данный пример демонстрирует HTTP запрос клиента и 
 ответы конечной точки, что может быть полезным при создании инструментов, 
 разрабатываемых для OpenStack API.</p>
 
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
 <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Совет</th></tr><tr><td align="left" valign="top">
 
 <p>
 <a class="link" href="https://wiki.openstack.org/wiki/KeyringSupport" target="_top">Поддержка Keyring
 </a> (брелка для ключей) позволяет вам безопасно хранить пароли OpenStack в зашифрованном файле.
 <a id="d9e3260" class="indexterm"/></p>
 
 <p>Это свойство не установлено по умолчанию. Чтобы разрешить его, добавьте флаг 
 <code class="code">--os-cache</code> или установите переменную окружения
 <code class="code">OS_CACHE=1</code>.</p>
 
 <p>Настройка <code class="literal">OS_CACHE</code> обеспечит аутентификацию инструмента
 командной строки при каждом взаимодействии с облаком. Это может помочь работе данного
 сценария. Однако, это увеличит время выполнения команд и нагрузку на сервер.</p></td></tr></table>
</div>

<div class="section">
 <div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="curl"> </a>Применение cURL для дополнительного инспектирования</h4>
 </div></div></div>
 
 <p>В основе использования командной строки лежит OpenStack API, 
 который является RESTful API, работающим поверх протокола HTTP. Могут возникнуть случаи, 
 когда вы захотите взаимодействовать с API непосредственно или у вас возникнет 
 такая необходимость из-за подозрения в наличии ошибки в инструментах CLI. Лучшим способом 
 выполнить эту задачу будет использование комбинация <a class="link" href="http://curl.haxx.se/" target="_top">cURL</a>
 и другого инструмента, например, <a class="link" href="http://stedolan.github.io/jq/" target="_top">jq</a>
 для разбора ответов JSON.
 <a id="d9e3272" class="indexterm"/>
 <a id="d9e3274" class="indexterm"/></p>
 
 <p>Первое, что вы должны сделать, это идентифицироваться в облаке 
 с помощью ваших учетных данных, чтобы получить 
 <a class="gloss" href="#" def="&lt;strong&gt;маркер аутентификации: &lt;/strong&gt; &lt;p&gt;
 Строка текста, возвращаемая клиенту после аутентификации.
 Должна быть сформирована пользователем или процессом в соответствующем запросе к
 конечной точке API. &lt;/p&gt;">
 маркер аутентификации</a> (token).</p>
 
 <p>Ваши учетные данные представляют собой сочетание имени пользователя, пароля и владельца 
 (tenant или проекта - project). Вы можете получить эти данные из <code class="code">openrc.sh</code>, 
 как это обсуждалось ранее. Маркер позволяет взаимодействовать с другими службами 
 конечных точек без необходимости повторной аутентификации для каждого последующего запроса. 
 Маркеры, как правило, доступны на 24 часа и, по истечению срока действия маркера, вы получаете 
 предупреждение о неразрешенном ответе (401, Unauthorized) и вы 
 можете запросить другой <span class="keep-together">маркер</span>.
 <a id="d9e3281" class="indexterm"/></p>
 
 <div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
  <p>Просмотрите свой 
  <a class="gloss" href="#" def="&lt;strong&gt;каталог: &lt;/strong&gt; &lt;p&gt;
  Список конечных точек API, которые доступны пользователю после аутентификации в службе идентификации. &lt;/p&gt;">
  каталог</a> служб OpenStack:</p>
  <pre class="programlisting brush: bash; ">
$ curl -s -X POST http://203.0.113.10:35357/v2.0/tokens \
-d '{"auth": {"passwordCredentials": {"username":"test-user", \
                                      "password":"test-password"},  \
                                      "tenantName":"test-project"}}' \
-H "Content-type: application/json" | jq .</pre></li><li class="listitem">
 <p>Пролистайте ответ JSON, чтобы понять как выложен каталог.</p>
 <p>Для упрощения работы с последующими запросами сохраните маркер в переменной окружения:</p>
 <pre class="programlisting brush: bash; ">
$ TOKEN=`curl -s -X POST http://203.0.113.10:35357/v2.0/tokens \
-d '{"auth": {"passwordCredentials": {"username":"test-user",  \
                                      "password":"test-password"},  \
                                      "tenantName":"test-project"}}' \
-H "Content-type: application/json" |  jq -r .access.token.id`</pre>
 <p>Теперь вы можете к вашему маркеру в командной строке с помощью имени переменной
 <code class="literal">$TOKEN</code>.</p></li><li class="listitem">
 <p>Выберите службу конечной точки из каталога служб, скажем, пусть это будет compute. 
 Попробуйте выполнить запрос, например, выдать список экземпляров (серверов):</p>
<pre class="programlisting">
$ curl -s \
-H "X-Auth-Token: $TOKEN" \
http://203.0.113.10:8774/v2/98333aba48e756fa8f629c83a818ad57/servers | jq .</pre></li></ol>
</div>

<p>Чтобы узнать как должны быть структурированы запросы, прочтите
<a class="link" href="http://developer.openstack.org/api-ref.html" target="_top">
OpenStack API Reference</a>. 
Для пережевывания ответов с помощью jq, ознакомьтесь с
<a class="link" href="http://stedolan.github.io/jq/manual/" target="_top">jq Manual</a>.</p>

<p>Флаг<code class="code">-s flag</code> используется в приводимых выше командах cURL 
для предотвращения показа индикатора исполнения. Если у вас возникли проблемы с 
исполнением команд cURL, вы захотите удалить его. Точно так же, для помощи в устранении 
трудностей с командами cURL вы можете включить флаг <code class="code">-v</code> для 
показа вам подробного вывода. Существует еще много чрезвычайно полезных функций cURL, 
обратитесь к страницам руководства (man) для ознакомления со всеми опциями.</p>
</div></div>

<div class="section">
 <div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="servers_services"> </a>Серверы и службы</h3>
 </div></div></div>
 
 <p>Существует несколько способов составить вам для себя, как для администратора, представление 
 о вашем облаке OpenStack просто используя доступные инструменты OpenStack. Данный раздел даст 
 вам представление о том, как получить обзор вашего облака, его формы, размера и текущего состояния.
 <a id="d9e3307" class="indexterm"/>
 <a id="d9e3310" class="indexterm"/>
 <a id="d9e3313" class="indexterm"/>
 <a id="d9e3316" class="indexterm"/></p>
 
 <p>Во- первых, вы можете определить какие серверы входят в состав вашего облака 
 OpenStack выполнив:
 <pre class="programlisting"># nova-manage service list | sort</pre>
 <p>
 Результат выглядит следующим образом:</p>
 <pre class="programlisting">Binary           Host              Zone Status  State Updated_At
nova-cert        cloud.example.com nova enabled  :-)  2013-02-25 19:32:38
nova-compute     c01.example.com   nova enabled  :-)  2013-02-25 19:32:35
nova-compute     c02.example.com   nova enabled  :-)  2013-02-25 19:32:32
nova-compute     c03.example.com   nova enabled  :-)  2013-02-25 19:32:36
nova-compute     c04.example.com   nova enabled  :-)  2013-02-25 19:32:32
nova-compute     c05.example.com   nova enabled  :-)  2013-02-25 19:32:41
nova-conductor   cloud.example.com nova enabled  :-)  2013-02-25 19:32:40
nova-consoleauth cloud.example.com nova enabled  :-)  2013-02-25 19:32:36
nova-network     cloud.example.com nova enabled  :-)  2013-02-25 19:32:32
nova-scheduler   cloud.example.com nova enabled  :-)  2013-02-25 19:32:33</pre>

<p>Вывод показывает, что существует пять вычислительных узлов и один контроллер 
облака. Вы видите смайлик подобный <code class="code">:-)</code>, который указывает, 
что услуги включены, работают и функционируют. Если служба не доступна, то 
<code class="code">:-)</code> сменяется на <code class="code">XXX</code>. 
Это признак того, что вы должны определить причину недоступности службы.</p>
<p>Если вы используете Cinder, выполните следующую команду, чтобы увидеть подобный листинг:</p>
<pre class="programlisting"># cinder-manage host list | sort</pre>
<pre class="programlisting">host              zone
c01.example.com   nova
c02.example.com   nova
c03.example.com   nova
c04.example.com   nova
c05.example.com   nova
cloud.example.com nova</pre>
<p>С помощью этих двух таблиц, у вас теперь есть хороший обзор того, какие серверы и службы 
создают ваше облако.</p>
<p>Вы также можете использовать Службу идентификации (keystone), чтобы увидеть, 
какие службы доступны в облаке, а также какие конечные точки настроены для этих служб.
<a id="d9e3332" class="indexterm"/></p>
<p>Следующие команды нужны вам для того, чтобы у вас была оболочка, настроенная с 
соответствующими административными переменными:</p>
<pre class="programlisting">$ keystone catalog</pre>
<pre class="programlisting">Service: image
+-------------+----------------------------------------+
|   Property  |                 Value                  |
+-------------+----------------------------------------+
|   adminURL  | http://cloud.internal.example.com:9292 |
| internalURL | http://cloud.example.com:9292          |
|  publicURL  | http://cloud.example.com:9292          |
|    region   |               RegionOne                |
+-------------+----------------------------------------+

Service: identity
+-------------+----------------------------------------------+
|   Property  |                   Value                      |
+-------------+----------------------------------------------+
|   adminURL  | http://cloud.internal.example.com:35357/v2.0 |
| internalURL | http://cloud.example.com:5000/v2.0           |
|  publicURL  | http://cloud.example.com:5000/v2.0           |
|    region   |                 RegionOne                    |
+-------------+----------------------------------------------+</pre>

<p>Вывод предыдущей команды усечен для показа только двух служб.
Вы видите по одному служебному блоку для каждой службы, которую поддерживает 
ваше облако. Обратите внимание, что домен конечной точки может быть различным 
в зависимости от типа конечной точки. Разные домены конечных точек для каждого типа
не требуются, но это может быть выполнено по целому ряду причин, таким как
конфиденциальность или разделение сетевого обмена.</p>
<p>Вы можете определить версию установленной вычислительной среды с помощью <span class="keep-together">команды</span> 
<code class="literal">nova-manage</code>: </p>
<pre class="screen"># nova-manage version</pre>
</div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">
  <a id="diagnose-compute"> </a>Диагностика ваших вычислительных узлов</h3>
 </div></div></div>
 
 <p>Вы можете получить дополнительную информацию о запущенных виртуальных машинах: 
 использование ими процессоров, памяти, дискового ввода/вывода или сетевого ввода/вывода, 
 для каждого экземпляра
 в частности, с помощью выполнения команды <code class="literal">nova diagnostics</code> 
 с
 <a id="d9e3347" class="indexterm"/>
 <a id="d9e3350" class="indexterm"/> ID сервера:</p>
 <pre class="screen">$ nova diagnostics &lt;serverID&gt;</pre>
 
 <p>Вывод этой команды будет меняться в зависимости от используемого гипервизора,
 поскольку гипервизоры поддерживают различные атрибуты.
 <a id="d9e3355" class="indexterm"/> 
 Ниже демонстрируется разница между жвумя наиболее популярными гипервизорами. 
 Пример вывода при использовании гипервизора Xen: </p>
 <pre class="screen">+----------------+-----------------+
|    Property    |      Value      |
+----------------+-----------------+
| cpu0           | 4.3627          |
| memory         | 1171088064.0000 |
| memory_target  | 1171088064.0000 |
| vbd_xvda_read  | 0.0             |
| vbd_xvda_write | 0.0             |
| vif_0_rx       | 3223.6870       |
| vif_0_tx       | 0.0             |
| vif_1_rx       | 104.4955        |
| vif_1_tx       | 0.0             |
+----------------+-----------------+</pre>
<p>Хотя команда должна работать с любым гипервизором, который управляется с помощью libvirt 
(например, KVM, QEMU или LXC), она была протестирована только с KVM. 
Пример вывода, при гипервизоре KVM:</p>
<pre class="screen">+------------------+------------+
| Property         | Value      |
+------------------+------------+
| cpu0_time        | 2870000000 |
| memory           | 524288     |
| vda_errors       | -1         |
| vda_read         | 262144     |
| vda_read_req     | 112        |
| vda_write        | 5606400    |
| vda_write_req    | 376        |
| vnet0_rx         | 63343      |
| vnet0_rx_drop    | 0          |
| vnet0_rx_errors  | 0          |
| vnet0_rx_packets | 431        |
| vnet0_tx         | 4905       |
| vnet0_tx_drop    | 0          |
| vnet0_tx_errors  | 0          |
| vnet0_tx_packets | 45         |
+------------------+------------+</pre>
</div></div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">
  <a id="network"> </a>Проверка сети</h2>
 </div></div></div>
 <p>Для просмотра настроенных в вашем облаке сетей с фиксированными IP вы применить
 клиента командной строки <code class="literal">nova</code> для получения диапазонов IP:
 <a id="d9e3364" class="indexterm"/>
 <a id="d9e3367" class="indexterm"/></p>
 <pre class="screen">$ nova network-list
+--------------------------------------+--------+--------------+
| ID                                   | Label  | Cidr         |
+--------------------------------------+--------+--------------+
| 3df67919-9600-4ea8-952e-2a7be6f70774 | test01 |  10.1.0.0/24 |
| 8283efb2-e53d-46e1-a6bd-bb2bdef9cb9a | test02 |  10.1.1.0/24 |
+--------------------------------------+--------+--------------+</pre>
<p>Инструмент <code class="literal">nova-manage</code> может снабдить вас некоторыми дополнительными 
деталями:</p>
<pre class="screen"># nova-manage network list
id IPv4        IPv6 start address DNS1 DNS2 VlanID project   uuid 
1  10.1.0.0/24 None 10.1.0.3      None None 300    2725bbd   beacb3f2
2  10.1.1.0/24 None 10.1.1.3      None None 301    none      d0b1a796</pre>

<p>Этот вывод показывает, что настроены две сети, причем каждая сеть содержит 
255 IP адресов (/24 подсети). Первая сеть была назначена определенному 
проекту, в то время как вторая сеть по-прежнему открыта для назначения. 
Вы можете можете назначить эту сеть вручную или автоматически при первом запуске проекта.</p>

<p>Чтобы выяснить, какие плавающие (floating) IP- адреса доступны в вашем облаке, выполните:</p>
<pre class="programlisting"># nova-manage floating list</pre>
<pre class="programlisting">2725bb...59f43f 1.2.3.4 None            nova vlan20
None            1.2.3.5 48a415...b010ff nova vlan20</pre>

<p>Здесь доступно два плавающих IP. Первый был выделен проекту, а второй 
остается не распределенным.</p>
</div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">
  <a id="users_projects"> </a>Пользователи и проекты</h2>
 </div></div></div>
 <p>Чтобы увидеть список проектов, которые были добавлены в облако, 
 <a id="d9e3382" class="indexterm"/>
 <a id="d9e3385" class="indexterm"/>
 <a id="d9e3388" class="indexterm"/> выполните:</p>
 <pre class="programlisting">$ keystone tenant-list</pre>
 <pre class="programlisting">+-----+----------+---------+
| id  | name     | enabled |
+-----+----------+---------+
| ... | jtopjian | True    |
| ... | alvaro   | True    |
| ... | everett  | True    |
| ... | admin    | True    |
| ... | services | True    |
| ... | jonathan | True    |
| ... | lorin    | True    |
| ... | anne     | True    |
| ... | rhulsker | True    |
| ... | tom      | True    |
| ... | adam     | True    |
+-----+----------+---------+</pre>
<p>Чтобы увидеть пользователей, выполните:</p>
<pre class="programlisting">$ keystone user-list</pre>
<pre class="programlisting">+-----+----------+---------+------------------------------+
| id  | name     | enabled | email                        |
+-----+----------+---------+------------------------------+
| ... | everett  | True    | everett.towne@backspace.com  |
| ... | jonathan | True    | jon@sfcu.edu                 |
| ... | nova     | True    | nova@localhost               |
| ... | rhulsker | True    | ryan.hulkster@cyberalbert.ca |
| ... | lorin    | True    | lorinhoch@nsservices.com     |
| ... | alvaro   | True    | Alvaro.Perry@cyberalbert.ca  |
| ... | anne     | True    | anne.green@backspace.com     |
| ... | admin    | True    | root@localhost               |
| ... | cinder   | True    | cinder@localhost             |
| ... | glance   | True    | glance@localhost             |
| ... | jtopjian | True    | joe.topjian@cyberalbert.com  |
| ... | adam     | True    | adam@ossmanuals.net          |
| ... | tom      | True    | fafield@univm.edu.au         |
+-----+----------+---------+------------------------------+</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Замечание"><tr><td rowspan="2" align="center" valign="top" width="25">
<img alt="[Замечание]" src="../common/images/admon/note.png"/></td><th align="left">Замечание</th></tr><tr><td align="left" valign="top">
<p>Иногда пользователь и группа имеют взаимно однозначное (один-к-одному) отображение. Это 
происходит для стандартных системных учетных записей, таких как cinder, glance, nova и swift, 
или когда только один пользователь является целой частью группы.</p></td></tr></table>
</div></div>

<div class="section">
 <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">
  <a id="running_instances"> </a>Выполнение экземпляров</h2></div></div></div>
  
  <p>Чтобы посмотреть список запущенных экземпляров, 
  <a id="d9e3401" class="indexterm"/>
  <a id="d9e3404" class="indexterm"/> выполните:</p>
  <pre class="programlisting">$ nova list --all-tenants</pre>
  <pre class="programlisting">+-----+------------------+--------+-------------------------------------------+
| ID  | Name             | Status | Networks                                  |
+-----+------------------+--------+-------------------------------------------+
| ... | Windows          | ACTIVE | novanetwork_1=10.1.1.3, 199.116.232.39    |
| ... | cloud controller | ACTIVE | novanetwork_0=10.1.0.6; jtopjian=10.1.2.3 |
| ... | compute node 1   | ACTIVE | novanetwork_0=10.1.0.4; jtopjian=10.1.2.4 |
| ... | devbox           | ACTIVE | novanetwork_0=10.1.0.3                    |
| ... | devstack         | ACTIVE | novanetwork_0=10.1.0.5                    |
| ... | initial          | ACTIVE | nova_network=10.1.7.4, 10.1.8.4           |
| ... | lorin-head       | ACTIVE | nova_network=10.1.7.3, 10.1.8.3           |
+-----+------------------+--------+-------------------------------------------+</pre>

<p>К сожалению эта команда не рассказывает вам различных подробностей о 
запущенных <span class="keep-together">экземплярах</span>, например, 
какие вычислительные узлы экземпляра запущены, 
какие шаблоны виртуальных ресурсов экземпляр установлены, и так далее. 
Вы можете использовать следующую команду, чтобы просмотреть сведения об отдельных экземплярах:
<a id="d9e3411" class="indexterm"/></p><pre class="programlisting">$ nova show &lt;uuid&gt;</pre>

<p>Например: </p><pre class="programlisting"># nova show 81db556b-8aa5-427d-a95c-2a9a6972f630</pre>
<pre class="programlisting">+-------------------------------------+-----------------------------------+
| Property                            | Value                             |
+-------------------------------------+-----------------------------------+
| OS-DCF:diskConfig                   | MANUAL                            |
| OS-EXT-SRV-ATTR:host                | c02.example.com                   |
| OS-EXT-SRV-ATTR:hypervisor_hostname | c02.example.com                   |
| OS-EXT-SRV-ATTR:instance_name       | instance-00000029                 |
| OS-EXT-STS:power_state              | 1                                 |
| OS-EXT-STS:task_state               | None                              |
| OS-EXT-STS:vm_state                 | active                            |
| accessIPv4                          |                                   |
| accessIPv6                          |                                   |
| config_drive                        |                                   |
| created                             | 2013-02-13T20:08:36Z              |
| flavor                              | m1.small (6)                      |
| hostId                              | ...                               |
| id                                  | ...                               |
| image                               | Ubuntu 12.04 cloudimg amd64 (...) |
| key_name                            | jtopjian-sandbox                  |
| metadata                            | {}                                |
| name                                | devstack                          |
| novanetwork_0 network               | 10.1.0.5                          |
| progress                            | 0                                 |
| security_groups                     | [{u'name': u'default'}]           |
| status                              | ACTIVE                            |
| tenant_id                           | ...                               |
| updated                             | 2013-02-13T20:08:59Z              |
| user_id                             | ...                               |
+-------------------------------------+-----------------------------------+</pre>

<p>Эта выдача показывает, что экземпляр с именем
<strong class="userinput"><code>devstack</code></strong> 
был создан из образа Ubuntu 12.04 с использованием предпочтений <code class="literal">m1.small</code> 
и размещается на вычислительном узле 
node <code class="literal">c02.example.com</code>.</p>
</div>
<div class="section">
 <div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">
  <a id="ops-lay-of-land-summary"> </a>Резюме</h2>
 </div></div></div>
 <p>Мы надеемся, что вам понравился наш краткий обзор вашей рабочей среды, 
 в том числе того, как взаимодействовать с вашим облаком для получения
 полезной информации. Далее вы можете воспользоваться <span class="emphasis"><em>
 <a class="link" href="http://docs.openstack.org/user-guide-admin/content/" target="_top">
 Admin User Guide</a></em></span> как справочником для всех функций командной строки 
 в вашем облаке.</p>
</div></div>

<!----><script type="text/javascript" src="FooterAndSidebar.js">
</script><script type="text/javascript"><!--
document.write(FooterAndSidebar);//-->
</script>

</body></html>