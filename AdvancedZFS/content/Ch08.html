<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
<title>Глава 8. Производительность - Мастерство FreeBSD: ZFS для профессионалов</title>
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/>
<meta name="mavenGroupId" content="www.mdl.ru"/>
<meta name="mavenArtifactId" content="AdvancedZFS"/>
<meta name="mavenVersionId" content="1.0.0"/>
<link rel="home" href="index.html" title="Мастерство FreeBSD: ZFS для профессионалов"/>
<link rel="up" href="index.html" title="Мастерство FreeBSD: ZFS для профессионалов"/>
<link rel="prev" href="Ch07.html" title="Глава 7. Кэширование"/>
<link rel="next" href="Ch09.html" title="Глава 9. Тонкая настройка"/>
<meta name="git-sha" content=""/>
<meta name="buildTime" content=""/>
<script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "advanced-zfs";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Please enable JavaScript.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
</script>
<style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
</style>
<link rel="shortcut icon" href="../MdlLogo.gif" type="image/gif"/>
<link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/>
<link rel="stylesheet" type="text/css" href="../common/css/custom.css"/>
<link rel="canonical" href="http://onreader.mdl.ru/FreeBSDMasteryZFS/content/index.html"/>
<!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script>
<script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script>
<link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css"/>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js">
<!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script>
<script type="text/javascript" src="search/nwSearchFnt.js"><!----></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js">
<!--//make this scalable to other languages as well.--></script>
<script type="text/javascript" src="search/index-1.js"><!----></script>
<script type="text/javascript" src="search/index-2.js"><!----></script>
<script type="text/javascript" src="search/index-3.js"><!----></script>
<script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
</script>
<script type="text/javascript" src="../common/ga.js"><!----></script>
<script language="javascript" src="/js/common.js"></script>
<link rel="stylesheet" href="../common/css/googlecode.css">
<script src="../common/highlight.pack.js"></script>
</head>
<body>
<!----><script type="text/javascript"><!--
hljs.initHighlightingOnLoad();
HeaderName = 'Глава 8. Производительность';
PrevRef = 'Ch07.html';
UpRef = 'index.html';
NextRef = 'Ch09.html';//-->
</script>
<!----><script type="text/javascript" src="HeaderAndToolbar.js">
</script><script type="text/javascript"><!--
document.write(HeaderAndToolbar); //-->
</script>
<div id="content">
 <div class="part">
  <div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title">
   Глава 8. Производительность</h1>
  </div></div></div>

  <div class="toc"><p><strong>Содержание</strong></p>
   <dl>
   <dt><span class="chapter"><a href="Ch08.html">8. Производительность</a></span></dt>
   <dd><dl>
     <dt><span class="chapter"><a href="Ch08.html#01">Что такое производительность?</a></span></dt>
     <dt><span class="chapter"><a href="Ch08.html#02">ZFS и производительность</a></span></dt>
     <dt><span class="chapter"><a href="Ch08.html#03">zpool iostat</a></span></dt>
     <dd><dl>
       <dt><span class="chapter"><a href="Ch08.html#0301">Текущая и продолжительная активность пула</a></span></dt>
       <dt><span class="chapter"><a href="Ch08.html#0302">Активность виртуального устройства</a></span></dt>
     </dl></dd>
     <dt><span class="chapter"><a href="Ch08.html#04">Упреждающая выборка ZFS</a></span></dt>
     <dd><dl>
       <dt><span class="chapter"><a href="Ch08.html#0401">Упреждающая выборка на основе VDEV</a></span></dt>
       <dt><span class="chapter"><a href="Ch08.html#0402">Пофайловая упреждающая выборка</a></span></dt>
     </dl></dd>
     <dt><span class="chapter"><a href="Ch08.html#05">Настройка групп транзакций</a></span></dt>
     <dd><dl>
       <dt><span class="chapter"><a href="Ch08.html#0501">Времена txg</a></span></dt>
       <dt><span class="chapter"><a href="Ch08.html#0502">Размер txg</a></span></dt>
       <dt><span class="chapter"><a href="Ch08.html#0503">Длительность и содержание txg</a></span></dt>
       <dt><span class="chapter"><a href="Ch08.html#0504">Плавное регулирование записи</a></span></dt>
     </dl></dd>
     <dt><span class="chapter"><a href="Ch08.html#06">Расписание ввода/вывода</a></span></dt>
     <dd><dl>
       <dt><span class="chapter"><a href="Ch08.html#0601">Измерение латентности и пропускной способности</a></span></dt>
     </dl></dd>
     <dt><span class="chapter"><a href="Ch08.html#07">Очереди ввода/вывода</a></span></dt>
     <dd><dl>
       <dt><span class="chapter"><a href="Ch08.html#0701">Запросы по-VDEV</a></span></dt>
       <dt><span class="chapter"><a href="Ch08.html#0702">Расписание больших VDEV</a></span></dt>
     </dl></dd>
     <dt><span class="chapter"><a href="Ch08.html#08">Асинхронные записи и размеры групп транзакций</a></span></dt>
     <dt><span class="chapter"><a href="Ch08.html#09">Плавное регулирование записи</a></span></dt>
     <dt><span class="chapter"><a href="Ch08.html#10">Производительность очистки и восстановления</a></span></dt>
   </dl></dd>
   </dl>
  </div>
   <p>Все мы хотим, чтобы наши хранилища были быстрыми, функциональными и неограниченными в объеме. Пока ещё у нас 
   нет неограниченности в ёмкости, однако на хорошем оборудовании свойства ZFS могут быть великолепно быстрыми. 
   Однако, даже без видимой причины самое лучшее оборудование может стать медленным. Знание о том как применять 
   средства диагностики может помочь вашему пониманию производительности системы. Возможно вы не сможете исправить 
   их с инструментов в руках, однако, по крайней мере, вы поймёте что пошло не так и может быть перенесёте некую 
   нагрузку куда то ещё.</p>
   <p>FreeBSD содержит инструментальные средства для проверки производительности и обычных дисков и 
   файловой системы, а также специальные инструменты ZFS. Подробную информацию вы можете получить в 
   <span class="term"><code>sysctl(8)</code></span>, <span class="term"><code>vmstat(8)</code></span> и связанных с 
   ними командами, однако мы настоятельно рекомендуем установить дополнительный пакет 
   <span class="term"><code>zfs-stats</code></span> для разбора и обработки информации надлежащим образом.</p>
   <p>Когда вы разберётесь как оценивать производительность системы, мы обсудим некоторые свойства 
   производительности ZFS и то, когда они могут быть полезны.</p>
   <p>Перед погружением в оценку производительности ZFS давайте немного поговорим о производительности в 
   общем.</p>
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="01"> </a>Что такое производительность?</h3>
   </div></div></div>
   <p>Производительность может быть описана как &quot;насколько хорошо система справляется с рабочей 
   нагрузкой&quot;. Все системы имеют слегка различающиеся рабочие нагрузки, поэтому производительность 
   различается даже в случае идентичной аппаратной производительности выглядящих идентичными задач. 
   Даже если вы пытаетесь очень сильно реплицировать аппаратные средства, установка программного обеспечения 
   а также рабочая нагрузка в другой системе кем-то может быть определена как различающиеся. Это часть того, 
   что делает эталонное тестирование столь раздражающим.</p>
   <p>Системный администратор в основном заботится об улучшении производительности. Это означает обнаружение 
   и удаление узких мест. Среднестатистический компьютер имеет четыре основных ресурса: ввод/ вывод системы 
   хранения, пропускная способность сетевой среды, оперативная память и ЦПУ. Если вы наваливаете работу в 
   систему до тех пор, когда она уже не может справляться, первое то что вы в действительности делаете, это 
   определение того, какой именно из этих четырёх ресурсов отказывает первым. Этот ресурс является бутылочным 
   горлышком.</p>
   <p>Увеличение производительности требует идентификации и перемещения этого узкого места. И вы всегда 
   сталкиваетесь со следующим узким местом. Если ваш процессор является текущим бутылочным горлышком и вы 
   добавили вычислительную мощность, скорость вычислений растёт, пока не происходит насыщения дискового 
   ввода/ вывода, или памяти, или сети. Вы улучшили производительность, да ... до пределов разрешённых 
   новым узким местом.</p>
   <p>Причём различные рабочие нагрузки могут иметь совершенно различные узкие места.</p>
   <p>Многим системным администраторам необходима замена одного из этих ресурсов на другой. Именно поэтому 
   Лукас всегда называет &quot;настройку системы&quot; &quot;перенастройкой узких мест&quot;. (Лукас многие 
   вещи называет перестановкой бутылочных горлышек. Он решает проблему &quot;грязной одежды&quot; 
   личным временем и моющими средствами. Пока вы читаете это, он почти наверняка страдает от узкого места с 
   мороженным.)</p>
   <p>Давайте на момент отвлечёмся на сжатие ZFS. Сжатие ZFS уменьшает объём записываемых системой данных и 
   извлекаемых из её дисков. Сжатие и распаковка блоков занимает время процессора. Сжатие обменивает 
   ввод/ вывод системы хранения на процессорное время. Однако, большинство компьютеров имеют больше процессорной 
   мощи чем они возможно используют. Ноутбук на котором я пишу это имеет четырёхядерный процессор, но только один 
   диск с весьма средней скоростью и очень ограниченной пропускной способностью ввода/ вывода. Разрешение 
   сжатия с очевидностью выигрышно в подобной системе. В системе с большей производительностью дискового ввода/ 
   вывода в сравнении с мощностью процессора, вы можете принять другое решение.</p>
   <p>Чем сложнее ваша система хранения, тем больше возможностей у вас для регулировки и смещения узких мест. 
   Ваш сервер имеет шесть дисковых контроллеров, но весь ввод/ вывод приходит только на один из них? 
   Перегруппируйте ваши наборы данных чтобы разделить нагрузку между множеством контроллеров. Может быть 
   определённый диск перенасыщен? Разделите эту нагрузку. Возможно, ваш пул перегружен операциями записи, или 
   чтения, или и тем и другим. Добавление настроенных надлежащим образом SLOG и L2ARC помогут.</p>
   <p>Перед тем как выполнить изменения, однако, исследуйте где находится узкое место. Приобретение более быстрого 
   диска для системы не поможет вашим конкретным системным ограничениям ЦПУ или памяти. Добавление быстрого SSD 
   для ZIL не улучшит производительность если дисковые чтения дросселируют производительность сервера.</p>
   <p>Один из самых вечных вопросов для системного администратора это: кто съедает пропускную способность моего 
   диска? Очистка пула может повлиять на другие операции, однако при повседневном применении, ZFS не создаёт 
   никаких новых ответов на этот вопрос. Выполните <span class="term"><code>top -m io </code></span> для 
   выявления процесса, наиболее интенсивно использующего ваш диск. Должен ли наиболее активный процесс быть 
   настолько загруженным?</p>
   <p>Если производительность не отвечает вашим ожиданиям, помните, что ваша система хранения работает настолько 
   хорошо, как это ей позволяет самый её медленный компонент. {<span class="emphasis"><em>Прим. пер.: см. 
   <a class="link" href="https://parallel.ru/sites/default/files/info/parallel/voevodin/lec4.pdf" 
   target="_top">1-ый Закон Амдала</a>: &quot;Производительность вычислительной системы, состоящей из связанных 
   между собой устройств, в общем случае определяется самым непроизводительным её устройством&quot;, В.В.Воеводин 
   &quot;Вычислительная математика и структура алгоритмов.&quot;, МГУ, 2006, ISBN 5-211-05310-9</em></span>}
   У вас может быть на самом деле быстрый контроллер SAS и самый новый, высокоскоростной жёсткий диск, но при этом 
   ужасная производительность из- за поганых дисковых кабелей. Умножитель SATA портов разрубает 
   производительность пропорционадьно числу подключённых дисков. Просто потому, что вы можете соединить 
   определённые компоненты вместе, не означает что это следует делать.</p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="02"> </a>ZFS и производительность</h3>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="03"> </a>zpool iostat</h3>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0301"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Текущая и продолжительная активность пула </span></h4>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0302"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Активность виртуального устройства </span></h4>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="04"> </a>Упреждающая выборка ZFS</h3>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0401"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Упреждающая выборка на основе VDEV </span></h4>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0402"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Пофайловая упреждающая выборка </span></h4>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="05"> </a>Настройка групп транзакций</h3>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0501"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Времена txg </span></h4>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0502"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Размер txg </span></h4>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0503"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Длительность и содержание txg </span></h4>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0504"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Плавное регулирование записи </span></h4>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="06"> </a>Расписание ввода/вывода</h3>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0601"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Измерение латентности и пропускной способности </span></h4>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="07"> </a>Очереди ввода/вывода</h3>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0701"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Запросы по-VDEV </span></h4>
   </div></div></div>
   <p></p>

   <div xmlns="" class="titlepage"><div><div>
    <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="0702"> </a>
	<span  style="color:#FEFEFE; background-color:#888888; padding:0.5em;">Расписание больших VDEV </span></h4>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="08"> </a>Асинхронные записи и размеры групп транзакций</h3>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="09"> </a>Плавное регулирование записи</h3>
   </div></div></div>
   <p></p>
  </div>   
   
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="10"> </a>Производительность очистки и восстановления</h3>
   </div></div></div>
   <p></p>
  </div>   
   
 </div>

<!----><script type="text/javascript" src="FooterAndSidebar.js">
</script><script type="text/javascript"><!--</div id="content"> is inside next code
document.write(FooterAndSidebar);//-->
</script>

</body></html>