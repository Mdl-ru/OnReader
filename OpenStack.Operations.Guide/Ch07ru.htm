<html>
<head>
   <link rel="icon" href="/i/MdlLogo.gif" type="image/gif">
   <title>Глава 7. Пример построения. Руководство по эксплуатации OpenStack.</title>
   <meta name="Keywords" content="OpenStack, Cloud computing, Swift, RESTful, Object Storage, Ceph, CORS, CNAME lookup, Domain remap, Health check, Rate limiting, Bulk delete, Container qoutas, account qoutas, TempURL, Static Web, Form post, recon, Swift origin server, Bulk archive auto-extraction">
   <meta name="Description" content="Глава 7. Пример построения. Руководство по эксплуатации OpenStack.">
   <meta name="Robots" content="INDEX, FOLLOW">
   <meta name="Author" content="Module-Projects,Ltd">
   <meta name="Copyright" content="Copyright 1998..2014 Module-Projects,Ltd">
   <meta http-equiv="Pragma" content="no-cache">
<script language="javascript" src="/css/v.0/mdlcss.js"></script>
<style type="text/css" media="screen, print">@import url("i/global-20140610.css");</style>
<script language="javascript" src="http://www.mdl.ru/usd.js"></script>
	<script language="javascript" src="http://www.mdl.ru/js/common.js"></script>
	<script language="javascript" src="http://www.mdl.ru/Solutions/ABC.js"></script>
</head>
<body>

<table class="bg_White" width="1024" align="center" valign="top" border="0" cellpadding="0" cellspacing="0"><tbody>
<tr>
<td>
<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody>
<tr>
<td width="150" valign="top" align="center"><img src="http://www.mdl.ru/RMC9.jpg" border=0 /></td>
<td width="724" valign="bottom" align="center">
<a class="item-t" href="http://www.mdl.ru"><img src="http://www.mdl.ru/i/MdlBigLogo.gif" border="0"></a><br/>
<a class="item-t" href="http://www.mdl.ru">С 1991 года на компьютерном рынке России</a>
</td>
<td align="center" valign="bottom">
<a class="item-t" href="javascript:tocall()" onmouseover="this.href=mail"><img src="http://www.mdl.ru/i/9563499.gif" border="0" alt="e-mail" /><br/><br/>т.: 676 0965, 676 0396<br/>Москва, Сосинская ул. 43, <br/>м. Волгоградский проспект</a>
</td>
</tr>
<tr>
<td class="big_16y" colspan="3" align="center"><a href="index.htm">Руководство по эксплуатации OpenStack</a></td>
</tr>
<tr><td colspan="2">


<h2 align="right">ГЛАВА 7</h2>
<hr />
<h1 id="Chapter_07" align="right">Пример построения</h1>
<p>Поскольку OpenStack чрезвачайно настраиваем с использованием очень большого количества параметров серверов и сети, трудно написать документацию, которая охватывала бы все возможные реализации OpenStack.
 По этой причине данное руководство приводит один <em>пример построения</em> для упрощения задачи документирования, а также сориентировать данное руководство таким образом, чтобы сконцентрироваться на конфигурации, в которой авторы имеют опыт развертывания.</p>

<em>Пользуйтесь переводом <strong>существенно переработанной и дополенной <a href="http://onreader.mdl.ru/openstack-ops/content/example_architecture.html">2й редакции</a></strong> (12-дек-2014),<br />
находящейся теперь и в режиме <a href="http://docs.openstack.org/openstack-ops/content/example_architecture.html">постоянно обновляемой документации</a> <br />
(последняя пока доступна только на англ.яз.).</em><br />
<p></p>

<h2 id="Ch0701">Обзор</h2>
<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody><tr>
 <td width="50%">Редакция OpenStack<br />&nbsp;</td>
 <td width="50%">Folsom<br />&nbsp;</td>
</tr><tr>
 <td>Операционная система хоста<br />&nbsp;</td>
 <td>Ubuntu 12.04 LTS<br />&nbsp;</td>
</tr><tr>
 <td>Репозиторий пакетов OpenStack<br />&nbsp;</td>
 <td><span class="red-heading">Ubuntu Cloud Archive</span>(<a href="https://wiki.ubuntu.com/ServerTeam/CloudArchive">https://wiki.ubuntu.com/ServerTeam/CloudArchive</a>)<sup>*</sup><br />&nbsp;</td>
</tr><tr>
 <td>Гипервизор<br />&nbsp;</td>
 <td>KVM<br />&nbsp;</td>
</tr><tr>
 <td>База данных<br />&nbsp;</td>
 <td>MySQL<sup>*</sup><br />&nbsp;</td>
</tr><tr>
 <td>Очередь сообщений<br />&nbsp;</td>
 <td>RabbitMQ<br />&nbsp;</td>
</tr><tr>
 <td>Сетевая служба<br />&nbsp;</td>
 <td>nova-network<br />&nbsp;</td>
</tr><tr>
 <td>Приложение управления сетью<br />&nbsp;</td>
 <td>FlatDHCP<br />&nbsp;</td>
</tr><tr>
 <td>Единственный nova-network или множественные хосты?<br />&nbsp;</td>
 <td>мультихост<sup>*</sup></td>
</tr><tr>
 <td>Служба образов (glance)</td>
 <td>файлы на сервере<br />&nbsp;</td>
</tr><tr>
 <td>Драйвер службы идентификации (keystone)<br />&nbsp;</td>
 <td>SQL</td>
</tr><tr>
 <td>Сервер службы блочного хранилища (cinder)<br />&nbsp;</td>
 <td>LVM/iSCSI</td>
</tr><tr>
 <td>Сервер миграции в реальном времени<br />&nbsp;</td>
 <td>разделяемое хранилище с использованием NFS<sup>*</sup><br />&nbsp;</td>
</tr><tr>
 <td>Хранилище объектов</td>
 <td>OpenStack Object Storage (swift)<br />&nbsp;</td>
</tr></tbody></table>
<p>Звездочка (<sup>*</sup>) указывает отклонения примера построения от установок по умолчанию</p>
<p><img src="i/Tip.jpg" alt="Tip" /> Следующие свойства OpenStack поддерживаются примером построения приводимом в данном руководстве, но не являются обязательными:
<ul>
 <li><span class="red-heading">инструментальная панель (dashboard)</span>
 <li>блочное хранилище
 <li><span class="red-heading">плавающая адресация IP</span>
 <li><span class="red-heading">миграция в реальном масштабе времени</span>
 <li><span class="red-heading">хранилище объектов</span>
</ul>
</p>

<h2 id="Ch0702">Обоснование</h2>
<p>Этот пример построения был выбран на основе текущего набора свойств по умолчанию OpenStack <span class="red-heading">Folsom</span>, с акцентом на стабильность.
 В частности, если ни один из авторов руководства не имел опыта развертывания редакции OpenStack Folsom с определенным сервером или конфигурацией, мы не рассматривали их в качестве примера построения.
 Мы считаем, что многие облака, которые в настоящее время используют OpenStack в своей деятельнсти, выполнили подобный выбор.</p>
<p>Вначале вы должны выбрать операционную систему, которая будет работать на всех физических узлах.
 Хотя OpenStack поддерживается множеством дистрибутивов Linux, мы использовали <strong>Ubuntu 12.04 LTS (Long Term Support)</strong>, которая используется большинством в сообществе разработчиков, имеет полный набор возможностей по сравнению с другими дистрибутивами, а также имеет четкие планы дальнейшей поддержки.</p>
<p>Мы рекомендуем вам не использовать пакеты установки,используемые по умолчанию Ubuntu OpenStack, а вместо этого воспользоваться <span class="red-heading">Архивом Ubuntu Cloud</span> (<a href="https://wiki.ubuntu.com/ServerTeam/CloudArchive">https://wiki.ubuntu.com/ServerTeam/CloudArchive</a>).
 Архив Cloud является канонически поддерживаемым хранилищем пакетов, что позволяет перейти к будущим версиям OpenStack, оставаясь с Ubuntu 12.04.</p>
<p><strong>KVM</strong> в качестве дополнения <span class="red-heading">гипервизора</span> является выбором Ubuntu - будучи хорошо подогнанной парой в терминах поддержки, а также из-за значительной степени внимания, получаемого им от сообщества разработчиков OpenStack (в том числе от авторов, которые в основном используют KVM).
 Он также полностью укомплектован, свободен от лицензионных сборов и ограничений.</p>
<p><strong>MySQL</strong> следует аналогичной тенденции.
 Несмотря на недавнюю смену собственника, эта база данных является наиболее протестированой для использования с OpenStack и мощно документирована для работы под Ubuntu.
 Мы уклонились от использования базы данных по умолчанию, <em>SQLite</em>, поскольку SQLite не соответствует требованиям к использованию на практике для баз данных.</p>
<p>Выбор <strong>RabbitMQ</strong> по сравнению с другими AMQP совместимыми вариантами, которые набирают возрастающую поддержку в OpenStack, такими как ZeroMQ и Qpid, связан с простотой его использования с Ubuntu и значительного объема тестирования на практике.
 Он также является единственным вариантом, поддерживает такие свойства, как Compute Cell.
 Мы рекомендуем кластеризацию с использованием RabbitMQ, поскольку он является неотъемлемой составляющей системы, и довольно прост в реализации в связи с его встроенной природой.</p>
<p>Как уже говорилось в предыдущих главах, есть несколько вариантов создания сетей в OpenStack Compute.
 Мы рекомендуем <strong>FlatDHCP</strong> при использовании режима работы в сети <strong>Multi-Host</strong> для обеспечения высокой доступности, запускающего по одному демону <code>nove-network</code> на хост OpenStack Compute.
 Это обеспечивает надежный механизм гарантии изоляции прерываний работы сети в отдельных вычислительных хостах, а также позволяет прямое использование аппаратных сетевых шлюзов.</p>
<p><strong>Миграция в реальном времени</strong> обеспечивается посредством совместного использования СХД с <strong>NFS</strong> в качестве распределенной файловой системы.</p>
<p>Признавая, что для многих маломасштабных реализациях работа службы хранения объектов только для хранения образов виртуальных машин выглядит слишком дорогой, для каталога образов OpenStack и службы предоставления услуг (Glance) мы выбрали файловые сервера.
 Если проектирумое вами облако также предполагает запускать службу хранения объектов, будет просто использовать Object Storage вместо файловых серверов, причем это является рекомендуемым решением.</p>
<p>Мы отдали предпочтение <strong>серверу SQL в качестве службы идентификации (keystone)</strong> над другими, например LDAP.
 Эти сервера просты в установке и надежны. 
 Авторы признают, что для многих установок желательна связь с существующими службами каталогов, и предупреждают о необходимости точного понимания <span class="red-heading">массива доступных опций</span> (<a href="http://docs.openstack.org/trunk/config-reference/content/ch_configuring-openstack-identity.html#configuring-keystone-for-ldap-backend">http://docs.openstack.org/trunk/config-reference/content/ch_configuring-openstack-identity.html#configuring-keystone-for-ldap-backend</a>)</p>
<p>Служба блочного хранения (cinder) изначально устанавливается на внешних узлах- хранилищах и использует <strong>плагин LVM/iSCSI</strong>.
 Большинство плагинов службы блочного хранения привязаны к продуктам и реализациям определенного производителя, что ограничивает их использование для потребителей рассматриваемых аппаратных платформ, однако LVM/iSCSI является надежной и стабильной службой при работе на серийно выпускаемой вычислительной технике.</p>
<p>В то время как облако может работать без <strong>инструментальной панели (Dashboard) OpenStack</strong>, мы расцениваем ее как незаменимую, причем не только для взаимодействия пользователя с облаком, но и в качестве инструмента для операторов.
 Кроме того, использование инструментальной панели из Django превращает ее в гибкую структуру для расширения.</p>


<h3 id="Ch070202">Почему бы не воспользоваться сетевой службой OpenStack (quantum)?</h3>
<p>В данном руководстве мы не обсуждаем сетевую службу OpenStack (quantum), поскольку все авторы данного руководства имеют опыт промышленного развертывания исключительно с использованием nova-network.
  Кроме того, она пока не поддерживает мульти-хостовые сети.</p>

<h3 id="Ch070203">Зачем использовать мульти-хостовые сети?</h3>
<p>При развертывании OpenStack по умолчанию, именно единcтвенная служба <code>nova-network</code>, которая работает в облаке (обычно на контроллере облака), предоставляет такие услуги, как трансляция сетевых адресов (NAT), DHCP, DNS для гостевых экземпляров.
 Если отказывает один узел, который управляет службой nova-network, вы не сможете получить доступ к экземплярам, а экземпляры не смогут получить доступ в интернет.
 В случае возникновения чрезмерного сетевого трафика, единственный узел, управляющий службой <code>nova-network</code>, может стать узким местом, и выйти из состава облака.</p>
<p>Режим с <span class="red-heading">мульти-хостом</span> (<em>Прим.пер.: текущее описание - <a href="http://docs.openstack.org/high-availability-guide/content/ch-network.html">http://docs.openstack.org/high-availability-guide/content/ch-network.html</a>, устаревшая ссылка из оригинала: </em> <a href="http://docs.openstack.org/folsom/openstack-compute/admin/content/existing-ha-networking-options.html#d6e8906">http://docs.openstack.org/folsom/openstack-compute/admin/content/existing-ha-networking-options.html#d6e8906</a>) является вариантом с высоким уровнем доступности для конфигурации сети, в которой сервис <code>nova-network</code> выполняется на каждом вычислительном узле в противоположность работе только на единственном узле.</p>


<h2 id="Ch0703">Подробное описание</h2>
<p>Эталонная архитектура состоит из нескольких вычислительных узлов, контроллера облака, внешнего сервера хранения NFS для хранения экземпляров и сервера блочного хранилища для хранения <span class="red-heading">томов</span> (<span class="red-heading">volume</span>) OpenStack .
 Служба сетевого времени (Network Time Protocol, NTP) синхронизирует время для всех узлов.
 FlatDHCPManager в режиме мульти-хоста используется для построения сети.</p>
<p><img src="i/Pic07-01.jpg" /></p>
<p>Контроллер облака выполняет: инструментальную панель, службы API, базу данных (MySQL), сервер очереди сообщений (RabbitMQ), планировщик для выбора вычислительных ресурсов (<code>nova-scheduler</code>), службы идентификации (keystone,  <code>nova-consoleauth</code>), службы образов (<code>glance-api</code>, <code>glance-registry</code>), службы для консолей доступа гостей, а также службы блочного хранения, включающие планировщик для ресурсов хранения (<code>cinder-api</code> и <code>cinder-scheduler</code>).</p>
<p>Вычислительные узлы находятся там, где проводятся вычисления, и в нашем примере применения они выполняют гипервизор (KVM), <code>libvirt</code> (драйвер для гипервизора, котрый позволяет динамическую миграцию с узла на узел), <code>nova-compute</code>,  <code>nova-api-metadata</code> (как правило, используется только при работе в режиме мульти-хоста, он извлекает метаданные определенного экземпляра), <code>nova-vncproxy</code> и <code>nova-network</code>.</p>
<p>Сеть состоит из двух коммутаторов, один для управления или частного трафика, и второй, накрывающий общий доступ в том числе плавающий IP-адреса.
  Для поддержки этого, контроллер облака и вычислительные узлы имеют по две сетевых карты.
  Серверы хранения блочных данных OpenStack и NFS необходимы исключительно для доступа в частной сети и, следовательно, им нужна только одна сетевая карта, однако, если это возможно , рекомендуется связанная конфигурация с несколькими работающими в одном сервере платами.
  Плавающий IP доступ идет напрямую в интернет, в то время как доступ связный IP проходит через NAT.</p>
<p><img src="i/Pic07-02.jpg" /></p>


<h2 id="Ch0704">Дополнительные расширения</h2>
<p>Вы можете расширить рассмотренную архитектуру следующим образом:</p>
<ul>
 <li>Добавить дополнительные облачные контроллеры (см. <a class="red-heading" href="Ch11ru.htm">Глава 11</a>).
 <li>Добавить службы OpenStack Storage <a href="http://docs.openstack.org/havana/install-guide/install/apt/content/ch_swift.html">http://docs.openstack.org/havana/install-guide/install/apt/content/ch_swift.html</a>
 <li>Добавить дополнительные хосты блочных храненилищ OpenStack (см. <a class="red-heading" href="Ch11ru.htm">Глава 11</a>).
</ul>

<p><img src="i/Tip.jpg" alt="Tip" /><strong>Что дальше?</strong><br />
 Поздравляем! На текущий момент вы должны иметь надежный проект для вашего облака.
 Теперь мы рекомендуем вам обратиться к <span class="red-heading">Руководству по установке и развертыванию OpenStack - Ubuntu</span> (<a href="http://docs.openstack.org/havana/install-guide/install/apt/">http://docs.openstack.org/havana/install-guide/install/apt/</a>), которое содержит пошаговое руководство о том, как вручную установить пакеты OpenStack и зависимости в вашем облаке.
 Хотя важно для оператора быть знакомы с шагов, участвующих в развертывании OpenStack, мы также настоятельно рекомендуем вам оценить инструментов настройки, такие как Puppet или Chef, которые могут помочь автоматизировать этот процесс развертывания.
 <br />
 Хотя оператору важно быть знакомым с последовательностью развертывания OpenStack, мы также настоятельно рекомендуем вам оценить инструменты настройки, такие как <span class="red-heading">Puppet</span> или <span class="red-heading">Chef</span>, которые могут помочь в автоматизации такого процесса развертывания.
 <br />
 В оставшейся части руководства, мы предполагаем, что вы успешно развернули облако OpenStack и способны выполнять основные операции, такие как добавление образов, загрузку экземпляров, и подкдючение томов..
 <br />
 Поскольку ваше внимание возращается к стабильной работе, мы рекомендуем вам первоначально пролистать оставшиеся части книги, чтобы получить представление о содержании.
 Часть этой информации является полезной для предварительного прочтения, так что вы можете определить установившуюся практику применения и упростить свою жизнь в долгосрочной перспективе.
 Другая информация является более полезной в качестве примеров, к которым вы можете обращаться, когда происходит неожиданное событие, например, сбой питания или поиск неисправностей при определенной проблеме.
</p>


<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody><tr>
 <td align="left"><a href="Ch06ru.htm">Глава 6</a></td>
 <td align="center"><a href="index.htm">Оглавление</a></td>
 <td align="right"><a href="Ch08ru.htm">Глава 8</a></td>
</tr><tr><td colspan="3" style="border-bottom: thin solid;">&nbsp;</tr>
<tr><td colspan="2" valign="top">Перевод: Copyright ©&nbsp;2014 &nbsp;<img src="/i/mdl-reg.jpg" widht="35" height="12" style="border-style: none;">.<br>
All rights reserved.<br />
Ссылки обязательны (Refs and links obligatory).</td>
<td valign="top" align="right"><em><a href="http://www.mdl.ru">http://www.mdl.ru</a></em></td></tr>
</tbody></table>


<td align="right" valign="top">
<script language="javascript">
WriteABC('GPFS');
//--></script>
</tr>
</tbody></table>
</tbody></table>
</body>
</html>
