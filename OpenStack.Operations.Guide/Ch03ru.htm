<html>
<head>
   <link rel="icon" href="/i/MdlLogo.gif" type="image/gif">
   <title>Глава 3. Масштабирование. Руководство по эксплуатации OpenStack.</title>
   <meta name="Keywords" content="OpenStack, Cloud computing, Swift, RESTful, Object Storage, Ceph, CORS, CNAME lookup, Domain remap, Health check, Rate limiting, Bulk delete, Container qoutas, account qoutas, TempURL, Static Web, Form post, recon, Swift origin server, Bulk archive auto-extraction">
   <meta name="Description" content="Глава 3. Масштабирование. Руководство по эксплуатации OpenStack.">
   <meta name="Robots" content="INDEX, FOLLOW">
   <meta name="Author" content="Module-Projects,Ltd">
   <meta name="Copyright" content="Copyright 1998..2014 Module-Projects,Ltd">
   <meta http-equiv="Pragma" content="no-cache">
<script language="javascript" src="/css/v.0/mdlcss.js"></script>
<style type="text/css" media="screen, print">@import url("i/global-20140610.css");</style>
<script language="javascript" src="http://www.mdl.ru/usd.js"></script>
	<script language="javascript" src="http://www.mdl.ru/js/common.js"></script>
	<script language="javascript" src="http://www.mdl.ru/Solutions/ABC.js"></script>
</head>
<body>

<table class="bg_White" width="1024" align="center" valign="top" border="0" cellpadding="0" cellspacing="0"><tbody>
<tr>
<td>
<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody>
<tr>
<td width="150" valign="top" align="center"><img src="http://www.mdl.ru/RMC9.jpg" border=0 /></td>
<td width="724" valign="bottom" align="center">
<a class="item-t" href="http://www.mdl.ru"><img src="http://www.mdl.ru/i/MdlBigLogo.gif" border="0"></a><br/>
<a class="item-t" href="http://www.mdl.ru">С 1991 года на компьютерном рынке России</a>
</td>
<td align="center" valign="bottom">
<a class="item-t" href="javascript:tocall()" onmouseover="this.href=mail"><img src="http://www.mdl.ru/i/9563499.gif" border="0" alt="e-mail" /><br/><br/>т.: 676 0965, 676 0396<br/>Москва, Сосинская ул. 43, <br/>м. Волгоградский проспект</a>
</td>
</tr>
<tr>
<td class="big_16y" colspan="3" align="center"><a href="index.htm">Руководство по эксплуатации OpenStack</a></td>
</tr>
<tr><td colspan="2">


<h2 align="right">ГЛАВА 3</h2>
<hr />
<h1 id="Chapter_03" align="right">Масштабирование</h1>

<em>Пользуйтесь переводом <strong>существенно переработанной и дополенной <a href="http://onreader.mdl.ru/openstack-ops/content/scaling.html">2й редакции</a></strong> (12-дек-2014),<br />
находящейся теперь и в режиме <a href="http://docs.openstack.org/openstack-ops/content/scaling.html">постоянно обновляемой документации</a> <br />
(последняя пока доступна только на англ.яз.).</em><br />
<p></p>

<p>Если ваше облако является успешным, в конце концов, вы будете должны добавить ресурсы для 
удовлетворения растущего спроса. 
OpenStack разработан для горизонтального масштабирования.
Вместо перехода на более крупные серверы, вы закупаете больше серверов.
В идеале вы масштабируете и  баланс нагрузки между функционально- идентичными службами.
</p>

<h2 id="Ch0301">Отправной пункт</h2>
<p>Определение масштабируемости вашего облака и того, как ее улучшать является упражнением для 
балансировки со многими переменными.
Ни одно из решений не отвечает всем целям масштабирования.
Тем не менее, было бы полезным отслеживать ряд метрик.</p>

<p>Обычно отправной точкой является количество ядер вашего облака.
Путем применения некоторых соотношений вы можете получить информацию о количестве виртуальных машин (VM), 
которые вы ожидаете выполнять ((доля перерасхода &#215; ядра) / виртуальных ядер в экземпляре), сколько 
требуется дискового пространства (предпочитаемый размер диска &#215; число экземпляров). 
Вы можете использовать эти соотношения для определения того, какой объем дополнительной инфраструктуры 
требуется вам для поддержания вашего облака.</p>

<p>Предпочтения по умолчанию OpenStack:</p>

<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody>
<tr>
<td class="big_16h">Название</td>
<td class="big_16h">Виртуальные ядра</td>
<td class="big_16h">ОЗУ</td>
<td class="big_16h">Диски</td>
<td class="big_16h">Непродолжительно</td></tr>
<tr><td class="numClmn">m1.tiny</td><td class="numClmn"> 1</td><td class="numClmn"> 512 MB</td><td class="numClmn"> 1 GB</td><td class="numClmn"> 0 GB</td></tr>
<tr><td class="numClmn">m1.small</td><td class="numClmn"> 1</td><td class="numClmn"> 2 GB</td><td class="numClmn"> 10 GB</td><td class="numClmn"> 20 GB</td></tr>
<tr><td class="numClmn">m1.medium</td><td class="numClmn"> 2</td><td class="numClmn"> 4 GB</td><td class="numClmn"> 10 GB</td><td class="numClmn"> 40 GB</td></tr>
<tr><td class="numClmn">m1.large</td><td class="numClmn"> 4</td><td class="numClmn"> 8 GB</td><td class="numClmn"> 10 GB</td><td class="numClmn"> 80 GB</td></tr>
<tr><td class="numClmn">m1.xlarge</td><td class="numClmn"> 8</td><td class="numClmn"> 16 GB</td><td class="numClmn"> 10 GB</td><td class="numClmn"> 160 GB</td></tr>
</tbody></table>

<p>Предположим, что следующие установки поддерживают (200 / 2) &#215; 16 = 1600 экземпляров VM и требуют 
80 TB хранилища для /var/lib/nova/instances:</p>

<ul>
  <li>200 физических ядер
  <li>Большинство экземпляров имеют размер m1.medium (2 виртуальных ядра, 50 GB хранилища)
  <li>Соотношение перегруженного выделения (overcommit) CPU по умолчанию (<code>cpu_allocation_ratio</code> 
  в nova.conf ) в 16:1
</ul>

<p>Тем не менее, вам потребуется не только оценка числа ядер для оценки загрузки, с которой, вероятно, 
столкнутся службы API, серверы баз данных и серверы очередей. 
Также вы должны рассмотреть модели использования вашего облака.</p>

<p>В качестве конкретного примера сравните облако, поддерживающее платформу управляемого веб- хостинга с 
облаком, выполняющим тест интеграции для проекта развития, который создает одну виртуальную машину на 
каждый код транзакции. 
В первом случае тяжелая работа создания ВМ происходит только каждые несколько месяцев, в то время, как 
второй  размещает постоянную тяжелую нагрузку на контроллере облака.
Вы должны учитывать среднее время жизни ваших ВМ, поскольку большие значения означают меньшую нагрузку на 
контроллер облака.</p>

<p>Помимо создания и останова виртуальных машин вы должны учитывать влияние пользователей, подключающихся 
к услуге — в частности, к nova-api и связанной с ним базой данных.
Просмотр списка экземпляров накапливает большое количество информации и, принимая во внимание частоту, 
с которой пользователи выполняют эту операцию, облако с большим количеством пользователей может значительно 
увеличить нагрузку. 
Это может произойти даже без их ведома — оставленная открытой в браузере закладка экземпляра 
инструментальной панели (Dashboard) OpenStack обновляет список виртуальных машин каждые 30 секунд.</p>

<p>После того, как вы учтете эти факторы, вы можете определить то, как много ядер потребуется контроллеру 
облака. 
Учитывая вышеперечисленные рассуждения, для стойки вычислительных узлов достаточно обычного сервера с 8ю 
ядрами и 8 ГБ ОЗУ.</p>

<p>Также вы должны проанализировать ключевые характеристики производительности для пользовательских 
виртуальных машин.
Вы должны принимать во внимание как бюджет, так и ограничения бюджета.
Примеры параметров включают в себя: производительность систем хранения (шпиндели/ядра), доступность 
памяти (ОЗУ/ядра), пропускная способность сети  (Гбит в секунду/ядра) и общая производительность 
процессора (CPU/ядра).</p>

<p>Для знакомства с метриками, определяющими масштабирование вашего облака, отсылаем вас к 
<a class="red-heading" href="Ch13ru.htm">Главе 13</a>.</p>

<h2 id="Ch0302">Добавление узлов контроллера</h2>

<p>Вы можете облегчить горизонтальное расширение вашего облака добавляя узлы. 
Добавление вычислительных узлов выполняется легко — они легко подхватывают существующие установки.
Однако, при создании кластера высокой доступности необходимо учитывать некоторые важные моменты.</p>

<p>Напомним, что узел контроллера облака выполняет несколько различных служб.
Для целей расширения на новом сервере вы можете установить службы, которые будут взаимодействовать 
внутри исключительно с использованием очередей сообщений —  <code>nova-scheduler</code> и 
<code>nova-console</code>. 
Тем не менее, другие составные части требуют большего внимания.</p>

<p>Вы должны осуществлять баланс нагрузки служб пользователя, таких как инструментальная панель 
(Dashboard), <code>nova-api</code> или прокси хранения объектов. 
Используйте любой стандартный метод балансировки нагрузки HTTP (круговой [round robin] DNS, аппаратная 
балансировка нагрузки, программное обеспечение, подобное Pound или HAProxy). 
Одно предостережение в отношении инструментально панели (Dashboard) касается прокси VNC, который 
использует протокол WebSocket — нечто, с чем может бороться балансировщик нагрузки L7. 
Ознакомьтесь также с <span class="red-heading">Horizon session storage</span> 
(<a href="http://docs.openstack.org/developer/horizon/topics/deployment.html#session-storage">
http://docs.openstack.org/developer/horizon/topics/deployment.html#session-storage</a>).</p>

<p>Вы можете настроить некоторые службы, такие как <code>nova-api</code> и <code>glance-api</code> 
для использования нескольких процессов, изменив флаг в их конфигурационном файле — позволив тем 
самым им совместно работать с несколькими ядрами на одном компьютере.</p>

<p>Существует множество вариантов балансировки нагрузки для MySQL и RabbitMQ имеет встроенную поддержку 
кластеризации.
Информацию о том, как настроить эту и многие другие службы можно найти в разделе эксплуатации 
(<strong>Operations Section</strong>).</p>

<h2 id="Ch0303">Разделение ваших облаков</h2>

<p>Используйте один из следующих методов OpenStack для разделения ваших облаков:  <em>ячейки 
(cell)</em>, <em>области (region)</em>, <em>зоны (zone)</em> и <em>объединения хостов (host aggregate)</em>. 
Каждый метод обеспечивает свою функциональность, описанную в приводимой ниже таблице:</p>

<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody>
<tr>
 <td class="big_16h">&nbsp;</td>
 <td class="big_16h">Ячейки<br />(Cells)</td>
 <td class="big_16h">Области<br />(Regions)</td>
 <td class="big_16h">Зоны доступности<br />(Availability Zones)</td>
 <td class="big_16h">Объединения хостов<br />(Host Aggregates)</td></tr>

<tr><td><strong>Используйте, когда вам нужно</strong></td>
 <td>Единый <span class="red-heading">API конечной точки</span> для вычислений или вам потребуется 
 второй уровень планирования. </td>
 <td>Дискретные области с отдельными конечными точками API и отсутствием согласования меду областями. </td>
 <td>Логическое разделение в пределах вашего развертывания nova для физической изоляции или 
 отказоустойчивости.</td>
 <td>Для управления группой хостов с общими характеристиками.</td></tr>

<tr><td><strong>Пример</strong></td>
 <td>Облако с множеством сайтов, в котором вы можете планировать ВМ &quot;где угодно&quot; или на 
 определенном сайте.</td>
 <td>Облако с множеством сайтов, в котором вы управляете ВМ определенного сайта и вам требуется общая инфраструктура.</td>
 <td>Отдельное облако сайта с оборудованием, запитываемым от отдельных источников.</td>
 <td>Планирование для хостов с высоконадежной поддержкой аппаратных средств.</td></tr>

<tr><td><strong>Накладные расходы</strong></td>
 <td>• Новая служба, <code>nova-cells</code><br />
  • Каждая ячейка имеет полную установку nova, за исключением <code>nova-api</code></td>
 <td>• Различные конечные точки API для каждой области.<br />
  • Каждая область имеет полную установку nova.</td>
 <td>• Изменения настроек для nova.conf</td>
 <td>• Изменения настроек для nova.conf</td></tr>

<tr><td><strong>Совместно используемые службы</strong>
 <td>Keystone<br /><code>nova-api</code></td>
 <td>Keystone </td>
 <td>Keystone<br />Все службы nova</td>
 <td>Keystone<br />Все службы nova</td></tr>
</tbody></table>

<p>Этот массив вариантов может быть разделен на два — те, кто приводят к выполнению раздельных реализаций 
nova (ячейки и области) и те, которые совместно используют 
(<span class="red-heading">зоны доступности</span> и объединения хостов).</p>

<h2 id="Ch030302">Ячейки и области</h2>

<p>Ячейки OpenStack Compute разработаны для возможности работы облака в распределенном режиме без 
необходимости использования более сложных технологий, или для принуждения использования существующих 
установок nova.
Хосты в облаке разбиваются на группы, называемые клетками (cells).
Клетки настраиваются в дерево.
Клетки верхнего уровня (&quot;API cell&quot;) имеют хост, на котором выполняется служба <code>nova-api</code>, 
однако отсутствуют службы <code>nova-compute</code>.
Каждая клетка потомка выполняет все другие типичные службы <code>nova-*</code>, найденные в обычной 
установке, за исключением службы <code>nova-api</code>. 
Каждая клетка имеет свою очередь сообщений и службу базы данных, а также выполняет  <code>nova-cells</code>
 — который управляет взаимодействием между API клетки и клетками- потомками.</p>

<p>Это позволяет использовать один сервер API для управления множеством установок облаков.
Предоставление второго уровня управления (в выборе клеток), в дополнение к обычному 
<code>nova-scheduler</code> выбору хостов обеспечивает большую гибкость управлению выбора места 
запуска виртуальной машины.</p>

<p>Сравните это с областями.
Области имеют отдельную конечную точку API на одну установку, что допускает более дискретное разделение.
Пользователи, желающие выполнять экземпляры на сайтах, должны выбирать область в явном виде.
Однако при этом не требуется дополнительное усложнение запуска новой службы.</p>

<p>Инструментальная панель OpenStack (Horizon) в настоящее время использует только одну область, 
так что в каждой области должна работать одна служба инструментальной панели.
Области являются надежным способом разделения определенной инфраструктуры между установками OpenStack 
Compute, гарантируя при этом высокую степень отказоустойчивости.</p>

<h2 id="Ch030303">Зоны доступности и объединения хостов</h2>

<p>Вы можете использовать зоны доступности, объединения хостов или и то, и другое одновременно для 
разделения установки nova.</p>

<p>Зоны доступности реализуются и настраиваются аналогично объединениям хостов.</p>

<p>Однако, вы используете зону доступности и объединение хостов по разным причинам:
</p>

<ul>
 <li><strong>Зона доступности.</strong>
  Позволяет вам организовывать хосты OpenStack Compute в логические группы и представляет собой форму 
  физической изоляции и избыточности по отношению к другим зонам доступности, которые используют другой 
  источник питания или другое сетевое оборудование.
  <br />
  Вы определяете зону доступности, в которой расположен локально на каждом сервере указанный хост 
  вычислений.
  Зона доступности обычно используется для определения набора серверов, имеющих общее свойство.
  Например, если некоторые стойки в вашем центре данных имеют отдельный источник питания, вы можете 
  поместить сервера этих стоек в их собственную зону доступности. 
  Зона доступности могут также помочь отделять различные классы оборудования.
  <br />
  Когда пользователи запрашивают оборудование, они могут указать из каких зон они хотят строить свой 
  экземпляр.
  Это позволяет снабдить пользователей облака возможностью распределения их ресурсов приложений по разным 
  компьютерам для достижения высокой доступности при сбоях оборудования.

 <li><strong>Объединение хостов.</strong>
  Делает возможным для вас разделять развертывание OpenStack Compute в логические группы для балансировки 
  нагрузки и распределения экземпляра.
  Вы можете использовать объединение хостов для дальнейшего разделения на зоны доступности.
  Например, вы можете использовать объединение хостов для разделения зон доступности на группы хостов, 
  которые либо имеют общие ресурсы, такие как СХД и сетевое оборудование, или имеют особую функциональность,
  например, высоконадежное компьютерное оборудование.</ul>

<p>Широко применяемым использованием объединений хостов является предоставление информации для 
планировщика nova.
 Например, вы можете использовать объединение хостов для объединения нескольких в группу, которая 
 совместно использует определенные особенности (flavors) или образы.</p>

<p>
 <img src="i/Tip.jpg" alt="Tip" />
 Ранее все службы имели зону доступности.
 В настоящее время свою собственную зону доступности имеют только службы nova-compute.
 Службы, подобные nova-scheduler, nova-network, nova-conductor всегда распространяются на все зоны 
 доступности.
 <br />
 Когда вы выполняете любую из следующих операций, соответствующие службы появляются в их собственных 
 внутренних зонах доступности (CONF.internal_service_availability_zone):
 <ul>
   <li>список хостов nova (os-hosts)
   <li>детали euca-describe-availability-zones
   <li>список служб nova-manage
 </ul>
 Внутренняя зона доступности скрыта в euca-describe-availability_zones (non-verbose).
  <br />
  CONF.node_availability_zone была переименована в CONF.default_availability_zone и используется только 
  в службах nova-api и nova-scheduler. 
  <br />
  CONF.node_availability_zone все еще работает, но признана устаревшей.
</p>

<h2 id="Ch0304">Масштабируемое оборудование</h2>

<h3 id="Ch030401">Закупка оборудования</h3>

<p>&quot;Облако&quot; было описано как неустойчивая среда, в которой  серверы могут создаваться и 
удаляться по желанию.
 Хотя это может быть правдой, это совсем не означает, что ваши серверы должны быть нестабильными.
 Обеспечение вашего облака надежным и правильно настроенным оборудованием означает, что ваше облако 
 остается запущенным и работающим.
 Обычно усилия направлены на создание надежной среды аппаратных средств, следовательно вы можете 
 предоставлять облако, которое пользователи могут рассматривать как нестабильное или изменчивое.</p>

<p>OpenStack может быть развернут на любом оборудовании, поддерживаемом OpenStack-совместимым 
дистрибутивом Linux, например, используемым в эталонной архитектуре данной книги Ubuntu 12.04.</p>

<p>Оборудование не обязано быть неизменным, однако, по крайней мере, должно иметь один и тот же тип 
процессора для поддержки миграции экземпляра.
</p>

<p>Рекомендуемым обычно оборудованием для использования в OpenStack является стандартное предложение, 
стоящее уплаченных за него денег, которое предлагает большинство производителей аппаратных средств.
Необходимо просто разделить ваши закупки на строительные блоки, такие как &quot;вычислители&quot;, 
&quot;хранилища объектов&quot; и &quot;контроллеры облака&quot; и закупать их столько, сколько необходимо. 
Возможно вам не потребуется тратить дополнительные средства, если вы уже имеете серверы, если они 
отвечают вашим требованиям производительности и технологии виртуализации, что весьма вероятно, 
для поддержки OpenStack.</p>

<h3 id="Ch030402">Планирование емкости</h3>

<p>OpenStack разработан для увеличения в размерах прямым образом.
Принимая во внимание соображения  главы <strong>Масштабируемость</strong> — в особенности в отношении 
размеров контроллера облака — по мере необходимости, возможно, потребуется приобретение дополнительных 
узлов для вычислений или хранения объектов.
Новые узлы не обязаны иметь ту же спецификацию, или даже того же производителя, что и существующие узлы.</p>

<p>Для вычислительных узлов, планировщик nova будет заботиться о различиях в размерах для соблюдения 
требований к числу ядер и объему памяти, однако вы должны проанализировать изменения квалификации 
пользователей при различных скоростях процессоров. 
При добавлении узлов хранения объектов, должен быть указан <span class="red-heading">вес</span>, 
который отражает <span class="red-heading">емкость</span> узла.</p>

<p>Мониторинг использования ресурса и роста числа пользователей позволит вам определить время новой 
закупки. 
Глава <strong>Мониторинг</strong> описывает некоторые полезные метрики.
</p>

<h3 id="Ch030403">Нагрузочные испытания</h3>

<p>Вероятность отказа сервера велика в начале и конце его жизни.
Как результат, можно избежать больших затрат в работе с оборудованием при его эксплуатации путем 
проведения надлежащих отбраковочных испытаний на ранней стадии, чтобы попытаться вызвать отказы.
 Общий принцип заключается в нагрузке оборудования до его пределов. 
 Примеры нагрузочных испытаний включают в себя работу тестов процессоров и дисков на протяжении нескольких 
 дней.</p>

<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody><tr>
 <td align="left"><a href="Ch02ru.htm">Глава 2</a></td>
 <td align="center"><a href="index.htm">Оглавление</a></td>
 <td align="right"><a href="Ch04ru.htm">Глава 4</a></td>
</tr><tr><td colspan="3" style="border-bottom: thin solid;">&nbsp;</tr>
<tr><td colspan="2" valign="top">Перевод: Copyright ©&nbsp;2014 &nbsp;<img src="/i/mdl-reg.jpg" widht="35" height="12" style="border-style: none;">.<br>
All rights reserved.<br />
Ссылки обязательны (Refs and links obligatory).</td>
<td valign="top" align="right"><em><a href="http://www.mdl.ru">http://www.mdl.ru</a></em></td></tr>
</tbody></table>


<td align="right" valign="top">
<script language="javascript">
WriteABC('GPFS');
//--></script>
</tr>
</tbody></table>
</tbody></table>
</body>
</html>
