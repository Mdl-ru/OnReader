<html>
<head>
   <link rel="icon" href="/i/MdlLogo.gif" type="image/gif">
   <title>Глава 6. Проектирование сети. Руководство по эксплуатации OpenStack.</title>
   <meta name="Keywords" content="OpenStack, Cloud computing, Swift, RESTful, Object Storage, Ceph, CORS, CNAME lookup, Domain remap, Health check, Rate limiting, Bulk delete, Container qoutas, account qoutas, TempURL, Static Web, Form post, recon, Swift origin server, Bulk archive auto-extraction">
   <meta name="Description" content="Глава 6. Проектирование сети. Руководство по эксплуатации OpenStack.">
   <meta name="Robots" content="INDEX, FOLLOW">
   <meta name="Author" content="Module-Projects,Ltd">
   <meta name="Copyright" content="Copyright 1998..2014 Module-Projects,Ltd">
   <meta http-equiv="Pragma" content="no-cache">
<script language="javascript" src="/css/v.0/mdlcss.js"></script>
<style type="text/css" media="screen, print">@import url("i/global-20140610.css");</style>
<script language="javascript" src="http://www.mdl.ru/usd.js"></script>
	<script language="javascript" src="http://www.mdl.ru/js/common.js"></script>
	<script language="javascript" src="http://www.mdl.ru/Solutions/ABC.js"></script>
</head>
<body>

<table class="bg_White" width="1024" align="center" valign="top" border="0" cellpadding="0" cellspacing="0"><tbody>
<tr>
<td>
<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody>
<tr>
<td width="150" valign="top" align="center"><img src="http://www.mdl.ru/RMC9.jpg" border=0 /></td>
<td width="724" valign="bottom" align="center">
<a class="item-t" href="http://www.mdl.ru"><img src="http://www.mdl.ru/i/MdlBigLogo.gif" border="0"></a><br/>
<a class="item-t" href="http://www.mdl.ru">С 1991 года на компьютерном рынке России</a>
</td>
<td align="center" valign="bottom">
<a class="item-t" href="javascript:tocall()" onmouseover="this.href=mail"><img src="http://www.mdl.ru/i/9563499.gif" border="0" alt="e-mail" /><br/><br/>т.: 676 0965, 676 0396<br/>Москва, Сосинская ул. 43, <br/>м. Волгоградский проспект</a>
</td>
</tr>
<tr>
<td class="big_16y" colspan="3" align="center"><a href="index.htm">Руководство по эксплуатации OpenStack</a></td>
</tr>
<tr><td colspan="2">


<h2 align="right">ГЛАВА 6</h2>
<hr />
<h1 id="Chapter_06" align="right">Проектирование сети</h1>

<em>Пользуйтесь переводом <strong>существенно переработанной и дополенной <a href="http://onreader.mdl.ru/openstack-ops/content/network_design.html">2й редакции</a></strong> (12-дек-2014),<br />
находящейся теперь и в режиме <a href="http://docs.openstack.org/openstack-ops/content/network_design.html">постоянно обновляемой документации</a> <br />
(последняя пока доступна только на англ.яз.).</em><br />
<p></p>

<p>OpenStack предоставляет богатое сетевое окружение, а данная глава подробно излагает требования и варианты 
для рассмотрения при проектировании вашего облака.</p>
<p>Если это ваше первое развертывание облачной инфраструктуры в вашей организации, после прочтения 
данного раздела вам необходимо вначале обсудить планы с вашей сетевой командой.
 Использование сети в рабочем облаке сильно отличается от традиционных сетевых развертываний, и имеет 
 потенциал к саморазрушению как на уровне связности, так и на уровне политик.</p>
<p>Например, вы должны планировать количество IP-адресов, которые вам потребуется как для гостевых экземпляров, 
так и для инфраструктуры управления.
 Кроме того, вам необходимо изучить и обсудить сетевые подключения облака через прокси-серверы и межсетевые 
 экраны.</p>

<h2 id="Ch0601">Управляющая сеть</h2>
<p>Сеть управления, как правило, состоит из отдельного коммутатора, причем опционально рекомендуются 
отдельные сетевые адаптеры.
 Такое выделение предотвращает доступ к системам администрирования и мониторинга от разрушения со 
 стороны трафика, генерируемого самими гостями.</p>
<p>Рассмотрите возможность создания других частных сетей для связи между внутренними компонентами 
OpenStack, такими как очереди сообщений (Message Queue) и OpenStack Compute.
 Для таких сценариев прекрасно подходят VLAN.</p>

<h2 id="Ch0602">Опции адресации из адресного пространства интернет</h2>
<p>Существуют два основных типа IP-адресов для гостевых виртуальных машин: фиксированные IP и плавающие IP.
 Фиксированные IP-адреса присваиваются экземплярам при загрузке, в то время как плавающие IP-адреса 
 могут менять свои связи с экземплярами в результате действий пользователя.
 Оба типа IP-адресов могут быть либо общедоступными (public), либо частными, в зависимости от вашего 
 варианта использования.</p>
<p>При потребности запуска OpenStack без плавающих IP-адресов, необходимы фиксированные IP-адреса.
 Одним из самых распространенных вариантов использования плавающих IP-адресов является предоставление 
 общедоступных IP-адресов в частном облаке при существовании ограничения на число доступных IP-адресов.
 Другим вариантом для пользователя общедоступного облака является необходимость наличия 
 &quot;статического&quot; IP-адреса, который может быть переназначен при обновлении или перемещении 
 экземпляра.</p>
<p>Фиксированные IP-адреса могут быть частными для частных облаков и общедоступными для общедоступных облаков.
 Фиксированный IP теряется после завершения работы экземпляра.
 Стоит отметить, что новые пользователи облачных вычислений могут быть расстроены такой эфемерностью.</p>

<h2 id="Ch0603">Планирование IP адресов</h2>
<p>Инсталляция OpenStack потенциально может иметь много подсетей, причем каждая подсеть может 
предоставлять различные виды услуг.
 Планирование IP адресов может помочь общему пониманию задач разделов сети и их масштабируемости.
 Службы управления могут иметь общедоступные и частные IP-адреса, и, как отмечалось выше, есть 
 несколько вариантов для адресации экземпляра в общедоступном адресном пространстве.</p>
<p>Планирование IP адресов может быть разбито на следующие разделы:</p>
<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody><tr>
 <td width="30%">маршрутизация подсетей</td>
 <td width="70%">Пакеты, покидающие подсеть, следуют через этот адрес, который может быть выделенным 
 маршрутизатором или службой nova-network.<br />&nbsp;</td>
</tr><tr>
 <td>управляющие службы общедоступных интерфейсов</td>
 <td>Через эти адреса осуществляется общий доступ к <code>swift-proxy</code>, <code>nova-api</code>, 
 <code>glance-api</code> и horizon.<br />&nbsp;, причем адреса могут быть по одну сторону за 
 балансировщиком нагрузки или указывать на отдельные компьютеры.</td>
</tr><tr>
 <td>внутренние коммуникации кластера хранилища объектов</td>
 <td>Эту частную сеть использует обмен между серверами объектов/ учетных записей / контейнеров, 
  а также между ними и внутренним интерфейсом серверов прокси.<br />&nbsp;</td>
</tr><tr>
 <td>взаимодействие компьютеров и хранилищ</td>
 <td>Эта сеть используется, если эфемерные или блочные хранилища являются внешними для 
 вычислительных узлов.<br />&nbsp;</td>
</tr><tr>
 <td>внеполосное удаленное управление</td>
 <td>Эта сеть обычно выделяется в отдельную, если в серверах имеется выделенная микросхема 
 контроллера удаленного доступа (<em>прим. пер.: например, с использованием протокола 
 IPMI</em>).<br />&nbsp;</td>
</tr><tr>
 <td>внутриполосное удаленное управление</td>
 <td>Для системного администрирования или средств мониторинга на вычислительных узлах или узлах 
 хранения обычно используется дополнительный интерфейс (например, 1Гб) вместо 
 общественного интерфейса.<br />&nbsp;</td>
</tr><tr>
 <td>свободное пространство для роста в будущем</td>
 <td>Часть вашего планирования всегда должна предусматривать добавление дополнительных услуг 
 служб управления на общедоступной стороне или дополнительных IP гостевых экземпляров.<br />&nbsp;</td>
</tr></tbody></table>

<p>В качестве примера рассмотрим развертывание и OpenStack Compute, и Object Storage при доступных 
диапазонах частных адресов 172.22.42.0/24 и 172.22.87.0/26.
 Одним из вариантов деления пространства может быть следующий:</p>
 <code>
172.22.42.0/24:<br />
172.22.42.1 - 172.22.42.3 - маршрутизаторы подсети<br />
172.22.42.4 - 172.22.42.20 - резерв для сетей<br />
172.22.42.21 - 172.22.42.104 - Контроллеры удаленного доступа вычислительных узлов (включая резерв)<br />
172.22.42.105 - 172.22.42.188 - Интерфейсы управления вычислительными узлами (включая резерв)<br />
172.22.42.189 - 172.22.42.208 - Контроллеры удаленного доступа прокси Swift  (включая резерв)<br />
172.22.42.209 - 172.22.42.228 - Интерфейсы управления прокси Swift  (включая резерв)<br />
172.22.42.229 - 172.22.42.252 - Контроллеры удаленного доступа серверов хранения Swift (включая резерв)<br />
172.22.42.253 - 172.22.42.254 - резерв<br />
172.22.87.0/26:<br />
172.22.87.1 - 172.22.87.3 - маршрутизаторы подсети<br />
172.22.87.4 - 172.22.87.24 - Внутренние интерфейсы серверов прокси Swift  (включая резерв)<br />
172.22.87.25 - 172.22.87.63 - Внутренние интерфейсы серверов объектов Swift (включая резерв)<br />
 </code><br />
<p>Аналогичный подход может быть принят для общедоступных IP-адресов, принимая во внимание, что крупные, 
диапазоны без сегментации являются предпочтительными к использованию для IP-адресов гостевых экземпляров.
 Учтите, что для определенных сетевых вариантов OpenStack, хостам nova-compute назначаются общедоступные 
 IP адреса в диапазоне общедоступных IP адресов гостевых экземпляров.</p>

<h2 id="Ch0604">Топология сети</h2>
<p>OpenStack предоставляет несколько приложений сетевого администрирования, каждое обладает своими 
сильными и слабыми сторонами.
 Выбор менеджера сети изменяеет топологию вашей сети, следовательно он должен быть тщательно продуманным.</p>
<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody>
<tr>
<td class="big_16h">тип</td>
<td class="big_16h">Преимущества</td>
<td class="big_16h">недостатки</td>
</tr><tr>
<td>Flat</td>
<td>Чрезвычайно простой.<br />
  Отсутствует широковещательный DHCP.<br />
</td>
<td> Требует инъекции файлов в экземпляр<br />
 Огранечен на ряд дистрибутивов Linux.<br />
 Сложен в настройке и не рекомендуется.<br />
 &nbsp;
</td>
</tr><tr>
<td>FlatDHCP</td>
<td> Относительно прост в настройке.<br />
 Стандартное подключение к сети.<br />
 Работает со всеми операционными системами.<br />
 &nbsp;</td>
<td>
 Требует свой собственный домен DHCP.<br /></td>
</tr><tr>
<td>VlanManager</td>
<td>Каждому владельцу выделяется своя собственная VLAN.</td>
<td>Более сложен в настройке.<br />
 Требуется свой широковещательный домен DHCP.<br />
 Для создания магистрального порта (транкинга на один порт) требуется много VLAN.<br />
 Стандартное ограничение на число VLAN.<br />
 Коммутаторы должны поддерживать расстановку тегов 802.1q VLAN<br />
 &nbsp;</td>
</tr><tr>
<td>FlatDHCP Multihost HA</td>
<td>Сетевой отказ изолируется на виртуальных машинах, работающих на пострадавшем гипервизоре.
 DHCP- трафик может быть ограничен в пределах одного хоста.<br />
 Сетевой трафик распределяется на вычислительные узлы.<br />
 <br />
 &nbsp;</td>
<td>Более сложная настройка. <br />
 По умолчанию для вычислительных узлов требуются общедоступные IP адреса.<br />
 Для работы с миграцией в реальном масштабе времени при работе с сетью требуется тщательная настройка опций.</td>
</tr>
</tbody></table>

<h3 id="Ch060402">VLAN-ы</h3>
<p>Конфигурация VLAN, в зависимости от желания, может быть простой или сложной.
 Использование VLAN, имеет то преимущество, что обеспечивает каждому проекту свою собственную 
 подсеть и отделяет широковещательные сообщения от других проектов.
 Для эффективного использования сети VLAN со стороны OpenStack, необходимо выделить диапазон 
 VLAN (один для каждого проекта) и сосредоточить все порты вычислительных узлов в коммутаторе в 
 единый магистральный порт (trunk port).</p>
<p>Например, если в соответствии с вашими оценками данное облако должно поддерживать максимально 
100 проектов, найдите не используемый в настоящее время инфраструктурой свободный диапазон 
VLAN (например, VLAN 200 - 299).
 Вы должны настроить OpenStack на работу с этим диапазоном, а также настроить порты коммутатора 
 на допуск трафика VLAN для этого диапазона.</p>

<h3 id="Ch060403">Множественные NIC</h3>
<p>OpenStack Compute имеет возможность назначать множество сетевых карт экземпляру на основе подхода 
одна на проект.
Как правило, это дополнительная функция, не являющаяся повседневным запросом.
Однако, это может быть легко реализовано на основе сервиса по запросу.
Однако, следует помнить, что второй сетевой адаптер будет полностью использован всей подсетью или VLAN.
Это уменьшит общее количество ваших поддерживаемых проектов на единицу.</p>

<h3 id="Ch060404">Работа в сети с многими хостами и с одним хостом</h3>
<p>Служба nova-network имеет возможность работы в режиме многими хостами или с одним хостом.
 При режиме с многими хостами каждый вычислительный узел работает с копией nova-network, а экземпляры на 
 этом вычислительном узле используют вычислительный узел в качестве шлюза в интернет.
 Вычислительные узлы для экземпляров на этом узле также размещают плавающие IP-адреса и группы безопасности.
 При режиме с центральным сервером в качестве единого хоста, контроллер облака, например, запускает службу 
 <code>nova-network</code> .
 Все вычислительные узлы передают трафик от экземпляров в контроллер облака. 
 Затем контроллер облака передает трафик в сеть Интернет.
 Контроллер облака размещает плавающие IP-адреса и группы безопасности для всех экземпляров на всех 
 вычислительных узлах в облаке.</p>
<p>Каждый режим имеет свои преимущества.
 Единый узел имеет оборотную сторону единой точки отказа.
 Если контроллер облака недоступен, экземпляры не смогут взаимодействовать с сетью.
 Это не так для варианта с множеством хостов, однако вариант с множеством хостов требует, чтобы каждый 
 вычислительный узел имел общедоступный IP-адрес для связи через интернет.
 Если у вас нет возможности получить значительный блок общедоступных IP-адресов, вариант с множеством 
 хостов не может быть вашим выбором.</p>

<h2 id="Ch0605">Службы для функционирования сети</h2>
<p>>OpenStack, как и любое сетевое приложение, имеет ряд необходимых к применению стандартных факторов
например, таких как DNS и NTP.</p>

<h3 id="Ch060501">NTP</h3>
<p>Синхронизация времени является важнейшим элементом для обеспечения бесперебойной работы компонентов 
OpenStack.
 Чтобы избежать ошибок при планировании необходимо правильное время, например при репликации объектов в 
 хранилище объектов, а также согласованных меток времени для отладки.</p>
<p>Все серверы, выполняющие компоненты OpenStack должны быть в состоянии обеспечить доступ к 
соответствующему серверу NTP.
 Вы можете принять решение о настройке локального сервера, или использовать общественные пулы, доступные 
 с <a href="http://www.pool.ntp.org/">http://www.pool.ntp.org/</a></p>

<h3 id="Ch060502">DNS</h3>
<p>OpenStack в настоящее время не предоставляет услуги DNS, помимо демона dnsmasq, который расположен 
на хостах <code>nova-network</code>.
 Вы можете рассмотреть вопрос о предоставлении динамической службы DNS для предоставления возможности 
 экземплярам обновлять запись DNS новыми IP-адресами. 
 Вы также можете рассмотреть создание общего прямого и обратного отображения DNS для IP-адресов 
 экземпляра, например vm-203-0-113-123.example.com.</p>

<table width="100%" border="0" cellpadding="2" cellspacing=0 class="bg_White"><tbody><tr>
 <td align="left"><a href="Ch05ru.htm">Глава 5</a></td>
 <td align="center"><a href="index.htm">Оглавление</a></td>
 <td align="right"><a href="Ch07ru.htm">Глава 7</a></td>
</tr><tr><td colspan="3" style="border-bottom: thin solid;">&nbsp;</tr>
<tr><td colspan="2" valign="top">Перевод: Copyright ©&nbsp;2014 &nbsp;<img src="/i/mdl-reg.jpg" widht="35" height="12" style="border-style: none;">.<br>
All rights reserved.<br />
Ссылки обязательны (Refs and links obligatory).</td>
<td valign="top" align="right"><em><a href="http://www.mdl.ru">http://www.mdl.ru</a></em></td></tr>
</tbody></table>


<td align="right" valign="top">
<script language="javascript">
WriteABC('GPFS');
//--></script>
</tr>
</tbody></table>
</tbody></table>
</body>
</html>
