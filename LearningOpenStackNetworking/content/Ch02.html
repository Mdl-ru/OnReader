<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:exsl="http://exslt.org/common" xmlns:ng="http://docbook.org/docbook-ng" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"/>
<title>Глава 2. Установка OpenStack</title>
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/>
<meta name="mavenGroupId" content="www.mdl.ru"/>
<meta name="mavenArtifactId" content="LearningOpenStackNetworking"/>
<meta name="mavenVersionId" content="1.0.0"/>
<link rel="home" href="index.html" title="Изучаем сетевую среду OpenStack (Neutron)"/>
<link rel="up" href="index.html" title="Изучаем сетевую среду OpenStack (Neutron)"/>
<link rel="prev" href="Ch01.html" title="Глава 1. Подготовка сети для OpenStack"/>
<link rel="next" href="Ch03.html" title="Глава 3. Установка Neutron"/>
<meta name="git-sha" content=""/>
<meta name="buildTime" content=""/>
<script type="text/javascript">
            //The id for tree cookie
            var treeCookieId = "treeview-openstack-operations-guide";
            var language = "en";
            var w = new Object();
            //Localization
            txt_filesfound = 'Results';
            txt_enter_at_least_1_char = "You must enter at least one character.";
            txt_browser_not_supported = "Please enable JavaScript.";
            txt_please_wait = "Please wait. Search in progress...";
            txt_results_for = "Results for: ";
</script>
<style type="text/css">
            input {
            margin-bottom: 5px;
            margin-top: 2px;
            }

            .folder {
            display: block;
            height: 22px;
            padding-left: 20px;
            background: transparent url(../common/jquery/treeview/images/folder.gif) 0 0px no-repeat;
            }
</style>
<link rel="shortcut icon" href="../MdlLogo.gif" type="image/gif"/>
<link rel="stylesheet" type="text/css" href="../common/css/positioning.css"/>
<link rel="stylesheet" type="text/css" href="../common/css/custom.css"/>
<link rel="canonical" href="http://docs.openstack.org/openstack-ops/content//openstack-ops_preface.html"/>
<!--[if IE]>
	<link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../common/jquery/theme-redmond/jquery-ui-1.8.2.custom.css"/>
<link rel="stylesheet" type="text/css" href="../common/jquery/treeview/jquery.treeview.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery-ui-1.8.2.custom.min.js"><!----></script>
<script type="text/javascript" src="../common/jquery/jquery.cookie.js"><!----></script>
<script type="text/javascript" src="../common/jquery/treeview/jquery.treeview.min.js"><!----></script>
<link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css"/>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.min.js">
<!--jQuery plugin for glossary popups. --></script><script type="text/javascript" src="search/htmlFileList.js"><!----></script>
<script type="text/javascript" src="search/htmlFileInfoList.js"><!----></script>
<script type="text/javascript" src="search/nwSearchFnt.js"><!----></script>
<script type="text/javascript" src="search/stemmers/en_stemmer.js">
<!--//make this scalable to other languages as well.--></script>
<script type="text/javascript" src="search/index-1.js"><!----></script>
<script type="text/javascript" src="search/index-2.js"><!----></script>
<script type="text/javascript" src="search/index-3.js"><!----></script>
<script type="text/javascript">
	    var _gaq = _gaq || [];
	    _gaq.push(['_setAccount', 'UA-17511903-1']);
	    
	    _gaq.push(['_setDomainName', '.openstack.org']);	        
</script>
<script type="text/javascript" src="../common/ga.js"><!----></script>
<script language="javascript" src="/js/common.js"></script>
<link rel="stylesheet" href="../common/css/googlecode.css">
<script src="../common/highlight.pack.js"></script>
</head>
<body>
<!----><script type="text/javascript"><!--
hljs.initHighlightingOnLoad();
HeaderName = 'Глава 2. Установка OpenStack';
PrevRef = 'Ch01.html';
UpRef = 'index.html';
NextRef = 'Ch03.html';//-->
</script>
<!----><script type="text/javascript" src="HeaderAndToolbar.js">
</script><script type="text/javascript"><!--
document.write(HeaderAndToolbar); //-->
</script>
<div id="content">
 <div class="part">
  <div xmlns="" class="titlepage"><div><div><h1 xmlns="http://www.w3.org/1999/xhtml" class="title">
   Глава 2. Установка OpenStack</h1>
  </div></div></div>

  <div class="toc"><p><strong>Содержание</strong></p>
   <dl>
	<dt><span class="section"><a href="Ch02.html#system_requirements">Требования системы</a></span></dt>
	  <dd><dl>
        <dt><span class="section"><a href="Ch02.html#os_requirements">Требования операционной системы</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#initial_network_config">Начальная настройка сети</a></span></dt>
	    <dd><dl>
          <dt><span class="section"><a href="Ch02.html#interface_config">Настройка интерфейса</a></span></dt>
        </dl></dd>
      </dl></dd>
	<dt><span class="section"><a href="Ch02.html#before_you_begin">Перед тем как вы начнете</a></span></dt>
	  <dd><dl>
        <dt><span class="section"><a href="Ch02.html#permissions">Права доступа</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#config_repository">Настройка репозитория OpenStack</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#instal_utilities">Установка утилит OpenStack</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#set_hostnames">Задание имен хостов</a></span></dt>
	    <dd><dl>
          <dt><span class="section"><a href="Ch02.html#disabling_SELinux">Запрет SELinux</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#remove_iptables_rules">Удаление правил iptables</a></span></dt>
        </dl></dd>
      </dl></dd>
      <dt><span class="section"><a href="Ch02.html#instal_and_config_NTP">Установка и настройка протокола службы времени</a></span></dt>
      <dt><span class="section"><a href="Ch02.html#upgrade_system">Модернизация системы</a></span></dt>
	<dt><span class="section"><a href="Ch02.html#instal_OpenStack">Установка OpenStack</a></span></dt>
	  <dd><dl>
        <dt><span class="section"><a href="Ch02.html#MySQL_server">Установка и настройка сервера баз данных MySQL</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#MySQL_client">Установка клиента MySQL</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#messaging_server">Установка и настройка сервера сообщений</a></span></dt>
        <dt><span class="section"><a href="Ch02.html#identity_service">Установка и настройка службы идентификации</a></span></dt>
	    <dd><dl>
          <dt><span class="section"><a href="Ch02.html#define_users_tenants_roles">Определение пользователей, владельцев и ролей в Keystone</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#define_services_API_endpoints">Определение служб и API конечных точек в Keystone</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#verify_instal">Проверка установки Keystone</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#set_env_vars">Установка переменных среды</a></span></dt>
        </dl></dd>
        <dt><span class="section"><a href="Ch02.html#image_service">Установка и настройка службы образов</a></span></dt>
	    <dd><dl>
          <dt><span class="section"><a href="Ch02.html#define_Glance">Определение службы и API конечных точек Glance в Keystone</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#verify_Glance">Проверка установки службы образов Glance</a></span></dt>
        </dl></dd>
        <dt><span class="section"><a href="Ch02.html#compute_service">Установка и настройка вычислительной службы</a></span></dt>
	    <dd><dl>
          <dt><span class="section"><a href="Ch02.html#controller_node">Установка и настройка компонентов узла контроллера</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#compute_node">Установка и настройка компонентов вычислительного узла</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#verify_nodes_communication">Проверка связи между узлами</a></span></dt>
        </dl></dd>
        <dt><span class="section"><a href="Ch02.html#dashboard">Установка инструментальной панели OpenStack</a></span></dt>
	    <dd><dl>
          <dt><span class="section"><a href="Ch02.html#allow_connect">Разрешение соединения с инструментальной панелью</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#identify_Keystone">Идентификация сервера Keystone</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#change_listener">Изменение адреса прослушивания</a></span></dt>
          <dt><span class="section"><a href="Ch02.html#test_dashboard_connectivity">Проверка связи с инструментальной панелью</a></span></dt>
        </dl></dd>
      </dl></dd>
	<dt><span class="section"><a href="Ch02.html#Summary">Заключение</a></span></dt>
	</dl>
  </div>

  <p>Установка, настройка и сопровождение облаков OpenStack может быть трудной задачей при выполнении вручную. Многие сторонние поставщики 
  предлагают загружаемое облачное программное обеспечение, основанное на OpenStack, которые обеспечивает развертывание и стратегии управления 
  с помощью Chef, Puppet, Fuel, Ansible и других инструментов.</p>
  <p>Эта глава послужит вам руководством по установке на основе пакетов следующих компонентов OpenStack в операционной системе CentOS:</p>
  <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
	  <li class="listitem">Keystone</li>
	  <li class="listitem">Glance</li>
	  <li class="listitem">Nova Compute</li>
	  <li class="listitem">Horizon</li>
    </ul>
  </div>
  <p>Описанный в данной главе процесс установки основан на OpenStack <span class="emphasis"><em>Installation Guide</em></span> 
  для Red Hat Enterprise Linux, CentOS и Fedora, который создан на 
  <a class="xref" href="http://docs.openstack.org/" title="docs.openstack.org"><em>http://docs.openstack.org/</em></a>.
  </p>
  <p>Если вы предпочли загрузить дистрибутив стороннего производителя на основе OpenStack, попробуйте один из следующих:</p>
  <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
	  <li class="listitem"><span class="term"><span class="emphasis"><em>Rackspace Private Cloud</em></span></span>:
       <a class="xref" href="http://www.rackspace.com/cloud/private/" title="Rackspace Private Cloud"><em>http://www.rackspace.com/cloud/private/</em></a>.
	  </li>
	  <li class="listitem"><span class="term"><span class="emphasis"><em>RedHat RDO</em></span></span>:
       <a class="xref" href="http://openstack.redhat.com/" title="RedHat RDO"><em>http://openstack.redhat.com/</em></a>.
	  </li>
	  <li class="listitem"><span class="term"><span class="emphasis"><em>Mirantis OpenStack</em></span></span>:
       <a class="xref" href="http://software.mirantis.com/" title="Mirantis OpenStack"><em>http://software.mirantis.com/</em></a>.
	  </li>
	  <li class="listitem"><span class="term"><span class="emphasis"><em>Piston Cloud</em></span></span>:
       <a class="xref" href="http://www.pistoncloud.com/" title="Piston Cloud"><em>http://www.pistoncloud.com/</em></a>.
	  </li>
    </ul>
  </div>
  <p>После установки многие используемые в книге концепции и примеры должны по-прежнему применяться, но могут потребоваться дополнительные 
  усилия для реализации.</p>
  
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="system_requirements"> </a>Требования системы</h2>
   </div></div></div>
   <p>Компоненты OpenStack предназначены для запуска на стандартной аппаратуре, которая варьируется от настольных компьютеров до серверов 
   уровня предприятия. Процессоры вычислительных узлов требуют поддержки технологии виртуализации, подобной технологии Intel VT-x или 
   AMD AMD-v.</p>
   <p>Данная книга предполагает, что OpenStack будет установлена на физические аппаратные средства, которые отвечают следующим минимальным 
   требованиям:</p>
   <div class="section"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="overview_components-nova"> </a>Компоненты</h4></div></div></div>
   <table rules="all" id="d9e476"><col width="30%"/><col width="30%"/><col width="40%"/><thead><tr>
     <th >Сервер</th>
     <th>Рекомендуемое оборудование</th>
     <th>Замечания</th>
    </tr></thead><tbody><tr>
     <td><p>Узел контроллера (выполняет службы сетевой среды, томов, API, планировщика и образов)</p></td>
     <td><p>Процессор: 64-битный x86<br />
	  Оперативная память: 8ГБ<br />
	  Объем диска: 80ГБ<br />
	  Сеть: две сетевые платы интерфейса  1Gbps (NIC)</p></td>
     <td><p>Хотя может использоваться один NIC, это не рекомендуется, а также не рассматривается в данном построении</p></td>
    </tr><tr>
     <td><p>Вычислительный узел (выполняет виртуальные экземпляры)</p></td>
     <td><p>Процессор: 64-битный x86<br />
	  Оперативная память: 16ГБ<br />
	  Объем диска: 80ГБ<br />
	  Сеть: две сетевые платы интерфейса  1Gbps (NIC)</p></td>
     <td><p>Хотя может использоваться один NIC, это не рекомендуется, а также не рассматривается в данном построении</p></td>
    </tr></tbody></table>
    <p>Хотя и машины, которые не отвечают минимальным требованиям, могут допускать установку на основе описанной здесь документации, 
	тем не менее, здесь приведены данные требования чтобы гарантировать успешную практику.</p>

    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="os_requirements"> </a>Требования операционной системы</h3>
     </div></div></div>
    </div>
    <p>OpenStack в настоящее время собран в пакеты для следующих дистрибутивов: CentOS, Debian, Fedora, RHEL, openSUSE, SLES и Ubuntu.
	В данной книге мы предполагаем, что на все хосты перед установкой OpenStack была установлена операционная система CentOS 6.5:</p>
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
	  <li class="listitem"><span class="term"><span class="emphasis"><em>CentOS 6.5</em></span></span>:
       <a class="xref" href="http://www.centos.org/" title="centos.org"><em>http://www.centos.org/</em></a>.
	  </li>
     </ul>
    </div>
    <p>На момент написания рекомендовалась следующая минимальная версия ядра:</p>
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
	  <li class="listitem"><span class="term"><span class="emphasis"><em>Версия ядра</em></span></span>:
       31.20.3.el6.x86_64.
	  </li>
     </ul>
    </div>
    <p>Предыдущие версии ядра могут столкнуться с отсутствием поддержки пространств сетевых имен, которые используются различными службами 
	Neutron.</p>

    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="initial_network_config"> </a>Начальная настройка сети</h3>
     </div></div></div>
     <p>Для понимания того, как первоначально должна быть настроена сеть на каждом хосте давайте обратимся к следующему рисунку:</p>
     <div class="informalfigure"><div class="mediaobject">
      <img src="figures/Fig0201.jpg"/></div><br />
     </div>
     <p>На предыдущем рисунке к каждому хосту подключены кабели к двум интерфейсам. Интерфейс <span class="term"><code>eth0</code></span> 
	 будет служить в качестве интерфейса управления для служб OpenStack и доступа API, а  <span class="term"><code>eth1</code></span> 
	 будет использоваться в качестве моста для внешнего трафика и обмена владельца (tenant).</p>
     <p>Как минимум, интерфейс управления должен быть настроен с IP-адресом, который имеет исходящий доступ в интернет. Доступ в интернет 
	 необходим для загрузки пакетов OpenStack из репозитория пакетов. Рекомендуется входящий доступ к адресу сервер управления через 
	 SSH (TCP порт 22).</p>
     <p>На протяжении данной книги будут будут представлены примеры настроек и использованы различные службы OpenStack. Следующая таблица 
	 представляет VLAN-ы и связанные сети, используемые для этих служб:</p>
     <table rules="all" id="d9e477"><col width="35%"/><col width="30%"/><col width="35%"/><thead><tr>
       <th>Имя VLAN</th>
       <th>VLAN ID</th>
       <th>Сеть</th>
     </tr></thead><tbody><tr>
       <td><p>MGMT_NET</p></td>
       <td><p>10</p></td>
       <td><p>10.254.254.0/24</p></td>
     </tr><tr>
       <td><p>OVERLAY_NET</p></td>
       <td><p>20</p></td>
       <td><p>172.18.0.0/24</p></td>
     </tr><tr>
       <td><p>GATEWAY_NET</p></td>
       <td><p>50</p></td>
       <td><p>10.50.0.0/24</p></td>
     </tr><tr>
       <td><p>TENANT_NET30</p></td>
       <td><p>30</p></td>
       <td><p>10.30.0.0/24</p></td>
     </tr><tr>
       <td><p>TENANT_NET31</p></td>
       <td><p>31</p></td>
       <td><p>10.31.0.0/24</p></td>
     </tr><tr>
       <td><p>TENANT_NET32</p></td>
       <td><p>32</p></td>
       <td><p>10.32.0.0/24</p></td>
     </tr><tr>
       <td><p>TENANT_NET33</p></td>
       <td><p>33</p></td>
       <td><p>10.33.0.0/24</p></td>
     </tr></tbody></table>
     <p>Следующая таблица представляет рекомендуемые для каждого интерфейса IP адреса и ID VLAN, которые вы должны выбирать следуя нашим 
	 примерам:</p>
     <table rules="all" id="d9e478"><col width="30%"/><col width="15%"/><col width="30%"/><col width="25%"/><thead><tr>
       <th>Имя хоста</th>
       <th>Интерфейс</th>
       <th>Адрес IP</th>
       <th>Порт коммутации</th>
     </tr></thead><tbody><tr>
       <td><p><span class="term"><code>controller.learningneutron.com</code></span></p></td>
       <td><p><span class="term"><code>eth0</code></span></p></td>
       <td><p>10.254.254.100</p></td>
       <td><p>Порт доступа (VLAN 10, не помеченный- untagged)</p></td>
     </tr><tr>
       <td><p><span class="term">&nbsp;</p></td>
       <td><p><span class="term"><code>eth1</code></span></p></td>
       <td><p>С подключенным кабелем, но на данный момент не настроенный</p></td>
       <td><p>Магистральный (trunk) порт (VLAN 20, 30-33, 50)</p></td>
     </tr><tr>
       <td><p><span class="term"><code>compute01.learningneutron.com</code></span></p></td>
       <td><p><span class="term"><code>eth0</code></span></p></td>
       <td><p>10.254.254.101</p></td>
       <td><p>Порт доступа (VLAN 10, не помеченный- untagged)</p></td>
     </tr><tr>
       <td><p><span class="term">&nbsp;</p></td>
       <td><p><span class="term"><code>eth1</code></span></p></td>
       <td><p>С подключенным кабелем, но на данный момент не настроенный</p></td>
       <td><p>Магистральный (trunk) порт (VLAN 20, 30-33, 50)</p></td>
     </tr></tbody></table>
     <p>Интерфейс <span class="term"><code>eth1</code></span> каждого сервера будет настроен в 
	 <a class="xref" href="Ch04.html" title="Глава 4. Построение инфраструктуры виртуальной коммутации"><em>Главе 4. 
	 Построение инфраструктуры виртуальной коммутации</em></a>. На текущий момент интерфейс должен быть соединен кабелем и 
	 соответствующий порт коммутатора должен быть настроен как магистральный (trunk). На случай потери связи настоятельно рекомендуется 
	 через DRAC, iLo или другой механизм доступа контроллера управления системной платой (out-of-band).
	 </p>
	 
     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="interface_config"> </a>Настройка интерфейса</h4>
      </div></div></div>
      <p>CentOS применяет индивидуальные файлы интерфейса для описания их настройки. Как только система загружена, эти файлы используются 
	  для определения того какие интерфейсы поднимать и как они должны быть настроены. Файлы настройки интерфейса могут быть найдены в 
	  <span class="term"><code>/etc/sysconfig/network-scripts/</code></span></p>
      <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
       <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Совет</th></tr><tr><td align="left" valign="top">
       <p><span class="term"><span class="emphasis"><em>Загрузка кода примера</em></span></span></p>
       <p>Вы можете загрузить файлы примеров кода для всех купленных вами книг Packt из вашей учетной записи на 
	   <a class="xref" href="http://www.packtpub.com" title="Packt Publishing"><code>http://www.packtpub.com</code></a>.
	   Где бы вы ни приобрели оригинал книги, вы можете посетить <a class="xref" href="http://www.packtpub.com/support" 
	   title="Packt Publishing support"><code>http://www.packtpub.com/support</code></a> и зарегистрироваться, чтобы иметь 
	   файлы, высылаемые через e-mail непосредственно вам.</p></td></tr></table>
      </div>
      <p>С использованием текстового редактора измените соответствующий фал интерфейса для <span class="term"><code>eth0</code></span> 
	  на каждом хосте следующим образом:</p>
	  <pre class="screen">
# nano /etc/sysconfig/network-scripts/ifcfg-eth0</pre>
      <p>Далее приводится файл настройки <span class="term"><code>eth0</code></span> для узла контроллера:</p>
	  <pre class="screen">
DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=static
IPADDR=10.254.254.100
NETMASK=255.255.255.0
GATEWAY=10.254.254.1</pre>
      <p>Следующим идет файл настройки <span class="term"><code>eth0</code></span> для вычислительного узла:</p>
	  <pre class="screen">
DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=static
IPADDR=10.254.254.101
NETMASK=255.255.255.0
GATEWAY=10.254.254.1</pre>
      <p>Чтобы активировать внесенные изменения запустите повторяющуюся последовательность (cycle) для интерфейса с применением 
	  команд <span class="term"><code>ifdown</code></span> и <span class="term"><code>ifup</code></span> на каждом узле:</p>
	  <pre class="screen">
# ifdown eth0; ifup eth0</pre>
     </div>
    </div>
  </div>


  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="before_you_begin"> </a>Перед тем как вы начнете</h2>
   </div></div></div>
   <p>Перед тем как вы сможете установить OpenStack, для подготовки системы к успешной установке должна быть выполнена некоторая работа.</p>
   
    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="permissions"> </a>Права доступа</h3>
     </div></div></div>
     <p>Службы OpenStack могут быть установлены либо пользователем с правами root или с полномочиями <span class="term"><code>sudo</code></span>. 
	 Последнее может потребовать чтобы пользователь был добавлен в файл <span class="term"><code>sudoers</code></span> на каждом хосте. 
	 Для ознакомления с трюками настройки <span class="term"><code>sudoers</code></span>, пожалуйста, посетите следующий URL:<br />
	 <a class="xref" href="http://wiki.centos.org/TipsAndTricks/BecomingRoot" title="wiki.centos.org/TipsAndTricks/BecomingRoot">
	 <code>http://wiki.centos.org/TipsAndTricks/BecomingRoot</code></a><br />
	{<span class="emphasis"><em>Прим. пер.: Для Ubuntu рекомендуется создать файл, названный именем пользователя, в каталоге 
	<span class="term"><code>/etc/sudoers.d/</code></span>, содержащим следующую строку (для файла с именем 
	<span class="term"><code>/etc/sudoers.d/alice</code></span>):
	<pre class="screen">
alice ALL = (root) NOPASSWD:ALL</pre>
</em></span>},<br /> 
	 Для данной установки все команды должны выполняться с правами root, если не оговорено обратное.</p>
    </div>

    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="config_repository"> </a>Настройка репозитория OpenStack</h3>
     </div></div></div>
     <p>Установка OpenStack в CentOS использует пакеты репозитория RedHat RDO. Чтобы сделать репозиторий RDO доступным, на всех хостах 
	 загрузите и установите пакет <span class="term"><code>rdo-release-havana</code></span>:</p>
	 <pre class="screen">
# rpm -ivh http://repos.fedorapeople.org/repos/openstack/openstackhavana/rdo-release-havana-8.noarch.rpm</pre>
     <p>Пакет EPEL включает в себя ключи GPG для помощи в подписании пакетов и информации репозитория и должен быть установлен на 
	 всех хостах:</p>
	 <pre class="screen">
# rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epelrelease-6-8.noarch.rpm</pre>
    </div>

    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="instal_utilities"> </a>Установка утилит OpenStack</h3>
     </div></div></div>
     <p>На протяжении всей книги используется утилита <span class="term"><code>crudini</code></span> для того, чтобы сделать настройку 
	 различных служб быстрой и согласованной. <span class="term"><code>crudini</code></span> переписывает или добавляет индивидуальные установки 
	 настройки не переписывая весь файл. Следующая команда устанавливает <span class="term"><code>crudini</code></span> и другой полезный 
	 пакет настройки OpenStack, <span class="term"><code>openstack-utils</code></span>:</p>
	 <pre class="screen">
# yum -y install crudini openstack-utils</pre>
    </div>

   <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="set_hostnames"> </a>Задание имен хостов</h3>
     </div></div></div>
     <p>Перед установкой OpenStack проверьте что окружение каждого узла настроено с соотвествующим ему именем хоста. С применением 
	 текстового редактора измените значение <span class="term"><code>HOSTNAME</code></span> в файле 
	 <span class="term"><code>/etc/sysconfig/network</code></span> на каждом узле:</p>
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
	   <li class="listitem">Узел контроллера: <span class="term"><code>HOSTNAME=controller.learningneutron.com</code></span>.
	   <li class="listitem">Вычислительный узел: <span class="term"><code>HOSTNAME=compute01.learningneutron.com</code></span>.
      </ul>
     </div>
     <p>Для упрощения взаимодействия между хостами рекомендуется использовать DNS или локальный преобразователь имен (name resolver) для 
	 разрешения имен хостов. При помощи текстового редактора на каждом узле измените файл <span class="term"><code>/etc/hosts</code></span> 
	 с тем, чтобы он содержал IP адреса управления и имена хостов всех узлов:</p>
	 <pre class="screen">
10.254.254.100 controller.learningneutron.com controller
10.254.254.101 compute01.learningneutron.com compute01</pre>
	 
     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="disabling_SELinux"> </a>Запрет SELinux</h4>
      </div></div></div>
      <p>Во избежание проблем со связью между службами рекомендуется запретить на всех узлах политику безопасности SELinux на протяжении 
	  данной установки и последующего тестового использования.</p>
      <p>SELinux может быть установлена в одно из следующих трех состояний:</p>
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
	    <li class="listitem"><span class="term"><code>enforcing</code></span>: Принудительно применяется политика безопасности SELinux.
	    <li class="listitem"><span class="term"><code>permissive</code></span>: SELinux выдает предупреждения вместо принудительного применения.
	    <li class="listitem"><span class="term"><code>disabled</code></span>: Никакая политика SELinux не загружена.
       </ul>
      </div>
      <p>Чтобы запретить SELinux, отредактируйте файл <span class="term"><code>/etc/selinux/config</code></span> и измените значение 
	  <span class="term"><code>SELinux</code></span> на <span class="term"><code>disabled</code></span>. Для вашего удобства следующая 
	  команда сделает соответствующее изменение:</p>
	 <pre class="screen">
# sed -i &quot;/SELINUX=enforcing/c\SELINUX=disabled&quot; /etc/selinux/config</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="remove_iptables_rules"> </a>Удаление правил iptables</h4>
      </div></div></div>
      <p>CentOS поставляется с достаточно ограничительными правилами по умолчанию. Отредактируйте службу iptables межсетевого экрана 
	  чтобы позволить весь входящий трафик следующими командами:</p>
	 <pre class="screen">
# iptables -D INPUT -j REJECT --reject-with icmp-host-prohibited
# iptables -D FORWARD -j REJECT --reject-with icmp-host-prohibited
# service iptables save</pre>
     <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Совет</th></tr><tr><td align="left" valign="top">
      <p>Изменения правил призваны уменьшить возможные проблемы с данным руководством по установке и не предназначены для применения в 
      промышленной реализации. Обратитесь к инструкции по безопасности OpenStack на 	  
	  <a class="xref" href="http://docs.openstack.org/sec/" title="docs.openstack.org/sec/"><code>http://docs.openstack.org/sec/</code></a>
	  для получения дополнительной информации по безопасности среды OpenStack.</p></td></tr></table>
     </div>
    </div>
   </div>

  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="instal_and_config_NTP"> </a>Установка и настройка протокола службы времени</h2>
   </div></div></div>
   <p>Программа синхронизации времени, подобная NTP, крайне необходима, поскольку службы OpenStack зависят от согласованности и синхронности 
   времени между хостами. Для Nova (вычислительная служба) наличие синхронного времени позволяет избегать проблем при запуске 
   виртуальных машин по рассписанию на вычислительных узлах. Другие службы могут испытывать подобные проблемы при рассинхронизации времени.</p>
   <p>Для установки NTP выполните следующие команды на всех узлах в вашем окружении:</p>
	 <pre class="screen">
# yum -y install ntp
# service ntpd start</pre>
   <p>В отличие от Ubuntu, операционные системы RHEL и CentOS не запускают автоматически службы после установки. Для настройки запуска NTP 
   при загрузке воспользуйтесь командой <span class="term"><code>chkconfig</code></span>, как показано ниже:</p>
	 <pre class="screen">
# chkconfig ntpd on</pre>
   <p></p>
  </div>

  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="upgrade_system"> </a>Модернизация системы</h2>
   </div></div></div>
   <p>Перед установкой OpenStack важно, чтобы ядро и другие пакеты системы на всех узлах были обновлены до последней поддерживаемой версии 
   CentOS 6.5. Выполните следующую команду <span class="term"><code>yum</code></span> на каждом узле с последующей перезагрузкой, чтобы 
   изменения вступили в силу:</p>
	 <pre class="screen">
# yum -y upgrade
# reboot</pre>
  </div>


  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="instal_OpenStack"> </a>Установка OpenStack</h2>
   </div></div></div>
   <p>Этапы оставшейся части главы устанавливают службы OpenStack включая Keystone, Glance, Nova Compute и Horizon на отдельный контроллер
   и вычислительный узел. Neutron, служба сетевой среды OpenStack, будет установлена в следующей главе.</p>

    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="MySQL_server"> </a>Установка и настройка сервера баз данных MySQL</h3>
     </div></div></div>
     <p>На узле контроллера воспользуйтесь <span class="term"><code>yum</code></span> для установки сервера баз данных MySQL:</p>
	 <pre class="screen">
# yum -y install mysql mysql-server MySQL-python</pre>
     <p>После установки настройте IP адрес, с которым будет связан MySQL изменив файл настройки 
	 <span class="term"><code>/etc/my.cnf</code></span> и добавив определение <span class="term"><code>bind-address</code></span>. 
	 Выполнение этого позволит связываться с MySQL другим хостам окружения. Значение для <span class="term"><code>bind-address</code></span> 
	 должно быть IP иправления узла контролера:</p>
	 <pre class="screen">
# crudini --set /etc/my.cnf mysqld bind-address 10.254.254.100</pre>
     <p>Запустите процесс <span class="term"><code>mysqld</code></span> и настройте его запуск при загрузке:</p>
	 <pre class="screen">
# service mysqld start
# chkconfig mysqld on</pre>
     <p>Утилита безопасной установки MySQL используется для построения базы данных MySQL по умолчанию и установки пароля для 
	 пользователя root MySQL. Следующая команда начнет процесс установки и настройки MySQL:</p>
	 <pre class="screen">
# mysql_secure_installation</pre>
     <p>В процессе установки MySQL вы получите запросы на ввод  пароля и изменение различных настроек. Для данной установки 
	 выбран пароль <span class="term"><code>openstack</code></span> для root. Для вашего окружения настоятельно рекомендуется 
	 более приспособленный с точки зрения безопасности пароль.</p>
     <p>Чтобы покинуть процесс настройки ответьте <span class="term"><code>[Y]es</code></span> на оставшиеся вопросы. На данный 
	 момент времени сервер MySQL был успешно установлен на узле контроллера.</p>
    </div>
   
    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="MySQL_client"> </a>Установка клиента MySQL</h3>
     </div></div></div>
     <p>Помимо сервера MySQL, вычислительные узлы в среде должны быть настроены как клиенты MySQL. Установите клиент MySQL на 
	 <span class="term"><code>compute01</code></span> следующим образом:</p>
	 <pre class="screen">
# mysql_secure_installation</pre>
    </div>
   
    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="messaging_server"> </a>Установка и настройка сервера сообщений</h3>
     </div></div></div>
     <p><span class="term"><span class="emphasis"><em>Advanced Message Queue Protocol (AMQP)</em></span></span> (Протокол расширенной 
	 очереди сообщений) является технологией сообщений выбранной для применения в облаке на основе OpenStack. Компоненты, подобные 
	 Nova, Cinder и Neutron внутренне взаимодействуют через AMQP и друг с другом с применением вызовов API. Ниже приводятся инструкции 
	 для установки Qpid, брокера AMQP. Популярные альтернативы содержат RabbitMQ и ZeroMQ.
	 </p>
     <p>На узле контроллера установите сервер сообщений:</p>
	 <pre class="screen">
# yum -y install qpid-cpp-server memcached</pre>
     <p>Для упрощения установки запретите аутентификацию Qpid отредактировав файл <span class="term"><code>/etc/qpidd.conf</code></span>
	 и изменив параметр <span class="term"><code>auth</code></span> на <span class="term"><code>no</code></span> следующим образом:</p>
	 <pre class="screen">
# sed -i &quot;/^auth/s/auth=yes/auth=no/&quot; /etc/qpidd.conf</pre>
     <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Совет</th></tr><tr><td align="left" valign="top">
      <p>Хотя запрещение аутентификации приемлемо для данного тестового окружения, в промышленной реализации аутентификация 
	  должна быть разрешена. Ознакомьтесь с документацией Qpid для дальнейших инструкций о том, как разрешить 
	  аутентификацию.</p></td></tr></table>
     </div>
     <p>Запустите службу <span class="term"><code>qpid</code></span> и установите ее автоматический запуск при загрузке:</p>
	 <pre class="screen">
# service qpidd start
# chkconfig qpidd on</pre>
    </div>
   
    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="identity_service"> </a>Установка и настройка службы идентификации</h3>
     </div></div></div>
     <p>Службой идентификации для OpenStack является KeyStone и она используется для аутентификации и авторизации пользователей 
	 и служб в облаке OpenStack. KeyStone должен быть установлен только на узле контроллера наряду с 
	 <span class="term"><code>python-keystoneclient</code></span>:</p>
	 <pre class="screen">
# yum -y install openstack-keystone python-keystoneclient</pre>
     <p>Настройте Keystone при помощи <span class="term"><code>crudini</code></span> для использования MySQL в качестве его базы 
	 данных. В данной установке имя пользователя и пароль будут <span class="term"><code>keystone</code></span>:</p>
	 <pre class="screen">
# crudini --set /etc/keystone/keystone.conf sql connection mysql://keystone:keystone@controller/keystone</pre>
     <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
      <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Совет</th></tr><tr><td align="left" valign="top">
      <p>На протяжении данной книги используются не безопасные пароли для упрощения настройки, что не рекомендуется для использования 
	  в промышленном применении. Посетите <a class="xref" href=" http://www.strongpasswordgenerator.org" 
	  title="strongpasswordgenerator.org"><code>http://www.strongpasswordgenerator.org</code></a> для создания сильного пароля для вашей 
	  среды.</p></td></tr></table>
     </div>
     <p>Для создания базы данных Keystone, связанных таблиц и пользователя базы данных <span class="term"><code>keystone</code></span>, 
	 который будет использован для службы Keystone для связи с базой данных, воспользуйтесь командой 
	 <span class="term"><code>openstack-db</code></span></p>
	 <pre class="screen">
# openstack-db --init --service keystone --password keystone</pre>
     <p>Вы можете быть запрошены на ввод пароля пользователя <span class="term"><code>root</code></span> MySQL. Пока он не 
	 изменен, данная установка использует пароль <span class="term"><code>openstack</code></span> для MySQL 
	 <span class="term"><code>root</code></span>.</p>
     <p>Определите маркер (жетон, token) авторизации для его использования как совместно используемого кода безопасности между Keystone и 
	 другими службами OpenStack. Когда он определен, маркер авторизации <span class="term"><code>admin_token</code></span> 
	 может быть использован для внесения изменений в Keystone в случае, если не был настроен пользователь с правами администратора или 
	 если пароль был забыт. Выполняющие к Keystone запросы клиенты могут передавать маркер авторизации, который затем удостоверяется 
	 Keystone перед выполнением действий.</p>
     <p>Для создания случайного маркера и сохранения его в файле настройки может быть использован OpenSSL:</p>
	 <pre class="screen">
# ADMIN_TOKEN=$(openssl rand -hex 10)
# crudini --set /etc/keystone/keystone.conf DEFAULT admin_token $ADMIN_TOKEN</pre>
     <p>По умолчанию Keystone использует для аутентификации маркеры PKI. Следующие шаги создадут ключи и сертификаты подписи:</p>
	 <pre class="screen">
# keystone-manage pki_setup --keystone-user keystone --keystone-groupkeystone
# chown -R keystone:keystone /etc/keystone/* /var/log/keystone/keystone.log</pre>
     <p>Применив <span class="term"><code>crudini</code></span>, измените 
	 <span class="term"><code>/etc/keystone/keystone.conf</code></span> и установите значение 
	 <span class="term"><code>provider</code></span> для PKI:</p>
	 <pre class="screen">
# crudini --set /etc/keystone/keystone.conf token provider keystone.token.providers.pki.Provider</pre>
     <p>Запустите службу Keystone и разрешите ее старт во время загрузки введя следующие команды:</p>
	 <pre class="screen">
# service openstack-keystone start
# chkconfig openstack-keystone on</pre>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="define_users_tenants_roles"> </a>Определение пользователей, владельцев и ролей в Keystone</h4>
      </div></div></div>
      <p>После того, как установка Keystone завершилась, необходимо установить пользователей, владельцев (tenant), роли и 
	  конечные точки которые будут использовать различные службы OpenStack.</p>
      <p>Обычно для аутентификации через Keystone используются имя пользователя и пароль. Однако, поскольку пользователи пока еще 
	  не были созданы, необходимо воспользоваться созданным ранее маркером авторизации. Маркер может быть передан с применением 
	  параметра <span class="term"><code>--os-token</code></span> команды <span class="term"><code>keystone</code></span> или 
	  путем установки значения переменной окружения <span class="term"><code>OS_SERVICE_TOKEN</code></span>. Мы воспользуемся 
	  обеими переменными окружения <span class="term"><code>OS_SERVICE_TOKEN</code></span> и 
	  <span class="term"><code>OS_SERVICE_ENDPOINT</code></span> для обеспечения маркера авторизации и определения того, где 
	  выполняется служба Keystone.</p>
      <p>Воспользуйтесь командой <span class="term"><code>export</code></span> для экспорта переменной и ее значения в ваше 
	  окружение. <span class="term"><code>OS_SERVICE_TOKEN</code></span> должен быть установлен в определенное ранее значение 
	  <span class="term"><code>$ADMIN_TOKEN</code></span>:</p>
	  <pre class="screen">
# export OS_SERVICE_TOKEN=$ADMIN_TOKEN
# export OS_SERVICE_ENDPOINT=http://controller:35357/v2.0</pre>
      <p>В Keystone владельцы (tenant) представляют логическую группу пользователей, которым выделены ресурсы. Ресурсы выделяются 
	  владельцам, а не непосредственно пользователям. Создайте владельца <span class="term"><code>admin</code></span> для 
	  пользователя с правами администратора и владельца <span class="term"><code>service</code></span> для других служб 
	  OpenStack воспользовавшись следующим:</p>
	  <pre class="screen">
# keystone tenant-create --name=admin --description=&quot;Admin Tenant&quot;
# keystone tenant-create --name=service --description=&quot;Service Tenant&quot;</pre>
      <p>Для других пользователей облака дополнительные владельцы могут быть созданы позже. Далее, создайте пользователя с 
	  правами администратора с именем <span class="term"><code>admin</code></span>. Задайте пароль безопасности и адрес 
	  email для пользователя <span class="term"><code>admin</code></span> следующим образом:</p>
	  <pre class="screen">
# keystone user-create --name=admin --pass=secrete --email=admin@learningneutron.com</pre>
      <p>После создания пользователя <span class="term"><code>admin</code></span> создайте роль для административных задач с 
	  именем <span class="term"><code>admin</code></span>:</p>
	  <pre class="screen">
# keystone role-create --name=admin</pre>
      <p>Все созданные роли должны соответствовать ролям, определенным в файлах <span class="term"><code>policy.json</code></span> 
	  соответствующих служб OpenStack. Файлы политик по умолчанию используют роль <span class="term"><code>admin</code></span> 
	  для разрешения доступа к службам. Для дополнительной информации по управлению пользователями в Keystone, пожалуйста, 
	  ознакомьтесь со следующим URL: <a class="xref" href="http://docs.openstack.org/admin-guidecloud/content/keystone-user-management.html" 
	  title="docs.openstack.org/admin-guidecloud/content/keystone-user-management"><code>http://docs.openstack.org/admin-guidecloud/content/keystone-user-management.html</code></a>.</p>
      <p>Наконец, свяжите роль <span class="term"><code>admin</code></span> с пользователем <span class="term"><code>admin</code></span> 
	  при регистрации с владельцем <span class="term"><code>admin</code></span> следующим образом:</p>
	  <pre class="screen">
# keystone user-role-add --user=admin --tenant=admin --role=admin</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="define_services_API_endpoints"> </a>Определение служб и API конечных точек в Keystone</h4>
      </div></div></div>
      <p>Каждая установленная служба OpenStack должна быть зарегистрирована в Keystone, следовательно можно отследить ее местоположение 
	  в сети. Существуют две команды, выполняющие регистрацию службы:</p>
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
	    <li class="listitem"><span class="term"><code>keystone service-create</code></span>: 
		Описывает создаваемую службу.
	    <li class="listitem"><span class="term"><code>keystone endpoint-create</code></span>: 
		Связывает конечную точку API с соответствующей службой.
       </ul>
      </div>
      <p>Keystone сама по себе находится среди служб, которые должны быть зарегистрированы. Вы можете создать запись службы 
	  для Keystone с помощью следующей команды:</p>
	  <pre class="screen">
# keystone service-create --name=keystone --type=identity --description=&quot;Keystone Identity Service&quot;</pre>
      <p>Результирующий вывод будет представлен в форме таблицы и будет содержать уникальный ID, который будет 
	  использоваться в последующих командах:</p>
	  <pre class="screen">
+-------------+----------------------------------+
| Property    |              Value               |
+-------------+----------------------------------+
| description | Keystone Identity Service        |
| id          | 47b36f2684e94cfdbd78ba912e6091ec |
| name        | keystone                         |
| type        | identity                         |
+-------------+----------------------------------+</pre>
      <p>Далее вы должны определить конечную точку API для службы идентификации с использованием выданного ID. 
	  При определении конечной точки вы должны предоставить URL для общедоступного API, внутреннего API и API администрирования. 
	  Эти три URL потенциально могут быть тремя различными сетевыми IP в зависимости от ваших сетевых установок, а также если 
	  используется NAT. Короткое имя контроллера будет использоваться для заполнения URL. Каждый хост может ссылаться на другой 
	  на основе имени хоста через DNS или созданных ранее локальных записей <span class="term"><code>/etc/hosts</code></span>.
	  Давайте взглянем на следующие команды:</p>
	  <pre class="screen">
# keystone endpoint-create \
 --service-id=`keystone service-get keystone | awk '/ id / { print $4 }'` \
 --publicurl=http://controller:5000/v2.0 \
 --internalurl=http://controller:5000/v2.0 \
 --adminurl=http://controller:35357/v2.0</pre>
      <p>Результирующий вывод будет следующим:</p>
	  <pre class="screen">
+-------------+-----------------------------------+
| Property    |             Value                 |
+-------------+-----------------------------------+
| adminurl    | http://controller:35357/v2.0      |
| id          | 7c1112c14cd8494fbd8dadb09581926f  |
| internalurl | http://controller:5000/v2.0       |
| publicurl   | http://controller:5000/v2.0       |
| region      | regionOne                         |
| service_id  | 47b36f2684e94cfdbd78ba912e6091ec  |
+-------------+-----------------------------------+</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="verify_instal"> </a>Проверка установки Keystone</h4>
      </div></div></div>
      <p>Чтобы проверить, что Keystone был установлен и настроен соответствующим образом, воспользуйтесь командой 
	  <span class="term"><code>unset</code></span> для сброса значений переменных окружения <span class="term"><code>OS_SERVICE_TOKEN</code></span>
	  и <span class="term"><code>OS_SERVICE_ENDPOINT</code></span>. Эти переменные нужны только для начальной загрузки пользователя 
	  с правами администратора и регистрации нашей службы Keystone. Давайте посмотрим на следующую команду:</p>
	  <pre class="screen">
# unset OS_SERVICE_TOKEN OS_SERVICE_ENDPOINT</pre>
      <p>Когда значения переменных окружения сброшены, они должны быть доступными для использования аутентификации на основе имени 
	  пользователя. Вы можете запросить маркер аутентификации с применением пользователя <span class="term"><code>admin</code></span> 
	  и определенного ранее пароля:</p>
	  <pre class="screen">
# keystone --os-username=admin --os-password=secrete --os-authurl=http://controller:35357/v2.0 token-get</pre>
      <p>Keystone должен вернуть маркер, являющийся парой для предписанного ID пользователя. Это подтвердит что учетная запись 
	   установлена в Keystone с ожидаемыми полномочиями. Результирующий вывод следующий:</p>
	  <pre class="screen">
+-----------+----------------------------------+
| Property  |        Value                     |
+-----------+----------------------------------+
| expires   | 2014-07-25T00:45:46Z             |
| id        | &lt;Base64-encoded Token&gt;
| user_id   | 6d8b854881ff4568a22342fae7cc4df6 |
+-----------+----------------------------------+</pre>
      <p>Далее вы можете проверить, что авторизация работает соответствующим образом путем запроса авторизации для владельца:</p>
	  <pre class="screen">
# keystone --os-username=admin --os-password=secrete --os-tenantname=admin --os-auth-url=http://controller:35357/v2.0 token-get</pre>
      <p>Вы должны получить новый маркер в ответе, на данный момент содержащий ID владельца, обладающего 
	  <span class="term"><code>admin</code></span>. Это подтвердит, что учетная запись вашего пользователя имеет точное определение 
	  роли в описанном владельце и то, что владелец существует, как и ожидалось.</p>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="set_env_vars"> </a>Установка переменных среды</h4>
      </div></div></div>
      <p>Чтобы избежать необходимости предоставлять учетные данные при каждом запуске вами команды OpenStack, создайте файл, 
	  содержащий переменные среды, который может быть загружен в любое время:</p>
	  <pre class="screen">
# mkdir ~/credentials

# cat &gt;&gt; ~/credentials/admin &lt;&lt;EOF
export OS_USERNAME=admin
export OS_PASSWORD=secrete
export OS_TENANT_NAME=admin
export OS_AUTH_URL=http://controller:35357/v2.0
EOF</pre>
      <p>Воспользуйтесь командой <span class="term"><code>source</code></span> для загрузки переменных окружения из файла. 
	  Чтобы проверить Keystone, выполните следующие команды:</p>
	  <pre class="screen">
# source ~/credentials/admin
# keystone token-get
# keystone user-list</pre>
      <p>Keystone должен вернуть необходимый маркер и список пользователей как на запросе ниже:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0202.jpg"/></div><br />
      </div>
     </div>
	</div>

	<div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="image_service"> </a>Установка и настройка службы образов</h3>
     </div></div></div>
     <p>Glance является службой образов для OpenStack. Он отвечает за хранение образов и моментальных снимков экземпляров, а также 
	 для предоставления образов вычислительным узлам при создании экземпляров.</p>
     <p>Для установки Glance выполните следующую команду на узле контроллера:</p>
	 <pre class="screen">
# yum -y install openstack-glance</pre>
     <p>Вы можете воспользоваться командой <span class="term"><code>openstack-db</code></span> для инициализации базы данных 
	 Glance и добавления пользователя <span class="term"><code>glance</code></span> в MySQL:</p>
	 <pre class="screen">
# openstack-db --init --service glance --password glance</pre>
     <p>Воспользуйтесь <span class="term"><code>crudini</code></span> для установки строки соединения SQL в файлах настройки Glance:</p>
	 <pre class="screen">
# crudini --set /etc/glance/glance-api.conf DEFAULT sql_connection mysql://glance:glance@controller/glance
# crudini --set /etc/glance/glance-registry.conf DEFAULT sql_connection mysql://glance:glance@controller/glance</pre>
     <p>Затем вы можете добавить пользователя <span class="term"><code>glance</code></span> в Keystone и создайте соответствующую 
	 роль:</p>
	 <pre class="screen">
# keystone user-create --name=glance --pass=glance --email=glance@learningneutron.com
# keystone user-role-add --user=glance --tenant=service --role=admin</pre>
     <p>Воспользуйтесь <span class="term"><code>crudini</code></span> для установки атрибутов в файлах настройки Glance:</p>
	 <pre class="screen">
# crudini --set /etc/glance/glance-api.conf keystone_authtoken auth_host controller
# crudini --set /etc/glance/glance-api.conf keystone_authtoken admin_user glance
# crudini --set /etc/glance/glance-api.conf keystone_authtoken admin_tenant_name service
# crudini --set /etc/glance/glance-api.conf keystone_authtoken admin_password glance
# crudini --set /etc/glance/glance-registry.conf keystone_authtoken auth_host controller
# crudini --set /etc/glance/glance-registry.conf keystone_authtoken admin_user glance
# crudini --set /etc/glance/glance-registry.conf keystone_authtoken admin_tenant_name service
# crudini --set /etc/glance/glance-registry.conf keystone_authtoken admin_password glance</pre>
     <p>Glance содержит файлы настройки по умолчанию которые необходимо скопировать и изменить следующим образом:</p>
	 <pre class="screen">
# cp /usr/share/glance/glance-api-dist-paste.ini /etc/glance/glance-apipaste.ini
# cp /usr/share/glance/glance-registry-dist-paste.ini /etc/glance/glanceregistry-paste.ini</pre>
     <p>Каждый из упомянутых выше в предыдущих командах файлов должен быть изменен для добавления следующих параметров:</p>
	 <pre class="screen">
# crudini --set /etc/glance/glance-api-paste.ini filter:authtoken auth_host controller
# crudini --set /etc/glance/glance-api-paste.ini filter:authtoken admin_user glance

# crudini --set /etc/glance/glance-api-paste.ini filter:authtoken admin_tenant_name service
# crudini --set /etc/glance/glance-api-paste.ini filter:authtoken admin_password glance
# crudini --set /etc/glance/glance-api-paste.ini filter:authtoken flavor keystone

# crudini --set /etc/glance/glance-registry-paste.ini filter:authtoken auth_host controller
# crudini --set /etc/glance/glance-registry-paste.ini filter:authtoken admin_user glance
# crudini --set /etc/glance/glance-registry-paste.ini filter:authtoken admin_tenant_name service
# crudini --set /etc/glance/glance-registry-paste.ini filter:authtoken admin_password glance
# crudini --set /etc/glance/glance-registry-paste.ini filter:authtoken flavor keystone</pre>
     <p>Вы можете запустить эти службы Glance и разрешить им запуск во время загрузки следующими командами:</p>
	 <pre class="screen">
# service openstack-glance-api start
# service openstack-glance-registry start
# chkconfig openstack-glance-api on
# chkconfig openstack-glance-registry on</pre>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="define_Glance"> </a>Определение службы и API конечных точек Glance в Keystone</h4>
      </div></div></div>
      <p>Как и другие службы OpenStack, Glance должен быть добавлен в базу данных Keystone с помощью команд 
	  <span class="term"><code>service-create</code></span> и <span class="term"><code>endpoint-create</code></span>:</p>
	  <pre class="screen">
# keystone service-create --name=glance --type=image --description=&quot;Glance Image Service&quot;</pre>
      <p>Вывод результата выглядит следующим образом:</p>
	  <pre class="screen">
+-------------+----------------------------------+
| Property    |              Value               |
+-------------+----------------------------------+
| description |       Glance Image Service       |
| id          | bbbacfbe630341b181659f00a2ef6a90 |
| name        |              glance              |
| type        |              image               |
+-------------+----------------------------------+</pre>
      <p>Значение <span class="term"><code>id</code></span> здесь должно быть использовано для заполнения значения 
	  <span class="term"><code>service-id</code></span> следующим образом:</p>
	  <pre class="screen">
# keystone endpoint-create \
 --service-id=`keystone service-get glance | awk '/ id / { print $4 }'`\
 --publicurl=http://controller:9292 \
 --internalurl=http://controller:9292 \
 --adminurl=http://controller:9292</pre>
      <p>Результирующий вывод таков:</p>
	  <pre class="screen">
+-------------+----------------------------------+
| Property    |              Value               |
+-------------+----------------------------------+
| adminurl    |      http://controller:9292      |
| id          | 32504596c4cc4661a04adbf1dfb97c08 |
| internalurl |      http://controller:9292      |
| publicurl   |      http://controller:9292      |
| region      |            regionOne             |
| service_id  | bbbacfbe630341b181659f00a2ef6a90 |
+-------------+----------------------------------+</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="verify_Glance"> </a>Проверка установки службы образов Glance</h4>
      </div></div></div>
      <p>Чтобы проверить, что Glance установлен и настроен правильно загрузите тестовый образ из интернета и проверьте что он 
	  может быть выгружен на сервер образов:</p>
	  <pre class="screen">
# mkdir /var/tmp/images ; cd /var/tmp/images/
# wget http://cdn.download.cirros-cloud.net/0.3.1/cirros-0.3.1-x86_64-disk.img</pre>
      <p>Выгрузите образ на Glance с применением следующей команды:</p>
	  <pre class="screen">
# glance image-create --name=CirrOS-0.3.1 --disk-format=qcow2 --container-format=bare --is-public=true --file /var/tmp/images/cirros-0.3.1-x86_64-disk.img</pre>
      <p>Проверьте что этот образ существует в Glance с помощью команды <span class="term"><code>image-list</code></span>.
	  Обратите внимание на следующий снимок экрана:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0203.jpg"/></div><br />
      </div>
      <p>Образ CirrOS очень ограничен в функциональности и рекомендуется только для проверки связности и рабочей функциональности 
	  вычислительной среды (Compute). Многие производители предоставляют готовые для облаков образы для применения с OpenStack 
	  следующим образом:</p>
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
	    <li class="listitem"><span class="term"><span class="emphasis"><em>Образы облака Ubuntu</em></span></span>: 
		<a class="xref" href="http://cloud-images.ubuntu.com/" 
	    title="cloud-images.ubuntu.com"><code>http://cloud-images.ubuntu.com/</code></a>.
	    <li class="listitem"><span class="term"><span class="emphasis"><em>Образы на основе Red Hat</em></span></span>: 
		<a class="xref" href="http://openstack.redhat.com/Image_resources" 
	    title="openstack.redhat.com/Image_resources"><code>http://openstack.redhat.com/Image_resources</code></a>.
       </ul>
      </div>
      <p>Чтобы установить образ из удаленного местоположения примените параметр <span class="term"><code>--location</code></span> 
	  вместо <span class="term"><code>--file</code></span> следующим образом:</p>
	  <pre class="screen">
# glance image-create --name=Ubuntu-14.04 --disk-format=qcow2 --container-format=bare --is-public=true --location http://cloud-images.ubuntu.com/trusty/current/trusty-server-cloudimg-amd64-disk1.img</pre>
      <p>Другой взгляд на список образов (на следующем снимке экрана) показывает новые образы доступны для использования:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0204.jpg"/></div><br />
      </div>
     </div>
	</div>
	
    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compute_service"> </a>Установка и настройка вычислительной службы</h3>
     </div></div></div>
     <p>Вычислительная среда (Compute) это коллекция служб, которая позволяет оператором облака и владельцам запускать образы 
	 виртуальных машин. Большинство служб выполняются на узле контроллера за исключением службы 
	 <span class="term"><code>openstack-nova-compute</code></span>, которая работает на вычислительных узлах и отвечает за 
	 запуск экземпляров виртуальных машин.</p>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="controller_node"> </a>Установка и настройка компонентов узла контроллера</h4>
      </div></div></div>
      <p>Установите пакет <span class="term"><code>openstack-nova</code></span>, который установит различные службы Nova (Compute), 
	  которые используются на узле контроллера, следующим образом:</p>
	  <pre class="screen">
# yum -y install openstack-nova python-novaclient</pre>
      <p>Выполните команду <span class="term"><code>openstack-db</code></span> для инициализации и создания базы данных службы Nova 
	  (Compute), связанных таблиц и пользователя MySQL следующим образом:</p>
	  <pre class="screen">
# openstack-db --init --service nova --password nova</pre>
      <p>Воспользуйтесь <span class="term"><code>crudini</code></span> для настройки Nova Compute для использования MySQL в качестве 
	  базы данных следующим образом:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf database connection mysql://nova:nova@controller/nova</pre>
      <p>Установите эти ключи настройки для конфигурирования Nova (Compute) для использования брокера сообщений Qpid:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT rpc_backend nova.openstack.common.rpc.impl_qpid
# crudini --set /etc/nova/nova.conf DEFAULT qpid_hostname controller</pre>
      <p>VNC Proxy является компонентой OpenStack, которая позволяет пользователям осуществлять доступ к их экземплярам с 
	  применением клиентов VNC. <span class="term"><span class="emphasis"><em>VNC</em></span></span> означает 
	  <span class="term"><span class="emphasis"><em>Virtual Network Computing</em></span></span> и является совместно используемой 
	  системой графического рабочего стола, которая использует протокол Remote Frame Buffer для управления другим компьютером через 
	  сеть. Контроллер должен быть способен взаимодействовать с вычислительными узлами для служб VNC чтобы работать надлежащим 
	  образом через инструментальную панель Horizon или других клиентов VNC.</p>
      <p>Используйте <span class="term"><code>crudini</code></span> для установки параметров настройки 
	  <span class="term"><code>my_ip</code></span>, <span class="term"><code>vncserver_listen</code></span> и 
	  <span class="term"><code>vncserver_proxyclient_address</code></span> в значение адреса управляющего IP узла контроллера:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT my_ip 10.254.254.100
# crudini --set /etc/nova/nova.conf DEFAULT vncserver_listen 10.254.254.100
# crudini --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 10.254.254.100</pre>
      <p>Создайте пользователя с именем <span class="term"><code>nova</code></span> в Keystone, который служба Nova (Compute) 
	  будет использовать для аутентификации. После этого поместите пользователя во владение (tenant) 
	  <span class="term"><code>service</code></span> и предоставьте пользователю роль <span class="term"><code>admin</code></span>:</p>
	  <pre class="screen">
# keystone user-create --name=nova --pass=nova --email=nova@learningneutron.com
# keystone user-role-add --user=nova --tenant=service --role=admin</pre>
      <p>Настройте Nova (Compute) на использование следующих полномочий Keystone:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
# crudini --set /etc/nova/nova.conf keystone_authtoken auth_host controller
# crudini --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
# crudini --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
# crudini --set /etc/nova/nova.conf keystone_authtoken admin_user nova
# crudini --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
# crudini --set /etc/nova/nova.conf keystone_authtoken admin_password nova</pre>
      <p>Полномочия должны быть добавлены в файл <span class="term"><code>/etc/nova/api-paste.ini</code></span>, который 
	  соответствует деталям данного построения. Эти параметры должны быть добавлены в раздел 
	  <span class="term"><code>[filter:authtoken]</code></span> файла <span class="term"><code>ini</code></span>:</p>
	  <pre class="screen">
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_host controller
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_port 35357
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_protocol http
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_uri http://controller:5000/v2.0
# crudini --set /etc/nova/api-paste.ini filter:authtoken admin_tenant_name service
# crudini --set /etc/nova/api-paste.ini filter:authtoken admin_user nova
# crudini --set /etc/nova/api-paste.ini filter:authtoken admin_password nova</pre>
      <p>Вы можете убедится, что параметр <span class="term"><code>api_paste_config=/etc/nova/api-paste.ini</code></span> 
	  установлен на файл <span class="term"><code>/etc/nova/nova.conf</code></span> при помощи следующей команды:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT api_paste_config /etc/nova/api-paste.ini</pre>
      <p>Вы должны зарегистрировать Nova (Compute) службой идентификации чтобы другие службы OpenStack могли определять ее 
	  местоположение. Зарегистрируйте эту службу и определите ее конечную точку:</p>
	  <pre class="screen">
# keystone service-create --name=nova --type=compute --description=&quot;Nova Compute service&quot;</pre>
      <p>Результирующий вывод должен быть похож на:</p>
	  <pre class="screen">
+-------------+----------------------------------+
| Property    |              Value               |
+-------------+----------------------------------+
| description |       Nova Compute service       |
| id          | a946cbd06a124ec39662622cc2d6e4ec |
| name        |              nova                |
| type        |            compute               |
+-------------+----------------------------------+</pre>
      <p>Используйте возвращенное свойство <span class="term"><code>id</code></span> для создания конечной точки:</p>
	  <pre class="screen">
# keystone endpoint-create \
  --service-id=`keystone service-get nova | awk '/ id / { print $4 }'` \
  --publicurl=http://controller:8774/v2/%\(tenant_id\)s \
  --internalurl=http://controller:8774/v2/%\(tenant_id\)s \
  --adminurl=http://controller:8774/v2/%\(tenant_id\)s</pre>
      <p>Запустите службы Nova (Compute) и настройте их на старт при загрузке системы:</p>
	  <pre class="screen">
# service openstack-nova-api start
# service openstack-nova-cert start
# service openstack-nova-consoleauth start
# service openstack-nova-scheduler start
# service openstack-nova-conductor start
# service openstack-nova-novncproxy start
# service openstack-nova-console start
# chkconfig openstack-nova-api on
# chkconfig openstack-nova-cert on
# chkconfig openstack-nova-consoleauth on
# chkconfig openstack-nova-scheduler on
# chkconfig openstack-nova-conductor on
# chkconfig openstack-nova-novncproxy on
# chkconfig openstack-nova-console on</pre>
      <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Совет"><tr><td rowspan="2" align="center" valign="top" width="25">
       <img alt="[Совет]" src="../common/images/admon/tip.png"/></td><th align="left">Совет</th></tr><tr><td align="left" valign="top">
       <p>Служба <span class="term"><code>openstack-nova-network</code></span> будет установлена как часть пакета 
	   <span class="term"><code>openstack-nova</code></span>, однако не должна запускаться. Служба 
	   <span class="term"><code>openstack-nova-network</code></span> является унаследованной сетевой службой, которая замещена Neutron.
	   Neutron будет установлена в <a class="xref" href="Ch03.html" title="Глава 3. Установка Neutron"><em>Главе 3. 
	   Установка Neutron</em></a>.</p></td></tr></table>
      </div>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="compute_node"> </a>Установка и настройка компонентов вычислительного узла</h4>
      </div></div></div>
      <p>Когда службы Nova (Compute) были настроены на узле контроллера, другой хост должен быть настроен в качестве вычислительного 
	  узла. Вычислительный узел принимает запросы от узла контроллера к экземплярам виртуальной машины хоста. Разделение служб за счет 
	  работы выделенных вычислительных узлов означает, что Nova (Compute) может масштабироваться горизонтально путем добавления 
	  дополнительных вычислительных узлов по мере использования всех доступных ресурсов.</p>
      <p>На вычислительном узле установите пакет <span class="term"><code>openstack-nova-compute</code></span>. Этот пакет предоставляет 
	  службы виртуализации вычислительному узлу:</p>
	  <pre class="screen">
# yum -y install openstack-nova-compute</pre>
      <p>При помощи <span class="term"><code>crudini</code></span> измените файл настройки 
	  <span class="term"><code>/etc/nova/nova.conf</code></span> для определения MySQL в качестве базы данных и настройки различных 
	  установок аутентификации Keystone. Пользователь keystone <span class="term"><code>nova</code></span> был настроен в предыдущем 
	  разделе. Посмотрите на следующие команды:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf database connection mysql://nova:nova@controller/nova
# crudini --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
# crudini --set /etc/nova/nova.conf keystone_authtoken auth_host controller
# crudini --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
# crudini --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
# crudini --set /etc/nova/nova.conf keystone_authtoken admin_user nova
# crudini --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
# crudini --set /etc/nova/nova.conf keystone_authtoken admin_password nova</pre>
      <p>Далее настройте Nova (Compute) на применение брокера сообщений Qpid, настроенного на узле контроллера:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT rpc_backend nova.openstack.common.rpc.impl_qpid
# crudini --set /etc/nova/nova.conf DEFAULT qpid_hostname controller</pre>
      <p>Затем настройте Nova (Compute) для предоставления доступа к экземплярам удаленной консоли через прокси на нашем 
	  узле контроллера. Удаленная консоль доступна через инструментальную панель Horizon. Приводимые ниже настроки IP должны 
	  быть управляющими IP нашего вычислительного узла:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT my_ip 10.254.254.101
# crudini --set /etc/nova/nova.conf DEFAULT vnc_enabled True
# crudini --set /etc/nova/nova.conf DEFAULT vncserver_listen 0.0.0.0
# crudini --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 10.254.254.101
# crudini --set /etc/nova/nova.conf DEFAULT novncproxy_base_url http://controller:6080/vnc_auto.html</pre>
      <p>Определите хост, который выполняет службу образов Glance. В данной установке Glance работает на узле контроллера:</p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT glance_host controller</pre>
      <p>Измените настройку <span class="term"><code>/etc/nova/api-paste.ini</code></span> для добавления полномочий в раздел 
	  <span class="term"><code>[filter:authtoken]</code></span>:</p>
	  <pre class="screen">
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_host controller
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_port 35357
# crudini --set /etc/nova/api-paste.ini filter:authtoken auth_protocol http
# crudini --set /etc/nova/api-paste.ini filter:authtoken admin_tenant_name service
# crudini --set /etc/nova/api-paste.ini filter:authtoken admin_user nova
# crudini --set /etc/nova/api-paste.ini filter:authtoken admin_password nova</pre>
      <p>Убедитесь, что параметр <span class="term"><code> api_paste_config=/etc/nova/api-paste.ini</code></span> установлен на 
	  файл <span class="term"><code>/etc/nova/nova.conf</code></span></p>
	  <pre class="screen">
# crudini --set /etc/nova/nova.conf DEFAULT api_paste_config /etc/nova/api-paste.ini</pre>
      <p>Запустите службы Nova (Compute) и настройте их на старт при загрузке системы:</p>
	  <pre class="screen">
# service libvirtd start
# service messagebus start
# service openstack-nova-compute start
# chkconfig libvirtd on
# chkconfig messagebus on
# chkconfig openstack-nova-compute on</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="verify_nodes_communication"> </a>Проверка связи между узлами</h4>
      </div></div></div>
      <p>Чтобы проверить состояние служб Nova в нашем окружении воспользуйтесь командой <span class="term"><code>service-list</code></span> 
	  на узле контроллера следующим образом:</p>
	  <pre class="screen">
# nova service-list</pre>
      <p>Команда должна вернуть состояния служб Nova, которые были зарегистрированы:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0205.jpg"/></div><br />
      </div>
      <p>В приведенном выше выводе состояние служб на обоих узлах и контроллера, и вычислительном отражаются в колонке 
	  <span class="term"><code>Status</code></span>. Команда <span class="term"><code>nova service-list</code></span> 
	  может быть выполнена на любом узле окружения, однако будет требовать надлежащих полномочий аутентификации. Если существует 
	  несогласованность в полученном выводе между множеством узлов, стоит убедиться, что сетевое время (NTP) синхронизовано 
	  надлежащим образом на всех узлах.</p>
     </div>
     </div>
	</div>
	
    <div class="section">
     <div xmlns="" class="titlepage"><div><div>
      <h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="dashboard"> </a>Установка инструментальной панели OpenStack</h3>
     </div></div></div>
     <p>Инструментальная панель OpenStack, также называемая Horizon, предоставляет пользовательский интерфейс на основе веб к службам 
	 OpenStack, включающим Compute, Networking, Storage и Identity помимо прочих.</p>
     <p>Чтобы установить Horizon, установите следующие пакеты на узле контроллера:</p>
	 <pre class="screen">
# yum -y install mod_wsgi openstack-dashboard</pre>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="allow_connect"> </a>Разрешение соединения с инструментальной панелью</h4>
      </div></div></div>
      <p>Установки с именем <span class="term"><code>ALLOWED_HOSTS</code></span> существуют в файле 
	  <span class="term"><code>/etc/openstack-dashboard/local_settings</code></span> со следующими значениями по умолчанию:</p>
	  <pre class="screen">
ALLOWED_HOSTS = ['horizon.example.com', 'localhost']</pre>
      <p>Имена домена и хоста в списке представляют хосты HTTP, за которые отвечает веб- сервер Apache. Предыдущие установки 
	  будут требовать от пользователей, которые хотят получить доступ к панели Horizon, выполнять это через 
	  <a class="xref" href="http://horizon.example.com" title="horizon.example.com"><em>http://horizon.example.com</em> в их 
	  браузере. Не стесняйтесь добавить свой собственный домен который ссылается на адрес управления/API контроллера. В противном 
	  случае закомментируйте строку знаком весового фунта (#) и сохраните файл, чтобы разрешить использование любого заголовка 
	  хоста:</a>
	  </p>
	  <pre class="screen">
# sed -i 's/ALLOWED_HOSTS/#ALLOWED_HOSTS/' /etc/openstack-dashboard/local_settings</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="identify_Keystone"> </a>Идентификация сервера Keystone</h4>
      </div></div></div>
      <p>Измените файл <span class="term"><code>/etc/openstack-dashboard/local_settings</code></span> для установки имени хоста 
	  сервера идентификации. В данной установке службы Keystone выполняются на нашем узле контроллера. Измените значения 
	  <span class="term"><code>OPENSTACK_HOST</code></span> и <span class="term"><code>OPENSTACK_KEYSTONE_URL</code></span> 
	  с помощью следующих команд:</p>
	  <pre class="screen">
# sed -i &quot;/OPENSTACK_HOST/c\OPENSTACK_HOST = \&quot;controller\&quot;&quot; /etc/openstack-dashboard/local_settings
# sed -i -e &quot;\$aOPENSTACK_KEYSTONE_URL = \&quot;http://controller:5000/v2.0\&quot;&quot; /etc/openstack-dashboard/local_settings</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="change_listener"> </a>Изменение адреса прослушивания</h4>
      </div></div></div>
      <p>По умолчанию веб-сервер Apache настроен на прослушивание запросов HTTP на порт 80 и любые адреса IPv6. Чтобы изменить это 
	  поведение, отредактируйте <span class="term"><code>/etc/httpd/conf/httpd.conf</code></span> и замените адрес 
	  <span class="term"><code>Listen</code></span> на <span class="term"><code>10.254.254.100</code></span>:</p>
	  <pre class="screen">
# sed -i 's/Listen 80/Listen 10.254.254.100:80/' /etc/httpd/conf/httpd.conf</pre>
      <p>Следуя этому сохраните данный файл и запустите службы инструментальной панели. Примените <span class="term"><code>chkconfig</code></span> 
	  для разрешения запуска служб при загрузке:</p>
	  <pre class="screen">
# service httpd start
# chkconfig httpd on</pre>
     </div>

     <div class="section">
      <div xmlns="" class="titlepage"><div><div>
       <h4 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="test_dashboard_connectivity"> </a>Проверка связи с инструментальной панелью</h4>
      </div></div></div>
      <p>С машины, имеющей доступ ксети управления нашего узла контроллера откройте следующий URL в веб-браузере:</p>
	  <pre class="screen">
http://controller/dashboard/</pre>
      <p>Файл <span class="term"><code>/etc/hosts</code></span> моего клиента был изменен, чтобы содержать те же соответствия 
	  IP- хост-именам, которые были настроены ранее в данной главе. Следующий снимок экрана демонстрирует успешноесоединение 
	  с нашей инструментальной панелью. Имя пользователя и пароль были созданы ранее вданной главе в разделе 
	  <a class="xref" href="#define_users_tenants_roles" title="Определение пользователей, владельцев и ролей в 
	  Keystone"><em>Определение пользователей, владельцев и ролей в Keystone</em></a>. В данной установке имя пользователя 
	  <span class="term"><code>admin</code></span>, а пароль <span class="term"><code>secrete</code></span>. Взглянем на 
	  следующий снимок экрана:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0206.jpg"/></div><br />
      </div>
      <p>После успешного входа в систему инструментальная панель по умолчанию находится на вкладке администрирования. Начиная 
	  с данного момента информация об окружении предоставляется в графическом виде. На следующем снимке экрана панель 
	  <span class="term"><span class="emphasis"><em>System Info</em></span></span> предоставляет пользователю информацию о 
	  среде включая: <span class="term"><span class="emphasis"><em>Services</em></span></span> (службы), 
	  <span class="term"><span class="emphasis"><em>Compute Services</em></span></span> (вычислительные службы), 
	  <span class="term"><span class="emphasis"><em>Availability Zones</em></span></span> (доступные зоны) и 
	  <span class="term"><span class="emphasis"><em>Host Aggregates</em></span></span> (совокупности хостов).
	  Службы, перечисленные на следующем снимке экрана являются службами, установленными ранее в данной главе:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0207.jpg"/></div><br />
      </div>
      <p>Чтобы просмотреть представление служб Nova (Compute), кликните по закладке 
	  <span class="term"><span class="emphasis"><em>Compute Services</em></span></span>.
	  Это действие выдаст вывод аналогичный <span class="term"><code>nova service-list</code></span> в CLI в следующем виде:</p>
      <div class="informalfigure"><div class="mediaobject">
       <img src="figures/Fig0208.jpg"/></div><br />
      </div>
     </div>
	
	</div>
	
  <div class="section">
   <div xmlns="" class="titlepage"><div><div>
    <h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Summary"> </a>Заключение</h2>
   </div></div></div>
   <p>На данный момент в нашей установке были развернуты службы OpenStack Identity, Image, Dashboard и Compute на наших узлах 
   в нашем облаке. Пока среда еще не готова размещать экземпляры, поскольку службы сетевой среды OpenStack пока небыли установлены.
   В случае возникновения вопросов при процессах установке и проверки могут оказаться полезными в определении и решении проблем, 
   помимо прочего, зарегистрированные сообщения, которые можно найти в <span class="term"><code>/var/log/nova/</code></span>, 
   <span class="term"><code>/var/log/glance</code></span>, <span class="term"><code>/var/log/httpd</code></span> и 
   <span class="term"><code>/var/log/keystone</code></span>, помимо прочих журналов.</p>
   <p>В следующей главе вы получите руководство по установке сетевых служб Neutron и будете снабжены дополнительной информацией 
   об архитектуре, лежащей в основе сетевой среды OpenStack.</p>
  </div>

 </div>


<!----><script type="text/javascript" src="FooterAndSidebar.js">
</script><script type="text/javascript"><!--</div id="content"> is inside next code
document.write(FooterAndSidebar);//-->
</script>

</body></html>